<!-- ì¢Œì¸¡ ì‚¬ì´ë“œë°” -->
<div id="sidebar" class="d-flex flex-column bg-light border-end vh-100 position-fixed" style="width: 250px; z-index: 1000; display: none !important;">
    <!-- ğŸš¨ ì„ì‹œë¡œ ì‚¬ì´ë“œë°” ìˆ¨ê¹€ - ë©”ì¸ ì½˜í…ì¸  í‘œì‹œ í™•ì¸ìš© -->
    <!-- ë¡œê³  ì„¹ì…˜ -->
    <div class="p-3 border-bottom bg-primary text-white text-center">
        <a href="{{ url_for('index') }}" class="text-white text-decoration-none" style="cursor: pointer; transition: opacity 0.3s ease;" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'">
            <div class="mb-2">
                <img src="{{ url_for('static', filename='img/logo.png') }}" alt="MIS v2 Logo" style="max-width: 80px; max-height: 50px;" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <i class="fas fa-building fa-2x" style="display: none;"></i>
            </div>
            <h5 class="mb-0">MIS v2</h5>
            <small>Management Information System</small>
        </a>
    </div>
    
    <!-- ì‚¬ìš©ì íŒ¨ë„ -->
    <div class="p-3 border-bottom">
        <div class="d-flex align-items-center">
            <div class="me-3">
                <i class="fas fa-user-circle fa-2x text-primary"></i>
            </div>
            <div>
                <div class="fw-bold">{{ current_user.name }}</div>
                <small class="text-muted">{{ current_user.id }}</small>
            </div>
        </div>
    </div>
    
    <!-- íšŒì‚¬ ì „í™˜ (ë©€í‹°í…Œë„ŒíŠ¸) -->
    {% if show_company_switcher %}
    <div class="p-3 border-bottom bg-white">
        <div class="mb-2">
            <small class="text-muted fw-bold">í˜„ì¬ íšŒì‚¬</small>
        </div>
        <div class="dropdown">
            <button class="btn btn-outline-primary btn-sm dropdown-toggle w-100" type="button" id="companyDropdown" data-bs-toggle="dropdown">
                <i class="fas fa-building me-2"></i>
                {% if current_company and current_company.company_name %}
                    {{ current_company.company_name }}
                {% elif current_company and current_company.name %}
                    {{ current_company.name }}
                {% else %}
                    íšŒì‚¬ ì„ íƒ
                {% endif %}
            </button>
            <ul class="dropdown-menu w-100">
                {% for company in user_companies %}
                <li>
                    <a class="dropdown-item {% if current_company and (company.company_id == current_company.id or company.company.id == current_company.id) %}active{% endif %}" 
                       href="#" onclick="switchCompany({{ company.company_id if company.company_id else company.company.id }})">
                        <i class="fas fa-building me-2"></i>
                        {{ company.company.company_name if company.company else company.name }}
                        {% if company.is_primary %}<span class="badge bg-primary ms-2">ì£¼ì†</span>{% endif %}
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
    {% else %}
    <!-- ë‹¨ì¼ íšŒì‚¬ í‘œì‹œ -->
    <div class="p-3 border-bottom bg-light">
        <div class="mb-2">
            <small class="text-muted fw-bold">í˜„ì¬ íšŒì‚¬</small>
        </div>
        <div class="d-flex align-items-center">
            <i class="fas fa-building me-2 text-primary"></i>
            <span class="fw-bold">
                {% if current_company and current_company.company_name %}
                    {{ current_company.company_name }}
                {% elif current_company and current_company.name %}
                    {{ current_company.name }}
                {% else %}
                    ì—ì´ì›
                {% endif %}
            </span>
        </div>
    </div>
    {% endif %}
        
    <!-- ë©”ì¸ ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="flex-grow-1 overflow-auto">
        <ul class="nav nav-pills flex-column p-2" id="sidebar-menu">
            <li class="nav-item"><small class="text-muted fw-bold px-2">NAVIGATION</small></li>
            
            <!-- ëŒ€ì‹œë³´ë“œ -->
            <li class="nav-item">
                <a class="nav-link text-dark" href="{{ url_for('index') }}">
                    <i class="fas fa-tachometer-alt me-2"></i> ëŒ€ì‹œë³´ë“œ
                </a>
            </li>
            
            <!-- ê´€ë¦¬ì ë©”ë‰´ -->
            <li class="nav-item">
                <a class="nav-link text-dark dropdown-toggle" href="#adminMenu" data-bs-toggle="collapse" role="button" aria-expanded="false">
                    <i class="fas fa-cog me-2"></i> ê´€ë¦¬ì
                </a>
                <div class="collapse" id="adminMenu">
                    <div class="ms-3">
                        <a class="nav-link text-dark py-1" href="{{ url_for('admin.menu_management') }}">
                            <i class="fas fa-sitemap me-2"></i> ë©”ë‰´ ê´€ë¦¬
                        </a>
                        <a class="nav-link text-dark py-1" href="{{ url_for('admin.code_management') }}">
                            <i class="fas fa-code me-2"></i> ì½”ë“œ ê´€ë¦¬
                            </a>
                        <a class="nav-link text-dark py-1" href="{{ url_for('admin.department_management') }}">
                            <i class="fas fa-building me-2"></i> ë¶€ì„œ ê´€ë¦¬
                            </a>
                        <a class="nav-link text-dark py-1" href="{{ url_for('admin.user_management') }}">
                            <i class="fas fa-users me-2"></i> ì‚¬ìš©ì ê´€ë¦¬
                            </a>
                        <a class="nav-link text-dark py-1" href="{{ url_for('admin.permissions') }}">
                            <i class="fas fa-key me-2"></i> ê¶Œí•œ ê´€ë¦¬
                            </a>
                        <a class="nav-link text-dark py-1" href="{{ url_for('admin.brand_management') }}">
                            <i class="fas fa-tags me-2"></i> ë¸Œëœë“œ ê´€ë¦¬
                            </a>
                    </div>
                </div>
            </li>
            
            <!-- ERPia ë°°ì¹˜ -->
            <li class="nav-item">
                <a class="nav-link text-dark dropdown-toggle" href="#batchMenu" data-bs-toggle="collapse" role="button" aria-expanded="false">
                    <i class="fas fa-clock me-2"></i> ERPia ë°°ì¹˜
                </a>
                <div class="collapse" id="batchMenu">
                    <div class="ms-3">
                        <a class="nav-link text-dark py-1" href="{{ url_for('batch.index') }}">
                            <i class="fas fa-tachometer-alt me-2"></i> ë°°ì¹˜ ëŒ€ì‹œë³´ë“œ
                            </a>
                        <a class="nav-link text-dark py-1" href="{{ url_for('batch.settings') }}">
                            <i class="fas fa-cog me-2"></i> ë°°ì¹˜ ì„¤ì •
                            </a>
                    </div>
                </div>
            </li>
            
            <!-- ì‚¬ì€í’ˆ ê´€ë¦¬ -->
            <li class="nav-item">
                <a class="nav-link text-dark dropdown-toggle" href="#giftMenu" data-bs-toggle="collapse" role="button" aria-expanded="false">
                    <i class="fas fa-gift me-2"></i> ì‚¬ì€í’ˆ ê´€ë¦¬
                </a>
                <div class="collapse" id="giftMenu">
                    <div class="ms-3">
                        <a class="nav-link text-dark py-1" href="{{ url_for('gift.index') }}">
                            <i class="fas fa-list me-2"></i> ë¶„ë¥˜ ê´€ë¦¬
                        </a>
                        <a class="nav-link text-dark py-1" href="{{ url_for('gift.settings') }}">
                            <i class="fas fa-cog me-2"></i> ë¶„ë¥˜ ì„¤ì •
                </a>
                    </div>
                </div>
            </li>
            
            <!-- ì˜ì—… ê´€ë¦¬ -->
            <li class="nav-item">
                <a class="nav-link" href="#sales-menu" data-bs-toggle="collapse">
                    <i class="fas fa-chart-line"></i>
                    <span>ì˜ì—… ê´€ë¦¬</span>
                    <i class="fas fa-chevron-down ms-auto"></i>
                </a>
                <div class="collapse" id="sales-menu">
                    <ul class="nav nav-pills flex-column ms-3">
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('shop.index') }}">
                                <i class="fas fa-store"></i> ë§¤ì¥ ê´€ë¦¬
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('product.index') }}">
                                <i class="fas fa-box"></i> ìƒí’ˆê´€ë¦¬
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <i class="fas fa-users"></i> ì˜ì—…ì‚¬ì› ê´€ë¦¬
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <i class="fas fa-chart-bar"></i> ì˜ì—… ì‹¤ì 
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <i class="fas fa-handshake"></i> ê±°ë˜ì²˜ ê´€ë¦¬
                            </a>
                        </li>
                    </ul>
                </div>
            </li>

            <!-- ê³ ê° ê´€ë¦¬ -->
            <li class="nav-item">
                <a class="nav-link" href="#customer-menu" data-bs-toggle="collapse">
                    <i class="fas fa-users-cog"></i>
                    <span>ê³ ê° ê´€ë¦¬</span>
                    <i class="fas fa-chevron-down ms-auto"></i>
                </a>
                <div class="collapse" id="customer-menu">
                    <ul class="nav nav-pills flex-column ms-3">
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('customer.index') }}">
                                <i class="fas fa-user-friends"></i> ê³ ê° ëª©ë¡
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('customer.as_list') }}">
                                <i class="fas fa-list"></i> A/S ì ‘ìˆ˜ ëª©ë¡
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('customer.analysis') }}">
                                <i class="fas fa-chart-line"></i> ê³ ê° ë¶„ì„
                            </a>
                        </li>
                    </ul>
                </div>
            </li>

            <!-- ë§¤ì¥ ê´€ë¦¬ (ê¸°ì¡´ ë…ë¦½ ë©”ë‰´ ì œê±°) -->
        </ul>
    </nav>
    
    <!-- í•˜ë‹¨ ë¡œê·¸ì•„ì›ƒ -->
    <div class="p-3 border-top">
        <a href="{{ url_for('auth.logout') }}" class="btn btn-outline-danger w-100">
            <i class="fas fa-sign-out-alt me-2"></i> ë¡œê·¸ì•„ì›ƒ
        </a>
    </div>
</div>

<!-- ì‚¬ì´ë“œë°” í† ê¸€ ë²„íŠ¼ -->
<button class="btn btn-light d-md-none position-fixed" style="top: 10px; left: 10px; z-index: 1001;" id="sidebar-toggle">
    <i class="fas fa-bars"></i>
</button>

<!-- ì‚¬ì´ë“œë°” JavaScript -->
<script>
// íšŒì‚¬ ì „í™˜ í•¨ìˆ˜
function switchCompany(companyId) {
    $.post('/api/switch-company', {
        company_id: companyId
    }, function(data) {
        if (data.success) {
            // ì„±ê³µ ì‹œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
            location.reload();
        } else {
            alert('íšŒì‚¬ ì „í™˜ ì‹¤íŒ¨: ' + data.message);
        }
    }).fail(function() {
        alert('íšŒì‚¬ ì „í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    });
}

// ì‚¬ì´ë“œë°” í† ê¸€ (ëª¨ë°”ì¼)
document.getElementById('sidebar-toggle')?.addEventListener('click', function() {
    const sidebar = document.getElementById('sidebar');
    sidebar.classList.toggle('d-none');
});
</script>

<style>
@media (max-width: 768px) {
    #sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
    }
    #sidebar.show {
        transform: translateX(0);
    }
    .main-content {
        margin-left: 0 !important;
    }
}

@media (min-width: 769px) {
    .main-content {
        margin-left: 250px;
    }
}
</style> 