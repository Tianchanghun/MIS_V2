# 📋 **MIS v2 개발 진행 현황 및 모듈화 계획**

## 🎯 **현재 완료된 작업**

### ✅ **1. 환경 구축 완료** (100%)
- **Docker 환경**: PostgreSQL 15 (포트 5433), Redis 7 (포트 6380), pgAdmin 4 (포트 5051)
- **Python 환경**: 가상환경, 필요 패키지 설치 완료
- **환경 변수**: `.env` 파일 도커 환경에 맞게 설정 완료
- **네트워크**: 모든 컨테이너 간 연결 테스트 완료

### ✅ **2. 데이터베이스 스키마 구축 완료** (100%)
- **기본 테이블**: 13개 테이블 생성 완료 (tbl_category, tbl_member, tbl_department 등)
- **추가 테이블**: 17개 테이블 추가 생성 완료 (tbl_customer, tbl_shop, tbl_as 등)
- **총 30개 테이블**: 구현 메뉴에 필요한 모든 테이블 준비 완료
- **초기 데이터**: 부서, 관리자 계정, 카테고리 데이터 입력 완료

### ✅ **3. 프로젝트 설계 완료** (100%)
- **메뉴 구조**: 6개 대메뉴, 51개 세부 기능 정의 완료 (기존 46개 → 51개 증가)
- **기술 스택**: Flask 3.0 + PostgreSQL 15 + Redis 7 + Bootstrap 5.3 + APScheduler 3.10
- **UI/UX 가이드라인**: Bootstrap Korean Dashboard 스타일 + 배치/사은품 컴포넌트 확정
- **Redis 캐시 전략**: 세션, 데이터, 임시, 큐 DB 분리 전략 수립

### ✅ **4. 개발 문서화 완료** (100%)
- **구현 메뉴 목록**: Phase 1-3 단계별 구현 계획 + 웹 배치/사은품 기능 추가
- **개발 스택 가이드라인**: 코딩 컨벤션, 프로젝트 구조, 보안 가이드 + 배치/사은품 가이드
- **Redis 캐시 전략**: 캐시 분류, TTL 전략, 무효화 전략
- **환경 설정 가이드**: env_example.txt 완성 + 배치/사은품 설정 추가

### ✅ **5. 신규 시스템 설계 완료** (100%) 
- **📊 웹 기반 배치 시스템**: ERPia 데이터 수집 자동화, 웹에서 시간/설정 관리
- **🎁 사은품 자동 분류**: 0원 상품 자동 사은품 처리, 매출 정확도 향상
- **🏢 멀티테넌트 지원**: 에이원/에이원월드 독립 운영, 회사별 배치 설정
- **📈 분석 대시보드**: 사은품 부착률, 영향도, 비용 분석 시스템

---

## 🚧 **진행 중/대기 중인 작업**

### ⚠️ **1. 레거시 데이터 마이그레이션** (완료)
- **상태**: ✅ **100% 완료** - 72개 테이블, 2,109,847건 마이그레이션 완료
- **데이터 검증**: 100% 정합성 확인 완료
- **멀티테넌트 확장**: 에이원 데이터를 company_id=1로 설정 완료

### 🔄 **2. Flask 애플리케이션 개발** (준비 단계)
- **상태**: 기본 프레임워크 구조 생성 필요
- **우선순위**: 인증 시스템 → 웹 배치 관리 → 사은품 분류 → 관리자 메뉴 → 고객 관리

---

## 🏗️ **모듈화 개발 계획** (최대 500라인/파일 원칙)

### **Phase 1: 핵심 인프라 구축**

#### **1.1 인증 및 세션 모듈** 📝
```
app/auth/
├── __init__.py              # Blueprint 등록
├── routes.py               # 라우트 (로그인/로그아웃) - 150라인
├── forms.py                # WTF 폼 정의 - 100라인
├── services.py             # 인증 로직 - 200라인
└── decorators.py           # 권한 데코레이터 - 150라인
```

#### **1.2 웹 기반 배치 모듈** ⚙️ (신규 추가)
```
app/batch/
├── __init__.py              # Blueprint 등록
├── routes.py               # 배치 관리 라우트 - 400라인
├── scheduler.py            # APScheduler 관리 - 350라인
├── erpia_client.py         # ERPia API 클라이언트 - 400라인
├── services.py             # 배치 비즈니스 로직 - 300라인
├── forms.py                # 배치 설정 폼 - 200라인
└── utils.py                # 배치 유틸리티 - 150라인
```

#### **1.3 사은품 분류 모듈** 🎁 (신규 추가)
```
app/gift/
├── __init__.py              # Blueprint 등록
├── routes.py               # 사은품 관리 라우트 - 300라인
├── classifier.py           # 사은품 자동 분류 엔진 - 400라인
├── analytics.py            # 사은품 분석 서비스 - 350라인
├── services.py             # 사은품 비즈니스 로직 - 250라인
├── forms.py                # 사은품 설정 폼 - 150라인
└── utils.py                # 사은품 유틸리티 - 100라인
```

#### **1.4 관리자 모듈** 🔧
```
app/admin/
├── __init__.py              # Blueprint 등록
├── menu/
│   ├── routes.py           # 메뉴 관리 라우트 - 300라인
│   ├── services.py         # 메뉴 비즈니스 로직 - 250라인
│   └── forms.py            # 메뉴 폼 - 150라인
├── user/
│   ├── routes.py           # 사용자 관리 라우트 - 400라인
│   ├── services.py         # 사용자 비즈니스 로직 - 300라인
│   └── forms.py            # 사용자 폼 - 200라인
├── code/
│   ├── routes.py           # 코드 관리 라우트 - 250라인
│   ├── services.py         # 코드 비즈니스 로직 - 200라인
│   └── forms.py            # 코드 폼 - 100라인
├── department/
│   ├── routes.py           # 부서 관리 라우트 - 200라인
│   ├── services.py         # 부서 비즈니스 로직 - 150라인
│   └── forms.py            # 부서 폼 - 100라인
└── company/                # 멀티테넌트 회사 관리 (신규)
    ├── routes.py           # 회사 관리 라우트 - 250라인
    ├── services.py         # 회사 비즈니스 로직 - 200라인
    └── forms.py            # 회사 폼 - 150라인
```

#### **1.5 공통 모듈** ⚙️
```
app/common/
├── __init__.py              # 공통 모듈 초기화
├── models.py               # SQLAlchemy 모델 - 500라인 (분할 고려)
├── cache.py                # Redis 캐시 유틸리티 - 300라인
├── helpers.py              # 공통 헬퍼 함수 - 200라인
├── validators.py           # 공통 검증 함수 - 150라인
├── exceptions.py           # 커스텀 예외 - 100라인
├── multitenant.py          # 멀티테넌트 유틸리티 - 200라인 (신규)
└── logging.py              # 공통 로깅 유틸리티 - 150라인 (신규)
```

### **Phase 2: 고객 및 영업 관리**

#### **2.1 고객 관리 모듈** 👥
```
app/customer/
├── __init__.py              # Blueprint 등록
├── customer/
│   ├── routes.py           # 고객 정보 관리 - 350라인
│   ├── services.py         # 고객 비즈니스 로직 - 300라인
│   └── forms.py            # 고객 폼 - 200라인
├── as_service/
│   ├── routes.py           # A/S 접수 관리 - 400라인
│   ├── services.py         # A/S 비즈니스 로직 - 350라인
│   └── forms.py            # A/S 폼 - 150라인
├── serial/
│   ├── routes.py           # 시리얼 검색/등록 - 300라인
│   ├── services.py         # 시리얼 비즈니스 로직 - 400라인
│   └── forms.py            # 시리얼 폼 - 100라인
└── targeting/
    ├── routes.py           # 고객 타겟팅 - 250라인
    ├── services.py         # 타겟팅 비즈니스 로직 - 300라인
    └── forms.py            # 타겟팅 폼 - 150라인
```

#### **2.2 영업 관리 모듈** 💼
```
app/sales/
├── __init__.py              # Blueprint 등록
├── shop/
│   ├── routes.py           # 매장 관리 - 400라인
│   ├── services.py         # 매장 비즈니스 로직 - 350라인
│   └── forms.py            # 매장 폼 - 200라인
├── product/
│   ├── routes.py           # 상품 관리 - 450라인
│   ├── services.py         # 상품 비즈니스 로직 - 400라인
│   └── forms.py            # 상품 폼 - 250라인
├── visit/
│   ├── routes.py           # 매장 방문 관리 - 300라인
│   ├── services.py         # 방문 비즈니스 로직 - 250라인
│   └── forms.py            # 방문 폼 - 150라인
├── sms/
│   ├── routes.py           # SMS 발송 관리 - 250라인
│   ├── services.py         # SMS 비즈니스 로직 - 300라인
│   └── forms.py            # SMS 폼 - 100라인
└── analysis/               # 매출 분석 (사은품 분류 반영) (신규)
    ├── routes.py           # 매출 분석 라우트 - 350라인
    ├── services.py         # 매출 분석 로직 - 400라인
    └── forms.py            # 분석 폼 - 150라인
```

### **Phase 3: 무역 및 물류 관리**

#### **3.1 무역 관리 모듈** 🚢
```
app/trade/
├── __init__.py              # Blueprint 등록
├── order/
│   ├── routes.py           # 발주 관리 - 500라인 (핵심 모듈)
│   ├── services.py         # 발주 비즈니스 로직 - 450라인
│   └── forms.py            # 발주 폼 - 300라인
├── makeshop/
│   ├── routes.py           # 생산처 관리 - 300라인
│   ├── services.py         # 생산처 비즈니스 로직 - 250라인
│   └── forms.py            # 생산처 폼 - 150라인
├── serial/
│   ├── routes.py           # 시리얼 생성 관리 - 400라인
│   ├── services.py         # 시리얼 생성 로직 - 500라인 (핵심)
│   └── forms.py            # 시리얼 폼 - 200라인
└── demurrage/
    ├── routes.py           # 체화료 관리 - 250라인
    ├── services.py         # 체화료 비즈니스 로직 - 200라인
    └── forms.py            # 체화료 폼 - 100라인
```

#### **3.2 물류 관리 모듈** 📦
```
app/logistics/
├── __init__.py              # Blueprint 등록
├── distribution/
│   ├── routes.py           # 입출고 관리 - 350라인
│   ├── services.py         # 입출고 비즈니스 로직 - 300라인
│   └── forms.py            # 입출고 폼 - 200라인
├── container/
│   ├── routes.py           # 컨테이너 관리 - 300라인
│   ├── services.py         # 컨테이너 비즈니스 로직 - 250라인
│   └── forms.py            # 컨테이너 폼 - 150라인
├── pallet/
│   ├── routes.py           # 파렛트 관리 - 200라인
│   ├── services.py         # 파렛트 비즈니스 로직 - 150라인
│   └── forms.py            # 파렛트 폼 - 100라인
└── scheduler/
    ├── routes.py           # 스케줄 관리 - 250라인
    ├── services.py         # 스케줄 비즈니스 로직 - 200라인
    └── forms.py            # 스케줄 폼 - 150라인
```

#### **3.3 통계 관리 모듈** 📊
```
app/stats/
├── __init__.py              # Blueprint 등록
├── sales/
│   ├── routes.py           # 판매 통계 - 400라인
│   ├── services.py         # 판매 통계 로직 - 450라인
│   └── forms.py            # 통계 폼 - 150라인
├── channel/
│   ├── routes.py           # 채널별 분석 - 300라인
│   ├── services.py         # 채널 분석 로직 - 350라인
│   └── forms.py            # 채널 폼 - 100라인
├── gift/                   # 사은품 분석 (신규)
│   ├── routes.py           # 사은품 분석 라우트 - 300라인
│   ├── services.py         # 사은품 분석 로직 - 400라인
│   └── forms.py            # 사은품 분석 폼 - 100라인
└── monitoring/
    ├── routes.py           # 일일 모니터링 - 250라인
    ├── services.py         # 모니터링 로직 - 200라인
    └── forms.py            # 모니터링 폼 - 100라인
```

---

## 🎨 **템플릿 모듈화 계획** (업데이트)

### **레이아웃 템플릿**
```
app/templates/
├── base.html               # 기본 레이아웃 - 250라인 (배치 상태 표시 추가)
├── partials/
│   ├── navbar.html         # 상단 네비게이션 - 120라인 (배치 상태 포함)
│   ├── sidebar.html        # 사이드바 메뉴 - 180라인 (배치/사은품 메뉴 추가)
│   ├── pagination.html     # 페이지네이션 - 50라인
│   ├── alerts.html         # 알림 메시지 - 30라인
│   ├── breadcrumb.html     # 브레드크럼 - 30라인
│   ├── batch_status.html   # 배치 상태 표시 - 80라인 (신규)
│   └── gift_badge.html     # 사은품 뱃지 - 40라인 (신규)
└── macros/
    ├── forms.html          # 폼 매크로 - 250라인 (배치/사은품 폼 추가)
    ├── tables.html         # 테이블 매크로 - 200라인 (사은품 컬럼 추가)
    ├── buttons.html        # 버튼 매크로 - 120라인 (배치 버튼 추가)
    ├── charts.html         # 차트 매크로 - 150라인 (사은품 차트 추가)
    └── badges.html         # 뱃지 매크로 - 80라인 (신규)
```

### **기능별 템플릿** (업데이트)
```
app/templates/
├── auth/
│   ├── login.html          # 로그인 페이지 - 100라인
│   └── logout.html         # 로그아웃 페이지 - 50라인
├── admin/
│   ├── menu/               # 메뉴 관리 템플릿들
│   ├── user/               # 사용자 관리 템플릿들
│   ├── code/               # 코드 관리 템플릿들
│   ├── batch/              # 배치 관리 템플릿들 (신규)
│   │   ├── settings.html   # 배치 설정 - 300라인
│   │   ├── monitoring.html # 배치 모니터링 - 250라인
│   │   └── logs.html       # 배치 로그 - 200라인
│   ├── gift/               # 사은품 관리 템플릿들 (신규)
│   │   ├── settings.html   # 사은품 설정 - 200라인
│   │   ├── master.html     # 사은품 마스터 - 250라인
│   │   └── analytics.html  # 사은품 분석 - 300라인
│   └── company/            # 회사 관리 템플릿들 (신규)
├── customer/
│   ├── customer/           # 고객 관리 템플릿들
│   ├── as_service/         # A/S 관리 템플릿들
│   └── serial/             # 시리얼 관리 템플릿들
├── sales/
│   ├── analysis/           # 매출 분석 템플릿들 (사은품 반영)
│   └── [기타 영업 템플릿]
├── stats/
│   ├── gift/               # 사은품 통계 템플릿들 (신규)
│   └── [기타 통계 템플릿]
└── [기타 모듈별 템플릿 디렉토리]
```

---

## 📱 **JavaScript 모듈화 계획** (업데이트)

```
app/static/js/
├── common/
│   ├── main.js             # 공통 함수 - 350라인 (배치 상태 업데이트 추가)
│   ├── ajax.js             # AJAX 유틸리티 - 250라인 (배치 API 호출 추가)
│   ├── validation.js       # 폼 검증 - 300라인 (배치/사은품 검증 추가)
│   ├── datatable.js        # DataTable 설정 - 200라인 (사은품 컬럼 설정 추가)
│   └── charts.js           # 차트 공통 설정 - 150라인 (신규)
├── admin/
│   ├── menu.js             # 메뉴 관리 - 200라인
│   ├── user.js             # 사용자 관리 - 250라인
│   ├── code.js             # 코드 관리 - 150라인
│   ├── batch.js            # 배치 관리 - 400라인 (신규)
│   ├── gift.js             # 사은품 관리 - 300라인 (신규)
│   └── company.js          # 회사 관리 - 200라인 (신규)
├── customer/
│   ├── customer.js         # 고객 관리 - 200라인
│   ├── as.js               # A/S 관리 - 250라인
│   └── serial.js           # 시리얼 관리 - 300라인
├── sales/
│   ├── analysis.js         # 매출 분석 - 350라인 (사은품 분석 포함)
│   └── [기타 영업 JS]
├── stats/
│   ├── gift_analytics.js   # 사은품 분석 - 400라인 (신규)
│   └── [기타 통계 JS]
└── [기타 모듈별 JS 파일들]
```

---

## 🧪 **테스트 모듈화 계획** (업데이트)

```
tests/
├── unit/
│   ├── test_auth.py        # 인증 단위 테스트 - 200라인
│   ├── test_admin.py       # 관리자 단위 테스트 - 300라인
│   ├── test_customer.py    # 고객 단위 테스트 - 250라인
│   ├── test_common.py      # 공통 단위 테스트 - 150라인
│   ├── test_batch.py       # 배치 단위 테스트 - 350라인 (신규)
│   ├── test_gift.py        # 사은품 단위 테스트 - 300라인 (신규)
│   └── test_multitenant.py # 멀티테넌트 테스트 - 250라인 (신규)
├── integration/
│   ├── test_api.py         # API 통합 테스트 - 400라인
│   ├── test_workflow.py    # 워크플로우 테스트 - 300라인
│   ├── test_database.py    # DB 통합 테스트 - 200라인
│   ├── test_batch_flow.py  # 배치 플로우 테스트 - 300라인 (신규)
│   └── test_gift_flow.py   # 사은품 플로우 테스트 - 250라인 (신규)
└── fixtures/
    ├── sample_data.py      # 테스트 데이터 - 600라인 (배치/사은품 데이터 추가)
    ├── batch_fixtures.py   # 배치 테스트 데이터 - 200라인 (신규)
    ├── gift_fixtures.py    # 사은품 테스트 데이터 - 150라인 (신규)
    └── conftest.py         # 테스트 설정 - 250라인 (업데이트)
```

---

## 🔄 **개발 순서 및 우선순위** (업데이트)

### **1단계: 핵심 인프라 + 배치 시스템** (2-3주)
1. Flask 애플리케이션 기본 구조 생성
2. 인증 시스템 구현 (로그인/로그아웃)
3. **⚙️ 웹 기반 배치 시스템 구현** (최우선)
   - APScheduler 설정 및 통합
   - ERPia API 클라이언트 개발
   - 웹 기반 배치 설정 UI
   - 배치 모니터링 및 로그 시스템
4. 기본 레이아웃 및 공통 템플릿 작성
5. 권한 관리 시스템 구현

### **2단계: 사은품 분류 시스템** (1-2주)
1. **🎁 사은품 자동 분류 엔진 구현**
   - 0원 상품 자동 사은품 분류
   - 키워드 기반 사은품 분류
   - 사은품 마스터 관리
2. **📈 사은품 분석 시스템**
   - 사은품 부착률 분석
   - 사은품 영향도 분석
   - 사은품 비용 분석
3. 사은품 관리 웹 인터페이스

### **3단계: 관리자 시스템** (2-3주)
1. 메뉴 관리 (동적 메뉴 시스템)
2. 사용자 관리 (등록/수정/권한 설정)
3. 부서 관리
4. 코드 관리
5. **🏢 멀티테넌트 회사 관리** (신규)

### **4단계: 고객 관리 시스템** (2-3주)
1. 고객 정보 관리
2. A/S 접수 처리
3. 시리얼 검색/등록
4. 고객 타겟팅

### **5단계: 영업 관리 시스템** (3-4주)
1. 매장 관리
2. 상품 관리
3. 매장 방문 일지
4. SMS/EMAIL 발송
5. **📊 매출 분석 시스템** (사은품 분류 반영)

### **6단계: 무역 관리 시스템** (4-5주)
1. 생산처 관리
2. 발주 관리
3. **시리얼 번호 생성 시스템** (핵심)
4. 체화료 관리

### **7단계: 물류 및 통계** (3-4주)
1. 입출고 관리
2. 컨테이너/파렛트 관리
3. 스케줄 관리
4. 통계 및 보고서
5. **🎁 사은품 분석 대시보드** (신규)

---

## ⚠️ **개발 시 주의사항** (업데이트)

### **코드 품질 관리**
- **1파일 최대 500라인** 준수
- **함수 최대 50라인** 권장
- **클래스 최대 300라인** 권장
- **모듈 간 의존성 최소화**

### **성능 최적화**
- **Redis 캐시 적극 활용** (배치 설정, 사은품 분류 결과 캐싱)
- **DB 쿼리 최적화** (사은품 분류 쿼리 최적화)
- **페이지네이션 필수**
- **Ajax 비동기 처리** (배치 상태 실시간 업데이트)
- **⚙️ 배치 성능 최적화** (병렬 처리, 메모리 관리)

### **보안 고려사항**
- **CSRF 토큰 필수**
- **SQL Injection 방지**
- **XSS 방지**
- **권한 체크 데코레이터 사용**
- **🔐 멀티테넌트 데이터 격리** (회사별 데이터 접근 제어)
- **⚙️ 배치 실행 권한 관리** (배치 관리자 권한 분리)

### **멀티테넌트 고려사항** (신규)
- **회사별 데이터 격리**: 모든 쿼리에 company_id 필터 적용
- **회사별 설정 관리**: 배치 시간, 사은품 정책 등 독립 관리
- **사용자 접근 제어**: 겸직자 지원, 회사 전환 기능
- **데이터 공유 정책**: 필요시 회사 간 데이터 공유 로직

---

## ✅ **다음 단계 제안** (업데이트)

**우선순위 1: Flask 애플리케이션 기본 구조 + 배치 시스템 구현**
1. Flask 앱 팩토리 패턴 구현
2. Blueprint 기본 구조 생성 (배치/사은품 모듈 포함)
3. 기본 라우트 및 템플릿 작성
4. 인증 시스템 구현
5. **⚙️ APScheduler 통합 및 웹 기반 배치 시스템 구현**
6. **🎁 사은품 자동 분류 엔진 구현**

**우선순위 2: 핵심 비즈니스 로직 구현**
- ERPia API 클라이언트 개발
- 사은품 분류 및 분석 시스템
- 멀티테넌트 회사 관리
- 배치 모니터링 시스템

**준비되면 진행할 작업:**
- 관리자 시스템 구현
- 고객 관리 시스템 구현
- 단위 테스트 작성
- 통합 테스트 환경 구축

**🚀 이제 웹 기반 배치 시스템과 사은품 자동 분류가 포함된 Flask 애플리케이션 개발을 시작할 준비가 완료되었습니다!** 