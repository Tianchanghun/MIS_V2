# 📋 내일 할 일 - 2025년 8월 7일 (업데이트됨)

## ✅ **완료된 작업**

### **1️⃣ 관리자 영역 사용자 관리 기능 구현** ✅ **완료**
**현재 상태**: 100% 완료 ✅  
**목표**: 완전한 사용자 CRUD 기능 구현

#### **완료된 세부 작업**
- [x] **사용자 목록 API** - `GET /admin/api/users` ✅
  - 회사별 사용자 필터링 완료
  - 페이징, 검색 기능 완료
  - 부서, 직급 정보 포함 완료

- [x] **사용자 생성 API** - `POST /admin/api/users` ✅
  - 필수 정보: ID, 이름, 비밀번호, 부서, 직급 완료
  - 중복 ID 검증 완료
  - 멀티테넌트 지원 (company_id) 완료

- [x] **사용자 수정 API** - `PUT /admin/api/users/{user_id}` ✅
  - 기본 정보 수정 완료
  - 비밀번호 변경 (별도 API) 완료
  - 부서/직급 변경 완료

- [x] **사용자 삭제 API** - `DELETE /admin/api/users/{user_id}` ✅
  - 소프트 삭제 (member_status = 'D') 완료
  - 관련 권한 정보 정리 완료

- [x] **UI 완성** - `/admin/user_management` ✅
  - 부서 연동 기능 (회사별 필터링) 완료
  - DataTable 연동 완료
  - 모달 창으로 생성/수정 폼 완료

### **2️⃣ 부서 관리 기능 구현** ✅ **완료**
- [x] 부서 CRUD API 완전 구현 ✅
- [x] 회사별 부서 필터링 ✅
- [x] 사용자 관리와 부서 연동 ✅

### **3️⃣ 회사 전환 기능** ✅ **완료**
- [x] 좌측 회사 셀렉트박스 오류 수정 ✅
- [x] 실시간 부서 목록 업데이트 ✅

### **4️⃣ 로고 클릭 메인 이동 기능** ✅ **완료**
- [x] 좌측 상단 로고 클릭 시 메인 페이지 이동 ✅
- [x] 호버 효과 추가 ✅

---

## 🚨 **현재 최우선 작업**

### **1️⃣ 배치 설정 기능 전체 테스트**
**현재 상태**: 90% 완료 (구현 완료, 테스트 필요)  
**목표**: 모든 배치 기능 정상 동작 확인

#### **세부 테스트**
- [ ] **ERPia 연결 테스트**
  - `/batch/settings` 연결 테스트 버튼 클릭
  - 에이원 계정 연결 확인
  - 연결 상태 표시 확인

- [ ] **수동 배치 실행 테스트**
  - 4개월 자동 날짜 설정 확인
  - ERPia 데이터 수집 확인
  - DB 저장 (UPSERT) 동작 확인

- [ ] **DB 저장 검증**
  - `ErpiaOrderMaster` 테이블 데이터 확인
  - `SalesAnalysisMaster` 테이블 데이터 확인
  - Sl_No 기준 UPDATE 동작 확인

- [ ] **배치 로그 확인**
  - `erpia_batch_logs` 테이블 기록 확인
  - `admin_code` 필드 저장 확인
  - 성공/실패 상태 정확성 확인

- [ ] **회사별 설정 분리**
  - 에이원/에이원월드 설정 독립 확인
  - 회사 전환 시 설정 변경 확인

**예상 소요 시간**: 2-3시간

---

## 📅 **추후 진행 예정 작업**

### **🔮 권한 관리 기능 구현** ⏳ **추후 진행**
**현재 상태**: 20% 완료 (기본 UI만 존재, 기능 없음)  
**목표**: 메뉴별 사용자/부서 권한 완전 관리

#### **추후 진행할 세부 작업**
- [ ] **권한 조회 API** - `GET /admin/api/permissions`
  - 사용자별 메뉴 권한 조회
  - 부서별 메뉴 권한 조회
  - 권한 매트릭스 형태 반환

- [ ] **사용자 권한 설정 API** - `POST /admin/api/permissions/user`
  - 메뉴별 CRUD 권한 설정
  - `tbl_memberauth` 테이블 관리
  - 일괄 권한 변경 지원

- [ ] **부서 권한 설정 API** - `POST /admin/api/permissions/department`
  - 부서별 메뉴 권한 설정
  - `tbl_deptauth` 테이블 관리
  - 상속 권한 로직

- [ ] **UI 완성** - `/admin/permissions`
  - `@mis.aone.co.kr` 참조하여 권한 매트릭스 UI
  - 사용자/부서 탭 분리
  - 체크박스 기반 권한 설정

**예상 소요 시간**: 6-8시간

### **🔮 메뉴 관리 기능 구현** ⏳ **추후 진행**
**현재 상태**: 기본 CRUD API 구현됨, UI 개선 필요  
**목표**: 레거시 시스템과 동일한 계층형 메뉴 관리

#### **추후 진행할 세부 작업**
- [ ] **메뉴 트리 구조 UI 개선**
  - 계층형 메뉴 표시
  - 드래그앤드롭 정렬 기능
  - 메뉴 아이콘 선택기

- [ ] **메뉴 권한 연동**
  - 메뉴별 접근 권한 설정
  - 사용자별 메뉴 표시/숨김

**예상 소요 시간**: 4-6시간

---

## ⚠️ **알려진 이슈 해결**

### **배치 스케줄러 오류 수정**
```
❌ 스케줄러 시작 실패: 'NoneType' object has no attribute 'start'
❌ 작업 목록 조회 실패: 'NoneType' object has no attribute 'get_jobs'
```
- **파일**: `app/services/batch_scheduler.py`
- **원인**: APScheduler 객체 초기화 문제
- **우선순위**: 중간 (배치 테스트 시 함께 해결)

---

## 📋 **작업 진행 체크리스트**

### **사용자 관리 기능** ✅ **완료**
- [x] 사용자 목록 조회 API 구현 ✅
- [x] 사용자 생성 API 구현 ✅
- [x] 사용자 수정 API 구현 ✅
- [x] 사용자 삭제 API 구현 ✅
- [x] 사용자 관리 UI 완성 ✅
- [x] 기능 테스트 완료 ✅

### **부서 관리 기능** ✅ **완료**
- [x] 부서 CRUD API 구현 ✅
- [x] 회사별 부서 필터링 ✅
- [x] 사용자-부서 연동 ✅

### **배치 시스템 테스트** 🔄 **진행 중**
- [ ] ERPia 연결 테스트
- [ ] 수동 배치 실행 테스트
- [ ] 4개월 데이터 수집 확인
- [ ] DB 저장 (UPSERT) 확인
- [ ] 배치 로그 기록 확인
- [ ] 회사별 설정 분리 확인

### **권한 관리 기능** ⏳ **추후 진행**
- [ ] 권한 조회 API 구현
- [ ] 사용자 권한 설정 API 구현
- [ ] 부서 권한 설정 API 구현
- [ ] 권한 관리 UI 완성
- [ ] 권한 매트릭스 표시
- [ ] 기능 테스트 완료

### **메뉴 관리 기능** ⏳ **추후 진행**
- [ ] 메뉴 트리 구조 UI 개선
- [ ] 메뉴 권한 연동 구현
- [ ] 기능 테스트 완료

---

## 🎯 **성공 기준**

### **사용자 관리** ✅ **달성**
- ✅ `/admin/user_management`에서 사용자 생성/수정/삭제 가능
- ✅ 멀티테넌트 지원 (회사별 사용자 분리)
- ✅ 부서 연동 기능 (회사별 필터링)

### **배치 시스템** 🎯 **목표**
- ✅ ERPia 연결 테스트 성공
- ✅ 4개월 매출 데이터 수집 성공
- ✅ DB에 데이터 정상 저장 (신규/업데이트)
- ✅ 배치 로그에 `admin_code` 기록

### **권한 관리** ⏳ **추후 목표**
- ⏳ `/admin/permissions`에서 메뉴별 권한 설정 가능
- ⏳ 사용자별/부서별 권한 매트릭스 표시
- ⏳ 권한 변경 즉시 반영

### **메뉴 관리** ⏳ **추후 목표**
- ⏳ 계층형 메뉴 구조 관리
- ⏳ 메뉴별 권한 연동

---

## ⏰ **수정된 일정**

|| 시간 | 작업 내용 |
||------|-----------|
|| 현재-15:00 | **배치 시스템 전체 테스트** (2시간) |
|| 15:00-16:00 | 배치 스케줄러 오류 수정 (1시간) |
|| 16:00-17:00 | 추가 버그 수정 및 안정화 (1시간) |

**현재 우선순위**: 🚨 **배치 시스템 테스트 완료 최우선**

**추후 진행 예정**: 권한 관리 (6-8시간) → 메뉴 관리 (4-6시간)

---

## 📚 **참조 자료**

- **레거시 시스템**: `@mis.aone.co.kr` 사용자/권한 관리 화면
- **데이터베이스**: `tbl_member`, `tbl_memberauth`, `tbl_deptauth` 스키마
- **ERPia 설정**: `docs/06_ERPia_API_완전_가이드.md`
- **멀티테넌트**: `docs/07_멀티_테넌트_시스템_설계.md`

---

**작성일**: 2025년 8월 7일  
**작성자**: AI Assistant  
**업데이트**: 권한 관리, 메뉴 관리 → 추후 진행으로 변경  
**현재 우선순위**: 🚨 **배치 시스템 테스트 완료 최우선** 