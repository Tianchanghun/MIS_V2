# 📋 내일 할 일 - 2025년 8월 7일

## 🚨 **최우선 작업 (반드시 완료)**

### **1️⃣ 관리자 영역 사용자 관리 기능 구현**
**현재 상태**: 30% 완료 (기본 UI만 존재, 기능 없음)  
**목표**: 완전한 사용자 CRUD 기능 구현

#### **세부 작업**
- [ ] **사용자 목록 API** - `GET /admin/api/users`
  - 회사별 사용자 필터링
  - 페이징, 검색 기능
  - 부서, 직급 정보 포함

- [ ] **사용자 생성 API** - `POST /admin/api/users`
  - 필수 정보: ID, 이름, 비밀번호, 부서, 직급
  - 중복 ID 검증
  - 멀티테넌트 지원 (company_id)

- [ ] **사용자 수정 API** - `PUT /admin/api/users/{user_id}`
  - 기본 정보 수정
  - 비밀번호 변경 (별도 API)
  - 부서/직급 변경

- [ ] **사용자 삭제 API** - `DELETE /admin/api/users/{user_id}`
  - 소프트 삭제 (member_status = 'D')
  - 관련 권한 정보 정리

- [ ] **UI 완성** - `/admin/user_management`
  - `@mis.aone.co.kr` 참조하여 동일한 UI 구현
  - DataTable 연동
  - 모달 창으로 생성/수정 폼

**예상 소요 시간**: 4-6시간

---

### **2️⃣ 관리자 영역 권한 관리 기능 구현**
**현재 상태**: 20% 완료 (기본 UI만 존재, 기능 없음)  
**목표**: 메뉴별 사용자/부서 권한 완전 관리

#### **세부 작업**
- [ ] **권한 조회 API** - `GET /admin/api/permissions`
  - 사용자별 메뉴 권한 조회
  - 부서별 메뉴 권한 조회
  - 권한 매트릭스 형태 반환

- [ ] **사용자 권한 설정 API** - `POST /admin/api/permissions/user`
  - 메뉴별 CRUD 권한 설정
  - `tbl_memberauth` 테이블 관리
  - 일괄 권한 변경 지원

- [ ] **부서 권한 설정 API** - `POST /admin/api/permissions/department`
  - 부서별 메뉴 권한 설정
  - `tbl_deptauth` 테이블 관리
  - 상속 권한 로직

- [ ] **UI 완성** - `/admin/permissions`
  - `@mis.aone.co.kr` 참조하여 권한 매트릭스 UI
  - 사용자/부서 탭 분리
  - 체크박스 기반 권한 설정

**예상 소요 시간**: 6-8시간

---

### **3️⃣ 배치 설정 기능 전체 테스트**
**현재 상태**: 90% 완료 (구현 완료, 테스트 필요)  
**목표**: 모든 배치 기능 정상 동작 확인

#### **세부 테스트**
- [ ] **ERPia 연결 테스트**
  - `/batch/settings` 연결 테스트 버튼 클릭
  - 에이원 계정 연결 확인
  - 연결 상태 표시 확인

- [ ] **수동 배치 실행 테스트**
  - 4개월 자동 날짜 설정 확인
  - ERPia 데이터 수집 확인
  - DB 저장 (UPSERT) 동작 확인

- [ ] **DB 저장 검증**
  - `ErpiaOrderMaster` 테이블 데이터 확인
  - `SalesAnalysisMaster` 테이블 데이터 확인
  - Sl_No 기준 UPDATE 동작 확인

- [ ] **배치 로그 확인**
  - `erpia_batch_logs` 테이블 기록 확인
  - `admin_code` 필드 저장 확인
  - 성공/실패 상태 정확성 확인

- [ ] **회사별 설정 분리**
  - 에이원/에이원월드 설정 독립 확인
  - 회사 전환 시 설정 변경 확인

**예상 소요 시간**: 2-3시간

---

## ⚠️ **알려진 이슈 해결**

### **배치 스케줄러 오류 수정**
```
❌ 스케줄러 시작 실패: 'NoneType' object has no attribute 'start'
```
- **파일**: `app/services/batch_scheduler.py`
- **원인**: APScheduler 객체 초기화 문제
- **우선순위**: 중간 (배치 테스트 시 함께 해결)

---

## 📋 **작업 진행 체크리스트**

### **사용자 관리 기능**
- [ ] 사용자 목록 조회 API 구현
- [ ] 사용자 생성 API 구현  
- [ ] 사용자 수정 API 구현
- [ ] 사용자 삭제 API 구현
- [ ] 사용자 관리 UI 완성
- [ ] 기능 테스트 완료

### **권한 관리 기능**  
- [ ] 권한 조회 API 구현
- [ ] 사용자 권한 설정 API 구현
- [ ] 부서 권한 설정 API 구현
- [ ] 권한 관리 UI 완성
- [ ] 권한 매트릭스 표시
- [ ] 기능 테스트 완료

### **배치 시스템 테스트**
- [ ] ERPia 연결 테스트
- [ ] 수동 배치 실행 테스트
- [ ] 4개월 데이터 수집 확인
- [ ] DB 저장 (UPSERT) 확인
- [ ] 배치 로그 기록 확인
- [ ] 회사별 설정 분리 확인

---

## 🎯 **성공 기준**

### **사용자 관리**
- ✅ `/admin/user_management`에서 사용자 생성/수정/삭제 가능
- ✅ 레거시 `@mis.aone.co.kr`와 동일한 UI/기능
- ✅ 멀티테넌트 지원 (회사별 사용자 분리)

### **권한 관리**
- ✅ `/admin/permissions`에서 메뉴별 권한 설정 가능
- ✅ 사용자별/부서별 권한 매트릭스 표시
- ✅ 권한 변경 즉시 반영

### **배치 시스템**
- ✅ ERPia 연결 테스트 성공
- ✅ 4개월 매출 데이터 수집 성공
- ✅ DB에 데이터 정상 저장 (신규/업데이트)
- ✅ 배치 로그에 `admin_code` 기록

---

## ⏰ **예상 일정**

| 시간 | 작업 내용 |
|------|-----------|
| 09:00-12:00 | 사용자 관리 API 구현 (3시간) |
| 13:00-17:00 | 사용자 관리 UI 완성 (4시간) |
| 17:00-19:00 | 권한 관리 API 구현 (2시간) |
| 19:00-21:00 | 권한 관리 UI 완성 (2시간) |
| 21:00-22:00 | 배치 시스템 전체 테스트 (1시간) |

**총 예상 시간**: 약 12시간

---

## 📚 **참조 자료**

- **레거시 시스템**: `@mis.aone.co.kr` 사용자/권한 관리 화면
- **데이터베이스**: `tbl_member`, `tbl_memberauth`, `tbl_deptauth` 스키마
- **ERPia 설정**: `docs/06_ERPia_API_완전_가이드.md`
- **멀티테넌트**: `docs/07_멀티_테넌트_시스템_설계.md`

---

**작성일**: 2025년 8월 6일  
**작성자**: AI Assistant  
**우선순위**: 🚨 **최긴급** - 3,4항목 완료 전까지 다른 작업 금지 