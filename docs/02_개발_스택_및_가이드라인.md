# ğŸ› ï¸ **MIS v2 ê°œë°œ ìŠ¤íƒ ë° ê°€ì´ë“œë¼ì¸** (ìœ ì§€ë³´ìˆ˜ ìµœì í™”)

## ğŸ“‹ **ëª©ì°¨**
1. [ê¸°ìˆ  ìŠ¤íƒ](#ê¸°ìˆ -ìŠ¤íƒ)
2. [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
3. [ê°œë°œ í™˜ê²½](#ê°œë°œ-í™˜ê²½)
4. [UI/UX ê°€ì´ë“œë¼ì¸](#uiux-ê°€ì´ë“œë¼ì¸)
5. [ì½”ë”© ì»¨ë²¤ì…˜](#ì½”ë”©-ì»¨ë²¤ì…˜)
6. [í”„ë¡œì íŠ¸ êµ¬ì¡°](#í”„ë¡œì íŠ¸-êµ¬ì¡°)
7. [ë³´ì•ˆ ê°€ì´ë“œë¼ì¸](#ë³´ì•ˆ-ê°€ì´ë“œë¼ì¸)
8. [ë°°ì¹˜ ë° ìŠ¤ì¼€ì¤„ë§](#ë°°ì¹˜-ë°-ìŠ¤ì¼€ì¤„ë§)
9. [ì‚¬ì€í’ˆ ë¶„ë¥˜ ì‹œìŠ¤í…œ](#ì‚¬ì€í’ˆ-ë¶„ë¥˜-ì‹œìŠ¤í…œ)

---

## ğŸ”§ **ê¸°ìˆ  ìŠ¤íƒ** (ìœ ì§€ë³´ìˆ˜ ì¤‘ì‹¬)

### **ë°±ì—”ë“œ** ğŸ
- **í”„ë ˆì„ì›Œí¬**: Flask 3.0
- **ORM**: SQLAlchemy 2.0 (Flask-SQLAlchemy)
- **ì¸ì¦**: Flask-Login + Session ê¸°ë°˜
- **í¼ ì²˜ë¦¬**: Flask-WTF + WTForms
- **API**: RESTful API (JSON ì‘ë‹µ)
- **ë¡œê¹…**: Python logging + colorlog
- **ìºì‹œ**: Redis 7.0 (ì„¸ì…˜, ë°ì´í„° ìºì‹±)
- **âš™ï¸ ìŠ¤ì¼€ì¤„ëŸ¬**: APScheduler 3.10 (ì›¹ ê¸°ë°˜ ë°°ì¹˜ ê´€ë¦¬)
- **ğŸ ë°ì´í„° ë¶„ë¥˜**: pandas 2.0 (ì‚¬ì€í’ˆ ìë™ ë¶„ë¥˜)

### **í”„ë¡ íŠ¸ì—”ë“œ** ğŸ¨ (ë‹¨ìˆœí•˜ê³  ì•ˆì •ì )
- **í…œí”Œë¦¿ ì—”ì§„**: Jinja2 (Flask ê¸°ë³¸)
- **CSS í”„ë ˆì„ì›Œí¬**: Bootstrap 5.3 (í•™ìŠµê³¡ì„  ë‚®ìŒ)
- **JavaScript**: Vanilla JS + jQuery 3.7 (ê°„ë‹¨í•˜ê³  ì•ˆì •ì )
- **ì°¨íŠ¸**: Chart.js 4.0 (ë¬¸ì„œí™” ìš°ìˆ˜)
- **ì•„ì´ì½˜**: Bootstrap Icons + Font Awesome
- **í…Œì´ë¸”**: DataTables.js (í•œêµ­ì–´ ì§€ì›)
- **ğŸ“Š ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸**: WebSocket (Flask-SocketIO) (ë°°ì¹˜ ìƒíƒœ ëª¨ë‹ˆí„°ë§)

### **ë°ì´í„°ë² ì´ìŠ¤** ğŸ—„ï¸
- **ë©”ì¸ DB**: PostgreSQL 15
- **ìºì‹œ DB**: Redis 7.0 (ì„¸ì…˜, ì„ì‹œ ë°ì´í„°)
- **ì—°ê²°**: psycopg2-binary, redis-py
- **ë§ˆì´ê·¸ë ˆì´ì…˜**: Alembic (Flask-Migrate)
- **ë°±ì—…**: pg_dump + redis-cli ìë™í™”

### **ê°œë°œ ë„êµ¬** âš™ï¸
- **ì»¨í…Œì´ë„ˆ**: Docker + Docker Compose
- **ì½”ë“œ í’ˆì§ˆ**: Black (í¬ë§¤í„°) + Flake8 (ë¦°í„°)
- **í…ŒìŠ¤íŠ¸**: pytest + pytest-flask
- **ì˜ì¡´ì„± ê´€ë¦¬**: requirements.txt
- **í™˜ê²½ ë³€ìˆ˜**: python-dotenv
- **ğŸ“‹ ìŠ¤ì¼€ì¤„ë§**: APScheduler + Cron í‘œí˜„ì‹
- **ğŸ” ë¡œê·¸ ë¶„ì„**: ELK Stack (ì„ íƒì‚¬í•­)

---

## ğŸ—ï¸ **ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜** (í™•ì¥ì„± ê³ ë ¤)

### **ì „ì²´ êµ¬ì¡°** (ì—…ë°ì´íŠ¸)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ë¸Œë¼ìš°ì €        â”‚â—„â”€â”€â–ºâ”‚   Flask App     â”‚â—„â”€â”€â–ºâ”‚  PostgreSQL     â”‚
â”‚  (UI/UX)        â”‚    â”‚  (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)   â”‚    â”‚   (ë©”ì¸ ë°ì´í„°)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚                       â”‚
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   Redis Cache   â”‚    â”‚   ë ˆê±°ì‹œ MS-SQL  â”‚
                       â”‚  (ì„¸ì…˜, ìºì‹œ)     â”‚    â”‚   (ì½ê¸° ì „ìš©)     â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚  APScheduler    â”‚    â”‚   ERPia API     â”‚
                       â”‚ (ì›¹ ê¸°ë°˜ ë°°ì¹˜)    â”‚    â”‚ (XML ë°ì´í„° ìˆ˜ì§‘) â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚ Gift Classifier â”‚
                       â”‚ (ì‚¬ì€í’ˆ ìë™ë¶„ë¥˜) â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **ë ˆì´ì–´ êµ¬ì¡°**
1. **Presentation Layer**: Jinja2 Templates + Bootstrap CSS
2. **Controller Layer**: Flask Blueprints + Routes
3. **Service Layer**: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì²˜ë¦¬ + ë°°ì¹˜ ê´€ë¦¬ + ì‚¬ì€í’ˆ ë¶„ë¥˜
4. **Data Layer**: SQLAlchemy Models + Redis Cache
5. **Infrastructure Layer**: PostgreSQL + Redis + External APIs
6. **âš™ï¸ Scheduling Layer**: APScheduler + ì›¹ ë°°ì¹˜ ê´€ë¦¬ (ì‹ ê·œ ì¶”ê°€)
7. **ğŸ Classification Layer**: ì‚¬ì€í’ˆ ìë™ ë¶„ë¥˜ ì—”ì§„ (ì‹ ê·œ ì¶”ê°€)

---

## ğŸ’» **ê°œë°œ í™˜ê²½**

### **ë¡œì»¬ ê°œë°œ í™˜ê²½**
```bash
# Docker í™˜ê²½
- PostgreSQL: localhost:5432
- Redis: localhost:6379
- pgAdmin: localhost:5050
- Flask App: localhost:5000

# Python í™˜ê²½
- Python 3.11+
- Virtual Environment ì‚¬ìš© ê¶Œì¥
```

### **í™˜ê²½ ë³€ìˆ˜ ì„¤ì •** (ì—…ë°ì´íŠ¸)
```env
# .env íŒŒì¼
FLASK_ENV=development
FLASK_DEBUG=1
DATABASE_URL=postgresql://mis_user:mis123!@#@localhost:5432/db_mis
REDIS_URL=redis://localhost:6379/0
SECRET_KEY=your-secret-key-here
SESSION_TYPE=redis
LEGACY_DB_CONNECTION=DRIVER={ODBC Driver 17 for SQL Server};SERVER=210.109.96.74,2521;DATABASE=db_mis;UID=user_mis;PWD=user_mis!@12;ApplicationIntent=ReadOnly;

# ë°°ì¹˜ ê´€ë¦¬ ì„¤ì • (ì‹ ê·œ ì¶”ê°€)
BATCH_SCHEDULER_ENABLED=true
BATCH_DEFAULT_HOUR=2
BATCH_DEFAULT_MINUTE=0
BATCH_MAX_RETRY=3

# ERPia API ì„¤ì • (ì‹ ê·œ ì¶”ê°€)
ERPIA_API_URL=http://www.erpia.net/xml/xml.asp
ERPIA_DEFAULT_INTERVAL=3
ERPIA_DEFAULT_PAGE_SIZE=30
ERPIA_TIMEOUT=30

# ì‚¬ì€í’ˆ ë¶„ë¥˜ ì„¤ì • (ì‹ ê·œ ì¶”ê°€)
GIFT_AUTO_CLASSIFY=true
GIFT_DEFAULT_KEYWORDS=ì‚¬ì€í’ˆ,ì¦ì •í’ˆ,ë¬´ë£Œ,ìƒ˜í”Œ,ì²´í—˜
GIFT_EXCLUDE_FROM_REVENUE=true
```

---

## ğŸ¨ **UI/UX ê°€ì´ë“œë¼ì¸** (Bootstrap ì¤‘ì‹¬)

### **ë””ìì¸ ì‹œìŠ¤í…œ**

#### **ì»¬ëŸ¬ íŒ”ë ˆíŠ¸** ğŸ¨ (Bootstrap ê¸°ë³¸ + ë¸Œëœë“œ)
```css
/* Bootstrap ê¸°ë³¸ ìƒ‰ìƒ (ìœ ì§€ë³´ìˆ˜ ìš©ì´) */
--primary-color: #0d6efd;      /* Bootstrap Blue */
--secondary-color: #6c757d;    /* Bootstrap Gray */
--success-color: #198754;      /* Bootstrap Green */
--danger-color: #dc3545;       /* Bootstrap Red */
--warning-color: #ffc107;      /* Bootstrap Yellow */
--info-color: #0dcaf0;         /* Bootstrap Cyan */

/* MIS ë¸Œëœë“œ ìƒ‰ìƒ (íšŒì‚¬ íŠ¹í™”) */
--brand-primary: #1e3a8a;      /* ì§„í•œ íŒŒë‘ (ì‹ ë¢°ê°) */
--brand-secondary: #3b82f6;    /* ë°ì€ íŒŒë‘ (í™œë™ì„±) */
--brand-accent: #ef4444;       /* í¬ì¸íŠ¸ ë¹¨ê°• (ê°•ì¡°) */
--brand-success: #10b981;      /* ì„±ê³µ ì´ˆë¡ */

/* ì‚¬ì€í’ˆ ì‹œìŠ¤í…œ ìƒ‰ìƒ (ì‹ ê·œ ì¶”ê°€) */
--gift-primary: #f59e0b;       /* ì‚¬ì€í’ˆ ì£¼í™© */
--gift-secondary: #fbbf24;     /* ì‚¬ì€í’ˆ ì—°í•œ ì£¼í™© */
--revenue-primary: #059669;    /* ë§¤ì¶œ ì´ˆë¡ */
--batch-primary: #7c3aed;      /* ë°°ì¹˜ ë³´ë¼ */

/* ë°°ê²½ ìƒ‰ìƒ (ê¹”ë”í•¨) */
--bg-light: #f8fafc;          /* ì—°í•œ íšŒìƒ‰ */
--bg-dark: #1e293b;           /* ë‹¤í¬ ëª¨ë“œ */
--bg-card: #ffffff;           /* ì¹´ë“œ ë°°ê²½ */
--border-color: #e2e8f0;      /* í…Œë‘ë¦¬ */
```

#### **íƒ€ì´í¬ê·¸ë˜í”¼** âœï¸ (í•œêµ­ì–´ ìµœì í™”)
```css
/* í°íŠ¸ ìŠ¤íƒ (í•œêµ­ì–´ ìš°ì„ ) */
font-family: 'Noto Sans KR', 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;

/* í°íŠ¸ í¬ê¸° (16px ê¸°ì¤€) */
--font-size-xs: 0.75rem;    /* 12px - ì‘ì€ í…ìŠ¤íŠ¸ */
--font-size-sm: 0.875rem;   /* 14px - ë³´ì¡° í…ìŠ¤íŠ¸ */
--font-size-base: 1rem;     /* 16px - ê¸°ë³¸ í…ìŠ¤íŠ¸ */
--font-size-lg: 1.125rem;   /* 18px - ê°•ì¡° í…ìŠ¤íŠ¸ */
--font-size-xl: 1.25rem;    /* 20px - ë¶€ì œëª© */

/* ì œëª© í¬ê¸° (ê°€ë…ì„± ì¤‘ì‹¬) */
h1: 2.25rem (36px) - í˜ì´ì§€ ì œëª©
h2: 1.875rem (30px) - ì„¹ì…˜ ì œëª©
h3: 1.5rem (24px) - ì„œë¸Œ ì„¹ì…˜
h4: 1.25rem (20px) - ì¹´ë“œ ì œëª©
h5: 1.125rem (18px) - ì‘ì€ ì œëª©
h6: 1rem (16px) - ë ˆì´ë¸”
```

#### **ê°„ê²© ì‹œìŠ¤í…œ** ğŸ“ (Bootstrap í‘œì¤€)
```css
/* Bootstrap ê°„ê²© ì‹œìŠ¤í…œ (0.25rem = 4px) */
--spacing-0: 0;
--spacing-1: 0.25rem;  /* 4px */
--spacing-2: 0.5rem;   /* 8px */
--spacing-3: 1rem;     /* 16px */
--spacing-4: 1.5rem;   /* 24px */
--spacing-5: 3rem;     /* 48px */

/* ì»¤ìŠ¤í…€ ê°„ê²© (MIS ì „ìš©) */
--content-padding: 1.5rem;     /* ì¹´ë“œ ë‚´ë¶€ íŒ¨ë”© */
--section-margin: 2rem;        /* ì„¹ì…˜ ê°„ ì—¬ë°± */
--form-spacing: 1rem;          /* í¼ ìš”ì†Œ ê°„ê²© */
```

### **ì‹ ê·œ ì»´í¬ë„ŒíŠ¸ ê°€ì´ë“œë¼ì¸**

#### **ë°°ì¹˜ ìƒíƒœ í‘œì‹œ** âš™ï¸
```html
<!-- ë°°ì¹˜ ìƒíƒœ ì¹´ë“œ -->
<div class="card border-batch">
    <div class="card-header bg-batch text-white">
        <h6 class="card-title mb-0">
            <i class="bi bi-clock"></i> ERPia ë°°ì¹˜ ìƒíƒœ
        </h6>
    </div>
    <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
            <span>ë‹¤ìŒ ì‹¤í–‰</span>
            <span class="badge bg-info">02:00 (ìë™)</span>
        </div>
        <div class="d-flex justify-content-between align-items-center mt-2">
            <span>ë§ˆì§€ë§‰ ì‹¤í–‰</span>
            <span class="text-success">ì„±ê³µ (2ì‹œê°„ ì „)</span>
        </div>
    </div>
</div>

<!-- ë°°ì¹˜ ì„¤ì • í¼ -->
<div class="row">
    <div class="col-md-4">
        <label class="form-label">ë°°ì¹˜ ì‹¤í–‰ ì‹œê°„</label>
        <input type="time" class="form-control" name="batch_time" value="02:00">
    </div>
    <div class="col-md-4">
        <label class="form-label">í˜¸ì¶œ ê°„ê²© (ì´ˆ)</label>
        <input type="number" class="form-control" name="api_interval" 
               value="3" min="1" max="60">
    </div>
    <div class="col-md-4">
        <label class="form-label">í˜ì´ì§€ í¬ê¸°</label>
        <input type="number" class="form-control" name="page_size" 
               value="30" min="1" max="30">
    </div>
</div>
```

#### **ì‚¬ì€í’ˆ í‘œì‹œ** ğŸ
```html
<!-- ì‚¬ì€í’ˆ í‘œì‹œ ë±ƒì§€ -->
<span class="badge bg-gift me-1">
    <i class="bi bi-gift"></i> ì‚¬ì€í’ˆ
</span>

<!-- ë§¤ì¶œ/ì‚¬ì€í’ˆ êµ¬ë¶„ í…Œì´ë¸” -->
<table class="table table-striped">
    <thead>
        <tr>
            <th>ìƒí’ˆëª…</th>
            <th>ìˆ˜ëŸ‰</th>
            <th>ë‹¨ê°€</th>
            <th>ë¶„ë¥˜</th>
            <th>ë§¤ì¶œ ë°˜ì˜</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>NUNA ì¹´ì‹œíŠ¸</td>
            <td>1</td>
            <td>450,000ì›</td>
            <td><span class="badge bg-revenue">ë§¤ì¶œìƒí’ˆ</span></td>
            <td><i class="bi bi-check-circle text-success"></i></td>
        </tr>
        <tr class="table-warning">
            <td>ì‚¬ì€í’ˆ íŒ¨ë“œ</td>
            <td>1</td>
            <td>0ì›</td>
            <td><span class="badge bg-gift">ì‚¬ì€í’ˆ</span></td>
            <td><i class="bi bi-x-circle text-danger"></i></td>
        </tr>
    </tbody>
</table>

<!-- ì‚¬ì€í’ˆ ë¶„ì„ ì°¨íŠ¸ -->
<div class="card">
    <div class="card-header">
        <h5 class="card-title">
            <i class="bi bi-pie-chart"></i> ì‚¬ì€í’ˆ ë¶€ì°©ë¥  ë¶„ì„
        </h5>
    </div>
    <div class="card-body">
        <canvas id="giftAttachmentChart" width="400" height="200"></canvas>
    </div>
</div>
```

### **ë ˆì´ì•„ì›ƒ êµ¬ì¡°** (ê´€ë¦¬ì ì‹œìŠ¤í…œ ìµœì í™”)

#### **ê¸°ë³¸ ë ˆì´ì•„ì›ƒ** (ì‚¬ì´ë“œë°” + ë©”ì¸) - ì—…ë°ì´íŠ¸
```html
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIS v2 - {{ page_title }}</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <!-- ì»¤ìŠ¤í…€ CSS -->
    <link href="{{ url_for('static', filename='css/main.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/batch.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/gift.css') }}" rel="stylesheet">
</head>
<body>
    <!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ (ê³ ì •) -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-brand-primary fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <i class="bi bi-building"></i> MIS v2
            </a>
            
            <!-- ë°°ì¹˜ ìƒíƒœ í‘œì‹œ (ì‹ ê·œ) -->
            <div class="navbar-nav me-auto">
                <div class="nav-item">
                    <span class="navbar-text">
                        <i class="bi bi-clock"></i>
                        <span id="batchStatus" class="badge bg-success">ë°°ì¹˜ ì •ìƒ</span>
                    </span>
                </div>
            </div>
            
            <!-- ì‚¬ìš©ì ì •ë³´ -->
            <div class="navbar-nav ms-auto">
                <span class="navbar-text me-3">{{ current_user.name }}ë‹˜</span>
                <a class="nav-link" href="/logout">ë¡œê·¸ì•„ì›ƒ</a>
            </div>
        </div>
    </nav>
    
    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="container-fluid" style="margin-top: 56px;">
        <div class="row">
            <!-- ì‚¬ì´ë“œë°” (ê³ ì •) -->
            <nav class="col-md-2 col-lg-2 sidebar bg-light">
                <div class="sidebar-sticky">
                    {% include 'partials/sidebar.html' %}
                </div>
            </nav>
            
            <!-- ë©”ì¸ ì»¨í…ì¸  -->
            <main class="col-md-10 col-lg-10 main-content">
                <!-- ë¸Œë ˆë“œí¬ëŸ¼ -->
                <nav aria-label="breadcrumb" class="mt-3">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="/">í™ˆ</a></li>
                        {% block breadcrumb %}{% endblock %}
                    </ol>
                </nav>
                
                <!-- í˜ì´ì§€ í—¤ë” -->
                <div class="page-header d-flex justify-content-between align-items-center mb-4">
                    <h1 class="h2">{% block page_title %}{% endblock %}</h1>
                    <div class="btn-group">
                        {% block page_actions %}{% endblock %}
                    </div>
                </div>
                
                <!-- ì•Œë¦¼ ë©”ì‹œì§€ -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
                
                <!-- ì»¨í…ì¸  ì˜ì—­ -->
                <div class="content">
                    {% block content %}{% endblock %}
                </div>
            </main>
        </div>
    </div>
    
    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/batch.js') }}"></script>
    <script src="{{ url_for('static', filename='js/gift.js') }}"></script>
    {% block scripts %}{% endblock %}
</body>
</html>
```

---

## ğŸ“ **ì½”ë”© ì»¨ë²¤ì…˜** (í•œêµ­ í™˜ê²½ ìµœì í™”)

### **Python ì½”ë“œ ìŠ¤íƒ€ì¼** (PEP 8 ê¸°ë°˜)

#### **ë„¤ì´ë° ê·œì¹™** (ì—…ë°ì´íŠ¸)
```python
# ë³€ìˆ˜, í•¨ìˆ˜: snake_case (í•œêµ­ì–´ ì£¼ì„)
user_name = "í™ê¸¸ë™"  # ì‚¬ìš©ìëª…
batch_schedule_time = "02:00"  # ë°°ì¹˜ ì‹¤í–‰ ì‹œê°„
gift_keywords = ["ì‚¬ì€í’ˆ", "ì¦ì •í’ˆ"]  # ì‚¬ì€í’ˆ í‚¤ì›Œë“œ

def get_user_info():
    """ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ"""
    pass

def schedule_batch_job():
    """ë°°ì¹˜ ì‘ì—… ìŠ¤ì¼€ì¤„ë§"""
    pass

def classify_gift_products():
    """ì‚¬ì€í’ˆ ìë™ ë¶„ë¥˜"""
    pass

# í´ë˜ìŠ¤: PascalCase
class UserManager:
    """ì‚¬ìš©ì ê´€ë¦¬ í´ë˜ìŠ¤"""
    pass

class BatchScheduler:
    """ë°°ì¹˜ ìŠ¤ì¼€ì¤„ëŸ¬ í´ë˜ìŠ¤"""
    pass

class GiftClassifier:
    """ì‚¬ì€í’ˆ ë¶„ë¥˜ í´ë˜ìŠ¤"""
    pass

# ìƒìˆ˜: UPPER_SNAKE_CASE
MAX_LOGIN_ATTEMPTS = 5  # ìµœëŒ€ ë¡œê·¸ì¸ ì‹œë„ íšŸìˆ˜
DEFAULT_PAGE_SIZE = 20  # ê¸°ë³¸ í˜ì´ì§€ í¬ê¸°
DEFAULT_BATCH_HOUR = 2  # ê¸°ë³¸ ë°°ì¹˜ ì‹¤í–‰ ì‹œê°„ (02ì‹œ)
GIFT_AUTO_CLASSIFY = True  # ì‚¬ì€í’ˆ ìë™ ë¶„ë¥˜ í™œì„±í™”

# íŒŒì¼ëª…: snake_case
user_controller.py      # ì‚¬ìš©ì ì»¨íŠ¸ë¡¤ëŸ¬
batch_scheduler.py      # ë°°ì¹˜ ìŠ¤ì¼€ì¤„ëŸ¬
gift_classifier.py      # ì‚¬ì€í’ˆ ë¶„ë¥˜ê¸°
erpia_api_client.py    # ERPia API í´ë¼ì´ì–¸íŠ¸
```

#### **ë°°ì¹˜ ê´€ë¦¬ í…œí”Œë¦¿**
```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ERPia ë°°ì¹˜ ìŠ¤ì¼€ì¤„ëŸ¬
- ì›¹ ê¸°ë°˜ ë°°ì¹˜ ì‹œê°„ ì„¤ì •
- íšŒì‚¬ë³„ ë…ë¦½ ìŠ¤ì¼€ì¤„ ê´€ë¦¬
- ë°°ì¹˜ ìƒíƒœ ëª¨ë‹ˆí„°ë§
"""

# í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬
from datetime import datetime, timedelta
from typing import Dict, List, Optional

# ì„œë“œíŒŒí‹° ë¼ì´ë¸ŒëŸ¬ë¦¬
from apscheduler.schedulers.background import BackgroundScheduler
from apscheduler.triggers.cron import CronTrigger
from flask import current_app
import requests

# ë¡œì»¬ ëª¨ë“ˆ
from app.models.company import Company
from app.models.erpia_config import ErpiaConfig
from app.services.gift_classifier import GiftClassifier
from app.utils.logging import BatchLogger

# ìƒìˆ˜
DEFAULT_BATCH_HOUR = 2
DEFAULT_BATCH_MINUTE = 0
DEFAULT_API_INTERVAL = 3
DEFAULT_PAGE_SIZE = 30

class ErpiaBatchScheduler:
    """ERPia ë°°ì¹˜ ìŠ¤ì¼€ì¤„ëŸ¬
    
    ì›¹ì—ì„œ ì„¤ì •í•œ ì‹œê°„ì— ë”°ë¼ íšŒì‚¬ë³„ë¡œ ERPia ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ê³ 
    ì‚¬ì€í’ˆ ìë™ ë¶„ë¥˜ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.
    """
    
    def __init__(self):
        """ìŠ¤ì¼€ì¤„ëŸ¬ ì´ˆê¸°í™”"""
        self.scheduler = BackgroundScheduler(daemon=True)
        self.gift_classifier = GiftClassifier()
        self.logger = BatchLogger()
    
    def setup_company_batch(self, company_id: int):
        """íšŒì‚¬ë³„ ë°°ì¹˜ ìŠ¤ì¼€ì¤„ ì„¤ì •
        
        Args:
            company_id (int): íšŒì‚¬ ID
        """
        try:
            config = ErpiaConfig.query.filter_by(company_id=company_id).first()
            if not config or not config.batch_enabled:
                return
            
            # ê¸°ì¡´ ìŠ¤ì¼€ì¤„ ì œê±°
            job_id = f'erpia_batch_{company_id}'
            if self.scheduler.get_job(job_id):
                self.scheduler.remove_job(job_id)
            
            # ìƒˆ ìŠ¤ì¼€ì¤„ ë“±ë¡
            self.scheduler.add_job(
                func=self._run_batch_with_gift_classification,
                trigger=CronTrigger(
                    hour=config.batch_hour or DEFAULT_BATCH_HOUR,
                    minute=config.batch_minute or DEFAULT_BATCH_MINUTE
                ),
                args=[company_id],
                id=job_id,
                name=f'ERPia ë°°ì¹˜ - íšŒì‚¬ {company_id}'
            )
            
            self.logger.info(f'ë°°ì¹˜ ìŠ¤ì¼€ì¤„ ë“±ë¡ ì™„ë£Œ: íšŒì‚¬ {company_id}')
            
        except Exception as e:
            self.logger.error(f'ë°°ì¹˜ ìŠ¤ì¼€ì¤„ ì„¤ì • ì‹¤íŒ¨: {str(e)}')
    
    def _run_batch_with_gift_classification(self, company_id: int):
        """ë°°ì¹˜ ì‹¤í–‰ + ì‚¬ì€í’ˆ ìë™ ë¶„ë¥˜
        
        Args:
            company_id (int): íšŒì‚¬ ID
        """
        try:
            # ERPia ë°ì´í„° ìˆ˜ì§‘
            sales_data = self._collect_erpia_data(company_id)
            
            # ì‚¬ì€í’ˆ ìë™ ë¶„ë¥˜ ì ìš©
            classified_data = self.gift_classifier.classify_products(
                sales_data, company_id
            )
            
            # ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥
            self._save_classified_data(classified_data, company_id)
            
            self.logger.info(f'ë°°ì¹˜ ì‹¤í–‰ ì™„ë£Œ: íšŒì‚¬ {company_id}, '
                           f'ì²˜ë¦¬ ê±´ìˆ˜ {len(classified_data)}')
            
        except Exception as e:
            self.logger.error(f'ë°°ì¹˜ ì‹¤í–‰ ì‹¤íŒ¨: íšŒì‚¬ {company_id}, ì˜¤ë¥˜: {str(e)}')
```

---

## ğŸ“ **í”„ë¡œì íŠ¸ êµ¬ì¡°** (ìœ ì§€ë³´ìˆ˜ ìµœì í™”) - ì—…ë°ì´íŠ¸

```
mis_v2/
â”œâ”€â”€ app/                          # Flask ì• í”Œë¦¬ì¼€ì´ì…˜
â”‚   â”œâ”€â”€ __init__.py              # ì•± íŒ©í† ë¦¬
â”‚   â”œâ”€â”€ config.py                # ì„¤ì • íŒŒì¼
â”‚   â”œâ”€â”€ models/                  # SQLAlchemy ëª¨ë¸
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py             # ë² ì´ìŠ¤ ëª¨ë¸
â”‚   â”‚   â”œâ”€â”€ user.py             # ì‚¬ìš©ì ëª¨ë¸
â”‚   â”‚   â”œâ”€â”€ product.py          # ì œí’ˆ ëª¨ë¸
â”‚   â”‚   â”œâ”€â”€ trade.py            # ë¬´ì—­ ëª¨ë¸
â”‚   â”‚   â”œâ”€â”€ admin.py            # ê´€ë¦¬ì ëª¨ë¸
â”‚   â”‚   â”œâ”€â”€ erpia_config.py     # ERPia ì„¤ì • ëª¨ë¸ (ì‹ ê·œ)
â”‚   â”‚   â”œâ”€â”€ gift_master.py      # ì‚¬ì€í’ˆ ë§ˆìŠ¤í„° ëª¨ë¸ (ì‹ ê·œ)
â”‚   â”‚   â””â”€â”€ batch_log.py        # ë°°ì¹˜ ë¡œê·¸ ëª¨ë¸ (ì‹ ê·œ)
â”‚   â”œâ”€â”€ controllers/             # ì»¨íŠ¸ë¡¤ëŸ¬ (ë¼ìš°íŠ¸)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ main.py             # ë©”ì¸ í˜ì´ì§€
â”‚   â”‚   â”œâ”€â”€ auth.py             # ì¸ì¦
â”‚   â”‚   â”œâ”€â”€ admin.py            # ê´€ë¦¬ì
â”‚   â”‚   â”œâ”€â”€ customer.py         # ê³ ê°ê´€ë¦¬
â”‚   â”‚   â”œâ”€â”€ stats.py            # í†µê³„ê´€ë¦¬
â”‚   â”‚   â”œâ”€â”€ sales.py            # ì˜ì—…ê´€ë¦¬
â”‚   â”‚   â”œâ”€â”€ trade.py            # ë¬´ì—­ê´€ë¦¬
â”‚   â”‚   â”œâ”€â”€ logistics.py        # ë¬¼ë¥˜ê´€ë¦¬
â”‚   â”‚   â”œâ”€â”€ batch.py            # ë°°ì¹˜ ê´€ë¦¬ (ì‹ ê·œ)
â”‚   â”‚   â””â”€â”€ gift.py             # ì‚¬ì€í’ˆ ê´€ë¦¬ (ì‹ ê·œ)
â”‚   â”œâ”€â”€ services/               # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ user_service.py     # ì‚¬ìš©ì ì„œë¹„ìŠ¤
â”‚   â”‚   â”œâ”€â”€ trade_service.py    # ë¬´ì—­ ì„œë¹„ìŠ¤
â”‚   â”‚   â”œâ”€â”€ serial_service.py   # ì‹œë¦¬ì–¼ ì„œë¹„ìŠ¤
â”‚   â”‚   â”œâ”€â”€ cache_service.py    # ìºì‹œ ì„œë¹„ìŠ¤
â”‚   â”‚   â”œâ”€â”€ batch_scheduler.py  # ë°°ì¹˜ ìŠ¤ì¼€ì¤„ëŸ¬ (ì‹ ê·œ)
â”‚   â”‚   â”œâ”€â”€ erpia_api_client.py # ERPia API í´ë¼ì´ì–¸íŠ¸ (ì‹ ê·œ)
â”‚   â”‚   â”œâ”€â”€ gift_classifier.py  # ì‚¬ì€í’ˆ ë¶„ë¥˜ê¸° (ì‹ ê·œ)
â”‚   â”‚   â””â”€â”€ gift_analytics.py   # ì‚¬ì€í’ˆ ë¶„ì„ (ì‹ ê·œ)
â”‚   â”œâ”€â”€ utils/                  # ìœ í‹¸ë¦¬í‹°
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ helpers.py          # í—¬í¼ í•¨ìˆ˜
â”‚   â”‚   â”œâ”€â”€ decorators.py       # ë°ì½”ë ˆì´í„°
â”‚   â”‚   â”œâ”€â”€ validators.py       # ê²€ì¦ í•¨ìˆ˜
â”‚   â”‚   â”œâ”€â”€ cache.py            # ìºì‹œ ìœ í‹¸ë¦¬í‹°
â”‚   â”‚   â”œâ”€â”€ batch_logger.py     # ë°°ì¹˜ ë¡œê¹… (ì‹ ê·œ)
â”‚   â”‚   â””â”€â”€ scheduler_utils.py  # ìŠ¤ì¼€ì¤„ëŸ¬ ìœ í‹¸ë¦¬í‹° (ì‹ ê·œ)
â”‚   â”œâ”€â”€ templates/              # Jinja2 í…œí”Œë¦¿
â”‚   â”‚   â”œâ”€â”€ base.html           # ê¸°ë³¸ ë ˆì´ì•„ì›ƒ
â”‚   â”‚   â”œâ”€â”€ partials/           # ê³µí†µ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ sidebar.html
â”‚   â”‚   â”‚   â”œâ”€â”€ navbar.html
â”‚   â”‚   â”‚   â”œâ”€â”€ pagination.html
â”‚   â”‚   â”‚   â”œâ”€â”€ batch_status.html    # ë°°ì¹˜ ìƒíƒœ (ì‹ ê·œ)
â”‚   â”‚   â”‚   â””â”€â”€ gift_badge.html      # ì‚¬ì€í’ˆ ë±ƒì§€ (ì‹ ê·œ)
â”‚   â”‚   â”œâ”€â”€ admin/              # ê´€ë¦¬ì í…œí”Œë¦¿
â”‚   â”‚   â”‚   â”œâ”€â”€ batch/          # ë°°ì¹˜ ê´€ë¦¬ í…œí”Œë¦¿ (ì‹ ê·œ)
â”‚   â”‚   â”‚   â””â”€â”€ gift/           # ì‚¬ì€í’ˆ ì„¤ì • í…œí”Œë¦¿ (ì‹ ê·œ)
â”‚   â”‚   â”œâ”€â”€ customer/           # ê³ ê°ê´€ë¦¬ í…œí”Œë¦¿
â”‚   â”‚   â”œâ”€â”€ trade/              # ë¬´ì—­ê´€ë¦¬ í…œí”Œë¦¿
â”‚   â”‚   â””â”€â”€ errors/             # ì—ëŸ¬ í˜ì´ì§€
â”‚   â””â”€â”€ static/                 # ì •ì  íŒŒì¼
â”‚       â”œâ”€â”€ css/
â”‚       â”‚   â”œâ”€â”€ main.css        # ë©”ì¸ ìŠ¤íƒ€ì¼
â”‚       â”‚   â”œâ”€â”€ components.css  # ì»´í¬ë„ŒíŠ¸ ìŠ¤íƒ€ì¼
â”‚       â”‚   â”œâ”€â”€ batch.css       # ë°°ì¹˜ ê´€ë ¨ ìŠ¤íƒ€ì¼ (ì‹ ê·œ)
â”‚       â”‚   â””â”€â”€ gift.css        # ì‚¬ì€í’ˆ ê´€ë ¨ ìŠ¤íƒ€ì¼ (ì‹ ê·œ)
â”‚       â”œâ”€â”€ js/
â”‚       â”‚   â”œâ”€â”€ main.js         # ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸
â”‚       â”‚   â”œâ”€â”€ components/     # ì»´í¬ë„ŒíŠ¸ë³„ JS
â”‚       â”‚   â”œâ”€â”€ batch.js        # ë°°ì¹˜ ê´€ë¦¬ JS (ì‹ ê·œ)
â”‚       â”‚   â”œâ”€â”€ gift.js         # ì‚¬ì€í’ˆ ê´€ë¦¬ JS (ì‹ ê·œ)
â”‚       â”‚   â””â”€â”€ datatables.korean.json
â”‚       â””â”€â”€ images/
â”œâ”€â”€ migrations/                 # DB ë§ˆì´ê·¸ë ˆì´ì…˜
â”œâ”€â”€ tests/                     # í…ŒìŠ¤íŠ¸ íŒŒì¼
â”‚   â”œâ”€â”€ unit/                  # ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
â”‚   â”‚   â”œâ”€â”€ test_batch.py      # ë°°ì¹˜ í…ŒìŠ¤íŠ¸ (ì‹ ê·œ)
â”‚   â”‚   â””â”€â”€ test_gift.py       # ì‚¬ì€í’ˆ í…ŒìŠ¤íŠ¸ (ì‹ ê·œ)
â”‚   â”œâ”€â”€ integration/           # í†µí•© í…ŒìŠ¤íŠ¸
â”‚   â””â”€â”€ conftest.py            # í…ŒìŠ¤íŠ¸ ì„¤ì •
â”œâ”€â”€ docs/                      # ë¬¸ì„œ
â”œâ”€â”€ sql_scripts/              # SQL ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ docker-compose.yml        # Docker ì„¤ì •
â”œâ”€â”€ requirements.txt          # Python ì˜ì¡´ì„± (ì—…ë°ì´íŠ¸)
â”œâ”€â”€ .env.example             # í™˜ê²½ ë³€ìˆ˜ ì˜ˆì œ (ì—…ë°ì´íŠ¸)
â”œâ”€â”€ .env                     # í™˜ê²½ ë³€ìˆ˜ (git ì œì™¸)
â””â”€â”€ run.py                   # ì•± ì‹¤í–‰ íŒŒì¼
```

---

## ğŸ” **ë³´ì•ˆ ê°€ì´ë“œë¼ì¸** (ì‹¤ë¬´ ì¤‘ì‹¬)

### **ì¸ì¦ ë° ê¶Œí•œ**
- **Flask-Login**: ì„¸ì…˜ ê¸°ë°˜ ì¸ì¦
- **Redis Session**: ì„¸ì…˜ ë°ì´í„° Redis ì €ì¥
- **CSRF ë³´í˜¸**: Flask-WTF í† í° ì‚¬ìš©
- **ê¶Œí•œ ì²´í¬**: ë°ì½”ë ˆì´í„° íŒ¨í„´
- **ë©”ë‰´ë³„ ì ‘ê·¼ ì œì–´**: DB ê¸°ë°˜ ê¶Œí•œ ê´€ë¦¬

### **ì½”ë“œ ë³´ì•ˆ ì˜ˆì œ** (ì—…ë°ì´íŠ¸)
```python
# app/utils/decorators.py
from functools import wraps
from flask import session, redirect, url_for, flash, request
from app.models.user import User
from app.utils.cache import get_user_permissions

def login_required(f):
    """ë¡œê·¸ì¸ í•„ìˆ˜ ë°ì½”ë ˆì´í„°"""
    @wraps(f)
    def decorated_function(*args, **kwargs):
        if 'user_id' not in session:
            flash('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'warning')
            return redirect(url_for('auth.login', next=request.url))
        return f(*args, **kwargs)
    return decorated_function

def batch_admin_required(f):
    """ë°°ì¹˜ ê´€ë¦¬ì ê¶Œí•œ í•„ìš” ë°ì½”ë ˆì´í„° (ì‹ ê·œ)"""
    @wraps(f)
    def decorated_function(*args, **kwargs):
        user_id = session.get('user_id')
        if not user_id:
            flash('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'warning')
            return redirect(url_for('auth.login'))
        
        permissions = get_user_permissions(user_id)
        if not permissions.get('admin_batch', {}).get('update', False):
            flash('ë°°ì¹˜ ê´€ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.', 'danger')
            return redirect(url_for('main.index'))
        
        return f(*args, **kwargs)
    return decorated_function

def permission_required(menu_code, action='read'):
    """ê¶Œí•œ ì²´í¬ ë°ì½”ë ˆì´í„°
    
    Args:
        menu_code (str): ë©”ë‰´ ì½”ë“œ
        action (str): ì•¡ì…˜ (create, read, update, delete)
    """
    def decorator(f):
        @wraps(f)
        def decorated_function(*args, **kwargs):
            user_id = session.get('user_id')
            if not user_id:
                flash('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'warning')
                return redirect(url_for('auth.login'))
            
            # ìºì‹œì—ì„œ ê¶Œí•œ í™•ì¸
            permissions = get_user_permissions(user_id)
            if not permissions.get(menu_code, {}).get(action, False):
                flash('ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.', 'danger')
                return redirect(url_for('main.index'))
            
            return f(*args, **kwargs)
        return decorated_function
    return decorator

# ì‚¬ìš© ì˜ˆì‹œ
@app.route('/admin/users')
@login_required
@permission_required('admin_user', 'read')
def admin_users():
    return render_template('admin/users.html')

@app.route('/admin/batch/settings')
@login_required
@batch_admin_required
def batch_settings():
    return render_template('admin/batch/settings.html')

@app.route('/admin/gift/settings')
@login_required
@permission_required('admin_gift', 'update')
def gift_settings():
    return render_template('admin/gift/settings.html')
```

---

## âš™ï¸ **ë°°ì¹˜ ë° ìŠ¤ì¼€ì¤„ë§** (ì‹ ê·œ ì¶”ê°€)

### **APScheduler ì„¤ì •**
```python
# app/config.py
class Config:
    # ê¸°ì¡´ ì„¤ì •...
    
    # ë°°ì¹˜ ìŠ¤ì¼€ì¤„ëŸ¬ ì„¤ì •
    SCHEDULER_API_ENABLED = True
    SCHEDULER_TIMEZONE = 'Asia/Seoul'
    
    # ERPia ë°°ì¹˜ ê¸°ë³¸ ì„¤ì •
    BATCH_DEFAULT_HOUR = 2
    BATCH_DEFAULT_MINUTE = 0
    BATCH_MAX_RETRY = 3
    
    # ERPia API ì„¤ì •
    ERPIA_API_URL = 'http://www.erpia.net/xml/xml.asp'
    ERPIA_DEFAULT_INTERVAL = 3
    ERPIA_DEFAULT_PAGE_SIZE = 30
    ERPIA_TIMEOUT = 30

# app/__init__.py
from flask_apscheduler import APScheduler

def create_app():
    app = Flask(__name__)
    
    # ìŠ¤ì¼€ì¤„ëŸ¬ ì´ˆê¸°í™”
    scheduler = APScheduler()
    scheduler.init_app(app)
    scheduler.start()
    
    return app
```

### **ë°°ì¹˜ ê´€ë¦¬ API**
```python
# app/controllers/batch.py
from flask import Blueprint, render_template, request, jsonify
from app.services.batch_scheduler import ErpiaBatchScheduler
from app.utils.decorators import login_required, batch_admin_required

batch_bp = Blueprint('batch', __name__, url_prefix='/admin/batch')

@batch_bp.route('/settings')
@login_required
@batch_admin_required
def settings():
    """ë°°ì¹˜ ì„¤ì • í™”ë©´"""
    return render_template('admin/batch/settings.html')

@batch_bp.route('/api/schedule', methods=['POST'])
@login_required
@batch_admin_required
def update_schedule():
    """ë°°ì¹˜ ìŠ¤ì¼€ì¤„ ì—…ë°ì´íŠ¸"""
    data = request.get_json()
    
    try:
        scheduler = ErpiaBatchScheduler()
        result = scheduler.update_company_schedule(
            company_id=data['company_id'],
            schedule_time=data['schedule_time'],
            api_settings=data['api_settings']
        )
        
        return jsonify({'success': True, 'message': 'ìŠ¤ì¼€ì¤„ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.'})
    
    except Exception as e:
        return jsonify({'success': False, 'message': str(e)}), 500

@batch_bp.route('/api/status/<int:company_id>')
@login_required
def get_status(company_id):
    """ë°°ì¹˜ ìƒíƒœ ì¡°íšŒ"""
    scheduler = ErpiaBatchScheduler()
    status = scheduler.get_batch_status(company_id)
    return jsonify(status)
```

---

## ğŸ **ì‚¬ì€í’ˆ ë¶„ë¥˜ ì‹œìŠ¤í…œ** (ì‹ ê·œ ì¶”ê°€)

### **ì‚¬ì€í’ˆ ë¶„ë¥˜ ì„¤ì •**
```python
# app/config.py
class Config:
    # ì‚¬ì€í’ˆ ë¶„ë¥˜ ê¸°ë³¸ ì„¤ì •
    GIFT_AUTO_CLASSIFY = True
    GIFT_DEFAULT_KEYWORDS = ['ì‚¬ì€í’ˆ', 'ì¦ì •í’ˆ', 'ë¬´ë£Œ', 'ìƒ˜í”Œ', 'ì²´í—˜']
    GIFT_EXCLUDE_FROM_REVENUE = True
    
    # ì‚¬ì€í’ˆ ë¶„ì„ ì„¤ì •
    GIFT_ANALYTICS_CACHE_TTL = 3600  # 1ì‹œê°„
    GIFT_REPORT_MAX_DAYS = 365       # ìµœëŒ€ 1ë…„
```

### **ì‚¬ì€í’ˆ ë¶„ë¥˜ ì„œë¹„ìŠ¤**
```python
# app/services/gift_classifier.py
from typing import List, Dict, Any
from app.models.gift_master import GiftMaster
from app.models.erpia_config import ErpiaConfig

class GiftClassifier:
    """ì‚¬ì€í’ˆ ìë™ ë¶„ë¥˜ ì—”ì§„"""
    
    def __init__(self):
        self.classification_cache = {}
    
    def classify_products(self, products: List[Dict], company_id: int) -> List[Dict]:
        """ìƒí’ˆ ëª©ë¡ ìë™ ë¶„ë¥˜"""
        
        # íšŒì‚¬ë³„ ì‚¬ì€í’ˆ ì„¤ì • ë¡œë“œ
        config = ErpiaConfig.query.filter_by(company_id=company_id).first()
        if not config or not config.auto_gift_classify:
            return products
        
        classified_products = []
        
        for product in products:
            classification = self._classify_single_product(
                product, config, company_id
            )
            product.update(classification)
            classified_products.append(product)
        
        return classified_products
    
    def _classify_single_product(self, product: Dict, config: ErpiaConfig, 
                                company_id: int) -> Dict:
        """ë‹¨ì¼ ìƒí’ˆ ë¶„ë¥˜"""
        
        gong_amt = int(product.get('gong_amt', 0))
        pan_amt = int(product.get('pan_amt', 0))
        product_name = product.get('product_name', '')
        
        # 1. 0ì› ìƒí’ˆ â†’ ìë™ ì‚¬ì€í’ˆ
        if gong_amt == 0 and pan_amt == 0:
            return {
                'product_type': 'GIFT',
                'is_revenue': not config.gift_exclude_from_revenue,
                'gift_type': 'ZERO_PRICE',
                'classification_reason': 'ê³µê¸‰ê°€ 0ì› (ìë™ë¶„ë¥˜)',
                'revenue_impact': 0
            }
        
        # 2. í‚¤ì›Œë“œ ê¸°ë°˜ ë¶„ë¥˜
        keywords = config.gift_keywords or []
        for keyword in keywords:
            if keyword in product_name:
                return {
                    'product_type': 'GIFT',
                    'is_revenue': not config.gift_exclude_from_revenue,
                    'gift_type': 'KEYWORD_BASED',
                    'classification_reason': f'í‚¤ì›Œë“œ ë§¤ì¹­: {keyword}',
                    'revenue_impact': 0
                }
        
        # 3. ì‚¬ì€í’ˆ ë§ˆìŠ¤í„° ê¸°ë°˜ ë¶„ë¥˜
        gift_master = GiftMaster.query.filter_by(
            company_id=company_id,
            product_code=product.get('product_code'),
            is_active=True
        ).first()
        
        if gift_master:
            return {
                'product_type': 'GIFT',
                'is_revenue': not config.gift_exclude_from_revenue,
                'gift_type': 'MASTER_BASED',
                'classification_reason': 'ì‚¬ì€í’ˆ ë§ˆìŠ¤í„° ë“±ë¡',
                'revenue_impact': 0
            }
        
        # 4. ì¼ë°˜ ìƒí’ˆ
        return {
            'product_type': 'PRODUCT',
            'is_revenue': True,
            'gift_type': None,
            'classification_reason': 'ì¼ë°˜ ë§¤ì¶œ ìƒí’ˆ',
            'revenue_impact': gong_amt
        }
```

---

## ğŸ“‹ **ê°œë°œ ì²´í¬ë¦¬ìŠ¤íŠ¸** (ë‹¨ê³„ë³„) - ì—…ë°ì´íŠ¸

### **í™˜ê²½ ì„¤ì •**
- [ ] Docker í™˜ê²½ êµ¬ì„± (PostgreSQL + Redis)
- [ ] Python ê°€ìƒí™˜ê²½ ìƒì„±
- [ ] ì˜ì¡´ì„± íŒ¨í‚¤ì§€ ì„¤ì¹˜ (APScheduler, pandas í¬í•¨)
- [ ] í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (ë°°ì¹˜/ì‚¬ì€í’ˆ ì„¤ì • í¬í•¨)
- [ ] DB ìŠ¤í‚¤ë§ˆ ìƒì„±

### **ê°œë°œ ë‹¨ê³„**
- [ ] ëª¨ë¸ ì •ì˜ (SQLAlchemy) - ë°°ì¹˜/ì‚¬ì€í’ˆ ëª¨ë¸ í¬í•¨
- [ ] ì»¨íŠ¸ë¡¤ëŸ¬ êµ¬í˜„ (Flask Blueprint) - ë°°ì¹˜/ì‚¬ì€í’ˆ ì»¨íŠ¸ë¡¤ëŸ¬ í¬í•¨
- [ ] ë°°ì¹˜ ìŠ¤ì¼€ì¤„ëŸ¬ êµ¬í˜„ (APScheduler)
- [ ] ì‚¬ì€í’ˆ ë¶„ë¥˜ ì—”ì§„ êµ¬í˜„
- [ ] í…œí”Œë¦¿ ì‘ì„± (Jinja2 + Bootstrap) - ë°°ì¹˜/ì‚¬ì€í’ˆ UI í¬í•¨
- [ ] JavaScript ê¸°ëŠ¥ ì¶”ê°€ (ì‹¤ì‹œê°„ ë°°ì¹˜ ìƒíƒœ)
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±

### **ë°°í¬ ì¤€ë¹„**
- [ ] ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬ (Black + Flake8)
- [ ] í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (ë°°ì¹˜/ì‚¬ì€í’ˆ í…ŒìŠ¤íŠ¸ í¬í•¨)
- [ ] ë³´ì•ˆ ì ê²€
- [ ] ì„±ëŠ¥ ìµœì í™” (ë°°ì¹˜ ì„±ëŠ¥ íŠœë‹)
- [ ] ë¬¸ì„œ ì—…ë°ì´íŠ¸

---

**âœ… ì›¹ ê¸°ë°˜ ë°°ì¹˜ ì„¤ì •ê³¼ ì‚¬ì€í’ˆ ìë™ ë¶„ë¥˜ê°€ ì™„ì „íˆ ë°˜ì˜ëœ ê¸°ìˆ  ìŠ¤íƒ ì™„ë£Œ!**  
**ğŸ“ APScheduler, pandas ì¶”ê°€ ë° ê´€ë ¨ ì»´í¬ë„ŒíŠ¸ë¡œ êµ¬ì„±í•˜ì—¬ ê³ ë„í™”ëœ MIS v2 ì‹œìŠ¤í…œ êµ¬ì¶• ê°€ëŠ¥!** 