# 🛠️ **MIS v2 개발 스택 및 가이드라인** (유지보수 최적화)

## 📋 **목차**
1. [기술 스택](#기술-스택)
2. [시스템 아키텍처](#시스템-아키텍처)
3. [개발 환경](#개발-환경)
4. [UI/UX 가이드라인](#uiux-가이드라인)
5. [코딩 컨벤션](#코딩-컨벤션)
6. [프로젝트 구조](#프로젝트-구조)
7. [보안 가이드라인](#보안-가이드라인)

---

## 🔧 **기술 스택** (유지보수 중심)

### **백엔드** 🐍
- **프레임워크**: Flask 3.0
- **ORM**: SQLAlchemy 2.0 (Flask-SQLAlchemy)
- **인증**: Flask-Login + Session 기반
- **폼 처리**: Flask-WTF + WTForms
- **API**: RESTful API (JSON 응답)
- **로깅**: Python logging + colorlog
- **캐시**: Redis 7.0 (세션, 데이터 캐싱)

### **프론트엔드** 🎨 (단순하고 안정적)
- **템플릿 엔진**: Jinja2 (Flask 기본)
- **CSS 프레임워크**: Bootstrap 5.3 (학습곡선 낮음)
- **JavaScript**: Vanilla JS + jQuery 3.7 (간단하고 안정적)
- **차트**: Chart.js 4.0 (문서화 우수)
- **아이콘**: Bootstrap Icons + Font Awesome
- **테이블**: DataTables.js (한국어 지원)

### **데이터베이스** 🗄️
- **메인 DB**: PostgreSQL 15
- **캐시 DB**: Redis 7.0 (세션, 임시 데이터)
- **연결**: psycopg2-binary, redis-py
- **마이그레이션**: Alembic (Flask-Migrate)
- **백업**: pg_dump + redis-cli 자동화

### **개발 도구** ⚙️
- **컨테이너**: Docker + Docker Compose
- **코드 품질**: Black (포매터) + Flake8 (린터)
- **테스트**: pytest + pytest-flask
- **의존성 관리**: requirements.txt
- **환경 변수**: python-dotenv

---

## 🏗️ **시스템 아키텍처** (확장성 고려)

### **전체 구조**
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   브라우저        │◄──►│   Flask App     │◄──►│  PostgreSQL     │
│  (UI/UX)        │    │  (비즈니스 로직)   │    │   (메인 데이터)   │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                              │                       │
                       ┌─────────────────┐    ┌─────────────────┐
                       │   Redis Cache   │    │   레거시 MS-SQL  │
                       │  (세션, 캐시)     │    │   (읽기 전용)     │
                       └─────────────────┘    └─────────────────┘
```

### **레이어 구조**
1. **Presentation Layer**: Jinja2 Templates + Bootstrap CSS
2. **Controller Layer**: Flask Blueprints + Routes
3. **Service Layer**: 비즈니스 로직 처리
4. **Data Layer**: SQLAlchemy Models + Redis Cache
5. **Infrastructure Layer**: PostgreSQL + Redis + External APIs

---

## 💻 **개발 환경**

### **로컬 개발 환경**
```bash
# Docker 환경
- PostgreSQL: localhost:5432
- Redis: localhost:6379
- pgAdmin: localhost:5050
- Flask App: localhost:5000

# Python 환경
- Python 3.11+
- Virtual Environment 사용 권장
```

### **환경 변수 설정**
```env
# .env 파일
FLASK_ENV=development
FLASK_DEBUG=1
DATABASE_URL=postgresql://mis_user:mis123!@#@localhost:5432/db_mis
REDIS_URL=redis://localhost:6379/0
SECRET_KEY=your-secret-key-here
SESSION_TYPE=redis
LEGACY_DB_CONNECTION=DRIVER={ODBC Driver 17 for SQL Server};SERVER=210.109.96.74,2521;DATABASE=db_mis;UID=user_mis;PWD=user_mis!@12;ApplicationIntent=ReadOnly;
```

---

## 🎨 **UI/UX 가이드라인** (Bootstrap 중심)

### **디자인 시스템**

#### **컬러 팔레트** 🎨 (Bootstrap 기본 + 브랜드)
```css
/* Bootstrap 기본 색상 (유지보수 용이) */
--primary-color: #0d6efd;      /* Bootstrap Blue */
--secondary-color: #6c757d;    /* Bootstrap Gray */
--success-color: #198754;      /* Bootstrap Green */
--danger-color: #dc3545;       /* Bootstrap Red */
--warning-color: #ffc107;      /* Bootstrap Yellow */
--info-color: #0dcaf0;         /* Bootstrap Cyan */

/* MIS 브랜드 색상 (회사 특화) */
--brand-primary: #1e3a8a;      /* 진한 파랑 (신뢰감) */
--brand-secondary: #3b82f6;    /* 밝은 파랑 (활동성) */
--brand-accent: #ef4444;       /* 포인트 빨강 (강조) */
--brand-success: #10b981;      /* 성공 초록 */

/* 배경 색상 (깔끔함) */
--bg-light: #f8fafc;          /* 연한 회색 */
--bg-dark: #1e293b;           /* 다크 모드 */
--bg-card: #ffffff;           /* 카드 배경 */
--border-color: #e2e8f0;      /* 테두리 */
```

#### **타이포그래피** ✍️ (한국어 최적화)
```css
/* 폰트 스택 (한국어 우선) */
font-family: 'Noto Sans KR', 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;

/* 폰트 크기 (16px 기준) */
--font-size-xs: 0.75rem;    /* 12px - 작은 텍스트 */
--font-size-sm: 0.875rem;   /* 14px - 보조 텍스트 */
--font-size-base: 1rem;     /* 16px - 기본 텍스트 */
--font-size-lg: 1.125rem;   /* 18px - 강조 텍스트 */
--font-size-xl: 1.25rem;    /* 20px - 부제목 */

/* 제목 크기 (가독성 중심) */
h1: 2.25rem (36px) - 페이지 제목
h2: 1.875rem (30px) - 섹션 제목
h3: 1.5rem (24px) - 서브 섹션
h4: 1.25rem (20px) - 카드 제목
h5: 1.125rem (18px) - 작은 제목
h6: 1rem (16px) - 레이블
```

#### **간격 시스템** 📏 (Bootstrap 표준)
```css
/* Bootstrap 간격 시스템 (0.25rem = 4px) */
--spacing-0: 0;
--spacing-1: 0.25rem;  /* 4px */
--spacing-2: 0.5rem;   /* 8px */
--spacing-3: 1rem;     /* 16px */
--spacing-4: 1.5rem;   /* 24px */
--spacing-5: 3rem;     /* 48px */

/* 커스텀 간격 (MIS 전용) */
--content-padding: 1.5rem;     /* 카드 내부 패딩 */
--section-margin: 2rem;        /* 섹션 간 여백 */
--form-spacing: 1rem;          /* 폼 요소 간격 */
```

### **레이아웃 구조** (관리자 시스템 최적화)

#### **기본 레이아웃** (사이드바 + 메인)
```html
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIS v2 - {{ page_title }}</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <!-- 커스텀 CSS -->
    <link href="{{ url_for('static', filename='css/main.css') }}" rel="stylesheet">
</head>
<body>
    <!-- 상단 네비게이션 (고정) -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-brand-primary fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <i class="bi bi-building"></i> MIS v2
            </a>
            <!-- 사용자 정보 -->
            <div class="navbar-nav ms-auto">
                <span class="navbar-text me-3">{{ current_user.name }}님</span>
                <a class="nav-link" href="/logout">로그아웃</a>
            </div>
        </div>
    </nav>
    
    <!-- 메인 컨테이너 -->
    <div class="container-fluid" style="margin-top: 56px;">
        <div class="row">
            <!-- 사이드바 (고정) -->
            <nav class="col-md-2 col-lg-2 sidebar bg-light">
                <div class="sidebar-sticky">
                    {% include 'partials/sidebar.html' %}
                </div>
            </nav>
            
            <!-- 메인 컨텐츠 -->
            <main class="col-md-10 col-lg-10 main-content">
                <!-- 브레드크럼 -->
                <nav aria-label="breadcrumb" class="mt-3">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="/">홈</a></li>
                        {% block breadcrumb %}{% endblock %}
                    </ol>
                </nav>
                
                <!-- 페이지 헤더 -->
                <div class="page-header d-flex justify-content-between align-items-center mb-4">
                    <h1 class="h2">{% block page_title %}{% endblock %}</h1>
                    <div class="btn-group">
                        {% block page_actions %}{% endblock %}
                    </div>
                </div>
                
                <!-- 알림 메시지 -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
                
                <!-- 컨텐츠 영역 -->
                <div class="content">
                    {% block content %}{% endblock %}
                </div>
            </main>
        </div>
    </div>
    
    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    {% block scripts %}{% endblock %}
</body>
</html>
```

#### **컴포넌트 가이드라인** (실용적)

**1. 버튼 시스템** 🔘
```html
<!-- 기본 액션 버튼 -->
<div class="btn-group" role="group">
    <button type="submit" class="btn btn-primary">
        <i class="bi bi-check-lg"></i> 저장
    </button>
    <button type="button" class="btn btn-secondary" onclick="history.back()">
        <i class="bi bi-arrow-left"></i> 취소
    </button>
    <button type="button" class="btn btn-danger" onclick="confirmDelete()">
        <i class="bi bi-trash"></i> 삭제
    </button>
</div>

<!-- 크기별 버튼 -->
<button class="btn btn-primary btn-sm">작은 버튼</button>
<button class="btn btn-primary">기본 버튼</button>
<button class="btn btn-primary btn-lg">큰 버튼</button>

<!-- 아이콘 + 텍스트 조합 -->
<button class="btn btn-outline-primary">
    <i class="bi bi-plus-circle"></i> 새로 등록
</button>
```

**2. 데이터 테이블** 📊
```html
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="card-title mb-0">데이터 목록</h5>
        <div class="btn-group btn-group-sm">
            <button class="btn btn-outline-secondary">
                <i class="bi bi-download"></i> 엑셀
            </button>
            <button class="btn btn-primary">
                <i class="bi bi-plus"></i> 등록
            </button>
        </div>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped table-hover" id="dataTable">
                <thead class="table-dark">
                    <tr>
                        <th width="60">순번</th>
                        <th>제목</th>
                        <th width="120">등록일</th>
                        <th width="100">상태</th>
                        <th width="120">관리</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- 데이터 행 -->
                </tbody>
            </table>
        </div>
    </div>
</div>
```

**3. 폼 레이아웃** 📝
```html
<div class="card">
    <div class="card-header">
        <h5 class="card-title">정보 입력</h5>
    </div>
    <div class="card-body">
        <form class="needs-validation" novalidate method="POST">
            {{ csrf_token() }}
            
            <div class="row">
                <div class="col-md-6">
                    <label class="form-label">
                        제목 <span class="text-danger">*</span>
                    </label>
                    <input type="text" class="form-control" name="title" required>
                    <div class="invalid-feedback">제목을 입력해주세요.</div>
                </div>
                <div class="col-md-6">
                    <label class="form-label">분류</label>
                    <select class="form-select" name="category">
                        <option value="">선택하세요</option>
                        <option value="1">분류1</option>
                        <option value="2">분류2</option>
                    </select>
                </div>
            </div>
            
            <div class="row mt-3">
                <div class="col-12">
                    <label class="form-label">내용</label>
                    <textarea class="form-control" name="content" rows="5"></textarea>
                </div>
            </div>
            
            <div class="mt-4 d-flex justify-content-end">
                <button type="submit" class="btn btn-primary me-2">
                    <i class="bi bi-check-lg"></i> 저장
                </button>
                <button type="button" class="btn btn-secondary" onclick="history.back()">
                    <i class="bi bi-x-lg"></i> 취소
                </button>
            </div>
        </form>
    </div>
</div>
```

---

## 📏 **코딩 컨벤션** (한국 환경 최적화)

### **Python 코드 스타일** (PEP 8 기반)

#### **네이밍 규칙**
```python
# 변수, 함수: snake_case (한국어 주석)
user_name = "홍길동"  # 사용자명
def get_user_info():
    """사용자 정보 조회"""
    pass

# 클래스: PascalCase
class UserManager:
    """사용자 관리 클래스"""
    pass

# 상수: UPPER_SNAKE_CASE
MAX_LOGIN_ATTEMPTS = 5  # 최대 로그인 시도 횟수
DEFAULT_PAGE_SIZE = 20  # 기본 페이지 크기

# 파일명: snake_case
user_controller.py      # 사용자 컨트롤러
product_service.py      # 제품 서비스
trade_manager.py        # 무역 관리자
```

#### **파일 구조 템플릿**
```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
사용자 관리 컨트롤러
- 사용자 등록, 수정, 삭제
- 권한 관리
- 로그인/로그아웃 처리
"""

# 표준 라이브러리
import os
import sys
from datetime import datetime

# 서드파티 라이브러리
from flask import Flask, request, render_template, flash, redirect, url_for
import pandas as pd

# 로컬 모듈
from app.models.user import User
from app.services.user_service import UserService
from app.utils.decorators import login_required, admin_required

# 상수
DEFAULT_PAGE_SIZE = 20
MAX_SEARCH_RESULTS = 1000

class UserController:
    """사용자 컨트롤러
    
    사용자 관련 모든 웹 요청을 처리합니다.
    """
    
    def __init__(self):
        """컨트롤러 초기화"""
        self.service = UserService()
    
    @login_required
    def get_users(self, page=1):
        """사용자 목록 조회
        
        Args:
            page (int): 페이지 번호
            
        Returns:
            dict: 사용자 목록과 페이징 정보
        """
        try:
            result = self.service.get_paginated_users(
                page=page, 
                per_page=DEFAULT_PAGE_SIZE
            )
            return result
        except Exception as e:
            flash(f'사용자 목록 조회 중 오류가 발생했습니다: {str(e)}', 'error')
            return {'users': [], 'pagination': None}
```

### **JavaScript 코드 스타일** (jQuery 중심)

#### **기본 구조**
```javascript
/**
 * MIS v2 - 사용자 관리 스크립트
 * Bootstrap + jQuery 기반
 */

// 즉시 실행 함수로 전역 오염 방지
(function($) {
    'use strict';
    
    // 상수 정의
    const API_BASE_URL = '/api/v1';
    const CSRF_TOKEN = $('meta[name=csrf-token]').attr('content');
    
    // 전역 변수
    let dataTable = null;
    
    /**
     * 페이지 초기화
     */
    function initializePage() {
        initializeDataTable();
        initializeEventHandlers();
        initializeFormValidation();
    }
    
    /**
     * 데이터테이블 초기화
     */
    function initializeDataTable() {
        if ($('#dataTable').length) {
            dataTable = $('#dataTable').DataTable({
                language: {
                    url: '/static/js/datatables.korean.json'
                },
                pageLength: 20,
                responsive: true,
                ordering: true,
                searching: true
            });
        }
    }
    
    /**
     * 이벤트 핸들러 등록
     */
    function initializeEventHandlers() {
        // 삭제 버튼 클릭
        $(document).on('click', '.btn-delete', function(e) {
            e.preventDefault();
            const id = $(this).data('id');
            confirmDelete(id);
        });
        
        // 폼 제출
        $('#userForm').on('submit', function(e) {
            if (!validateForm()) {
                e.preventDefault();
            }
        });
    }
    
    /**
     * 삭제 확인
     */
    function confirmDelete(id) {
        if (confirm('정말 삭제하시겠습니까?')) {
            deleteUser(id);
        }
    }
    
    /**
     * 사용자 삭제
     */
    function deleteUser(id) {
        $.ajax({
            url: `/api/users/${id}`,
            type: 'DELETE',
            headers: {
                'X-CSRFToken': CSRF_TOKEN
            },
            success: function(response) {
                showAlert('삭제되었습니다.', 'success');
                if (dataTable) {
                    dataTable.ajax.reload();
                } else {
                    location.reload();
                }
            },
            error: function(xhr) {
                showAlert('삭제 중 오류가 발생했습니다.', 'error');
            }
        });
    }
    
    /**
     * 알림 표시
     */
    function showAlert(message, type = 'info') {
        const alertClass = type === 'error' ? 'danger' : type;
        const alertHtml = `
            <div class="alert alert-${alertClass} alert-dismissible">
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        `;
        $('#alerts').html(alertHtml);
    }
    
    // 페이지 로드 시 초기화
    $(document).ready(function() {
        initializePage();
    });
    
})(jQuery);
```

---

## 📁 **프로젝트 구조** (유지보수 최적화)

```
mis_v2/
├── app/                          # Flask 애플리케이션
│   ├── __init__.py              # 앱 팩토리
│   ├── config.py                # 설정 파일
│   ├── models/                  # SQLAlchemy 모델
│   │   ├── __init__.py
│   │   ├── base.py             # 베이스 모델
│   │   ├── user.py             # 사용자 모델
│   │   ├── product.py          # 제품 모델
│   │   ├── trade.py            # 무역 모델
│   │   └── admin.py            # 관리자 모델
│   ├── controllers/             # 컨트롤러 (라우트)
│   │   ├── __init__.py
│   │   ├── main.py             # 메인 페이지
│   │   ├── auth.py             # 인증
│   │   ├── admin.py            # 관리자
│   │   ├── customer.py         # 고객관리
│   │   ├── stats.py            # 통계관리
│   │   ├── sales.py            # 영업관리
│   │   ├── trade.py            # 무역관리
│   │   └── logistics.py        # 물류관리
│   ├── services/               # 비즈니스 로직
│   │   ├── __init__.py
│   │   ├── user_service.py     # 사용자 서비스
│   │   ├── trade_service.py    # 무역 서비스
│   │   ├── serial_service.py   # 시리얼 서비스
│   │   └── cache_service.py    # 캐시 서비스
│   ├── utils/                  # 유틸리티
│   │   ├── __init__.py
│   │   ├── helpers.py          # 헬퍼 함수
│   │   ├── decorators.py       # 데코레이터
│   │   ├── validators.py       # 검증 함수
│   │   └── cache.py            # 캐시 유틸리티
│   ├── templates/              # Jinja2 템플릿
│   │   ├── base.html           # 기본 레이아웃
│   │   ├── partials/           # 공통 컴포넌트
│   │   │   ├── sidebar.html
│   │   │   ├── navbar.html
│   │   │   └── pagination.html
│   │   ├── admin/              # 관리자 템플릿
│   │   ├── customer/           # 고객관리 템플릿
│   │   ├── trade/              # 무역관리 템플릿
│   │   └── errors/             # 에러 페이지
│   └── static/                 # 정적 파일
│       ├── css/
│       │   ├── main.css        # 메인 스타일
│       │   └── components.css  # 컴포넌트 스타일
│       ├── js/
│       │   ├── main.js         # 메인 스크립트
│       │   ├── components/     # 컴포넌트별 JS
│       │   └── datatables.korean.json
│       └── images/
├── migrations/                 # DB 마이그레이션
├── tests/                     # 테스트 파일
│   ├── unit/                  # 단위 테스트
│   ├── integration/           # 통합 테스트
│   └── conftest.py            # 테스트 설정
├── docs/                      # 문서
├── sql_scripts/              # SQL 스크립트
├── docker-compose.yml        # Docker 설정
├── requirements.txt          # Python 의존성
├── .env.example             # 환경 변수 예제
├── .env                     # 환경 변수 (git 제외)
└── run.py                   # 앱 실행 파일
```

---

## 🔐 **보안 가이드라인** (실무 중심)

### **인증 및 권한**
- **Flask-Login**: 세션 기반 인증
- **Redis Session**: 세션 데이터 Redis 저장
- **CSRF 보호**: Flask-WTF 토큰 사용
- **권한 체크**: 데코레이터 패턴
- **메뉴별 접근 제어**: DB 기반 권한 관리

### **코드 보안 예제**
```python
# app/utils/decorators.py
from functools import wraps
from flask import session, redirect, url_for, flash, request
from app.models.user import User
from app.utils.cache import get_user_permissions

def login_required(f):
    """로그인 필수 데코레이터"""
    @wraps(f)
    def decorated_function(*args, **kwargs):
        if 'user_id' not in session:
            flash('로그인이 필요합니다.', 'warning')
            return redirect(url_for('auth.login', next=request.url))
        return f(*args, **kwargs)
    return decorated_function

def permission_required(menu_code, action='read'):
    """권한 체크 데코레이터
    
    Args:
        menu_code (str): 메뉴 코드
        action (str): 액션 (create, read, update, delete)
    """
    def decorator(f):
        @wraps(f)
        def decorated_function(*args, **kwargs):
            user_id = session.get('user_id')
            if not user_id:
                flash('로그인이 필요합니다.', 'warning')
                return redirect(url_for('auth.login'))
            
            # 캐시에서 권한 확인
            permissions = get_user_permissions(user_id)
            if not permissions.get(menu_code, {}).get(action, False):
                flash('접근 권한이 없습니다.', 'danger')
                return redirect(url_for('main.index'))
            
            return f(*args, **kwargs)
        return decorated_function
    return decorator

# 사용 예시
@app.route('/admin/users')
@login_required
@permission_required('admin_user', 'read')
def admin_users():
    return render_template('admin/users.html')
```

---

## 📋 **개발 체크리스트** (단계별)

### **환경 설정**
- [ ] Docker 환경 구성 (PostgreSQL + Redis)
- [ ] Python 가상환경 생성
- [ ] 의존성 패키지 설치
- [ ] 환경 변수 설정
- [ ] DB 스키마 생성

### **개발 단계**
- [ ] 모델 정의 (SQLAlchemy)
- [ ] 컨트롤러 구현 (Flask Blueprint)
- [ ] 템플릿 작성 (Jinja2 + Bootstrap)
- [ ] JavaScript 기능 추가
- [ ] 단위 테스트 작성

### **배포 준비**
- [ ] 코드 품질 검사 (Black + Flake8)
- [ ] 통합 테스트 실행
- [ ] 보안 점검
- [ ] 성능 최적화
- [ ] 문서 업데이트

---

**✅ 유지보수성을 최우선으로 한 기술 스택 완료!**  
**📝 Redis 추가 및 단순한 기술로 구성하여 장기 유지보수가 용이합니다!** 