# 상품정보 동적 분류 확장 설계

## 📋 개요

매장 관리의 동적 분류 시스템과 동일한 패턴을 상품정보에 적용하여, 상품 분류의 추가/수정/삭제에 실시간으로 대응하는 확장 가능한 상품 관리 시스템을 구현합니다.

## 🏗️ 상품 분류 체계 설계

### 1. 계층 구조
```
PRD (상품) - depth=0
├── CAT (카테고리) - depth=1
│   ├── TOY (완구) - depth=2
│   ├── CLO (의류) - depth=2
│   ├── ACC (액세서리) - depth=2
│   ├── EQU (용품) - depth=2
│   └── ...
├── BRD (브랜드) - depth=1
│   ├── LEGO (레고) - depth=2
│   ├── NIKE (나이키) - depth=2
│   ├── ADIDAS (아디다스) - depth=2
│   └── ...
├── AGE (연령대) - depth=1
│   ├── 0-6M (0-6개월) - depth=2
│   ├── 6-12M (6-12개월) - depth=2
│   ├── 1-3Y (1-3세) - depth=2
│   └── ...
├── COL (색상) - depth=1
│   ├── RED (빨강) - depth=2
│   ├── BLUE (파랑) - depth=2
│   ├── WHITE (흰색) - depth=2
│   └── ...
├── SZE (사이즈) - depth=1
│   ├── XS (엑스스몰) - depth=2
│   ├── S (스몰) - depth=2
│   ├── M (미디움) - depth=2
│   └── ...
├── MAT (소재) - depth=1
│   ├── COT (면) - depth=2
│   ├── POL (폴리에스터) - depth=2
│   ├── WOL (울) - depth=2
│   └── ...
├── SEA (시즌) - depth=1
│   ├── SPR (봄) - depth=2
│   ├── SUM (여름) - depth=2
│   ├── AUT (가을) - depth=2
│   ├── WIN (겨울) - depth=2
│   └── ALL (사계절) - depth=2
├── ORI (원산지) - depth=1
│   ├── KOR (한국) - depth=2
│   ├── CHN (중국) - depth=2
│   ├── USA (미국) - depth=2
│   └── ...
└── [확장 분류] - depth=1
    ├── [새 분류 코드1] - depth=2
    └── [새 분류 코드2] - depth=2
```

## 🗃️ 데이터 모델 설계

### 1. ErpiaProduct 모델 확장
```python
class ErpiaProduct(db.Model):
    """ERPia 상품 정보 모델 - 동적 분류 지원"""
    __tablename__ = 'erpia_product'
    
    # 기본 키
    seq = db.Column(db.Integer, primary_key=True, autoincrement=True)
    
    # ERPia 기본 상품 정보
    product_code = db.Column('item_code', db.String(50), index=True)  # ERPia 상품 코드
    product_name = db.Column('item_name', db.String(200))  # 상품명
    product_name_eng = db.Column('item_name_eng', db.String(200))  # 영문 상품명
    
    # 가격 정보
    cost_price = db.Column('cost_price', db.Numeric(15, 2))  # 원가
    sell_price = db.Column('sell_price', db.Numeric(15, 2))  # 판매가
    supply_price = db.Column('supply_price', db.Numeric(15, 2))  # 공급가
    
    # 재고 정보
    stock_qty = db.Column('stock_qty', db.Integer, default=0)  # 현재고
    safety_stock = db.Column('safety_stock', db.Integer, default=0)  # 안전재고
    
    # 상품 속성
    barcode = db.Column('barcode', db.String(50))  # 바코드
    unit = db.Column('unit', db.String(20))  # 단위
    weight = db.Column('weight', db.Numeric(10, 3))  # 무게
    volume = db.Column('volume', db.Numeric(10, 3))  # 부피
    
    # 상태 정보
    status = db.Column('status', db.String(10), default='1')  # 상태 (1:사용, 9:미사용)
    use_yn = db.Column('use_yn', db.String(1), default='Y')  # 사용 여부
    
    # ERPia 수집 정보
    admin_code = db.Column('admin_code', db.String(50))  # ERPia 관리자 코드
    company_id = db.Column('company_id', db.Integer, default=1)  # 회사 ID
    
    # ========== 동적 분류 필드들 (PRD 그룹) ==========
    # 매장 관리와 동일한 패턴으로 확장 가능
    category_type = db.Column('category_type', db.String(50))     # 카테고리 (CAT)
    brand_type = db.Column('brand_type', db.String(50))           # 브랜드 (BRD)
    age_type = db.Column('age_type', db.String(50))               # 연령대 (AGE)
    color_type = db.Column('color_type', db.String(50))           # 색상 (COL)
    size_type = db.Column('size_type', db.String(50))             # 사이즈 (SZE)
    material_type = db.Column('material_type', db.String(50))     # 소재 (MAT)
    season_type = db.Column('season_type', db.String(50))         # 시즌 (SEA)
    origin_type = db.Column('origin_type', db.String(50))         # 원산지 (ORI)
    # [추가 분류 필드들이 동적으로 확장 가능]
    
    # 생성/수정 정보
    ins_user = db.Column('ins_user', db.String(50))
    ins_date = db.Column('ins_date', db.DateTime, default=datetime.utcnow)
    upt_user = db.Column('upt_user', db.String(50))
    upt_date = db.Column('upt_date', db.DateTime, default=datetime.utcnow)
    
    def to_dict(self):
        """상품 정보를 딕셔너리로 변환"""
        return {
            'seq': self.seq,
            'product_code': self.product_code,
            'product_name': self.product_name,
            'product_name_eng': self.product_name_eng,
            'cost_price': float(self.cost_price) if self.cost_price else 0,
            'sell_price': float(self.sell_price) if self.sell_price else 0,
            'supply_price': float(self.supply_price) if self.supply_price else 0,
            'stock_qty': self.stock_qty,
            'safety_stock': self.safety_stock,
            'barcode': self.barcode,
            'unit': self.unit,
            'weight': float(self.weight) if self.weight else 0,
            'volume': float(self.volume) if self.volume else 0,
            'status': self.status,
            'use_yn': self.use_yn,
            'admin_code': self.admin_code,
            'company_id': self.company_id,
            # 동적 분류 필드들
            'category_type': self.category_type,
            'brand_type': self.brand_type,
            'age_type': self.age_type,
            'color_type': self.color_type,
            'size_type': self.size_type,
            'material_type': self.material_type,
            'season_type': self.season_type,
            'origin_type': self.origin_type,
            'ins_user': self.ins_user,
            'ins_date': self.ins_date.isoformat() if self.ins_date else None,
            'upt_user': self.upt_user,
            'upt_date': self.upt_date.isoformat() if self.upt_date else None
        }
    
    @classmethod
    def get_by_product_code(cls, product_code, company_id):
        """상품 코드로 상품 조회"""
        return cls.query.filter_by(
            product_code=product_code,
            company_id=company_id
        ).first()
    
    @classmethod
    def search_products(cls, company_id, search=None, category=None, brand=None, status=None):
        """상품 검색"""
        query = cls.query.filter_by(company_id=company_id)
        
        if search:
            query = query.filter(
                db.or_(
                    cls.product_name.like(f'%{search}%'),
                    cls.product_code.like(f'%{search}%'),
                    cls.barcode.like(f'%{search}%')
                )
            )
        
        if category:
            query = query.filter_by(category_type=category)
        
        if brand:
            query = query.filter_by(brand_type=brand)
        
        if status:
            query = query.filter_by(status=status)
        
        return query.order_by(cls.product_name.asc())
```

## 🔧 API 설계

### 1. 상품 관리 Blueprint
```python
# app/product/__init__.py
from flask import Blueprint, render_template, request, jsonify, session, redirect, url_for, send_file
from app.common.models import db, ErpiaProduct, Code
from sqlalchemy import or_, and_
import logging
from datetime import datetime

logger = logging.getLogger(__name__)

# Blueprint 생성
product_bp = Blueprint('product', __name__, url_prefix='/product')

@product_bp.route('/')
@product_bp.route('/index')
def index():
    """상품 관리 메인 페이지"""
    # 세션 체크
    if not session.get('member_seq'):
        return redirect(url_for('auth.login'))
    
    current_company_id = session.get('current_company_id', 1)
    
    logger.info(f"🛍️ 상품 관리 페이지 접근: company_id={current_company_id}")
    
    return render_template('product/index.html')

@product_bp.route('/api/products')
def api_get_products():
    """상품 목록 조회 API"""
    try:
        current_company_id = session.get('current_company_id', 1)
        search = request.args.get('search', '').strip()
        category = request.args.get('category', '')
        brand = request.args.get('brand', '')
        status = request.args.get('status', '')
        page = int(request.args.get('page', 1))
        per_page = int(request.args.get('per_page', 20))
        
        # 기본 쿼리
        query = ErpiaProduct.query.filter_by(company_id=current_company_id)
        
        # 검색 필터링
        if search:
            query = query.filter(
                or_(
                    ErpiaProduct.product_name.like(f'%{search}%'),
                    ErpiaProduct.product_code.like(f'%{search}%'),
                    ErpiaProduct.barcode.like(f'%{search}%')
                )
            )
        
        # 분류 필터링
        if category:
            query = query.filter_by(category_type=category)
        
        if brand:
            query = query.filter_by(brand_type=brand)
        
        if status:
            query = query.filter_by(status=status)
        
        # 페이징
        total = query.count()
        products = query.order_by(ErpiaProduct.product_name.asc()).paginate(
            page=page, per_page=per_page, error_out=False
        )
        
        return jsonify({
            'success': True,
            'data': [product.to_dict() for product in products.items],
            'pagination': {
                'page': page,
                'per_page': per_page,
                'total': total,
                'pages': products.pages,
                'has_prev': products.has_prev,
                'has_next': products.has_next
            }
        })
    except Exception as e:
        logger.error(f"❌ 상품 목록 조회 실패: {str(e)}")
        return jsonify({'success': False, 'message': str(e)}), 500

@product_bp.route('/api/classifications')
def api_get_product_classifications():
    """상품 분류정보 조회 API - PRD 코드 관리와 완전 연동"""
    try:
        classifications = {}
        
        # PRD 그룹 찾기
        prd_group = Code.query.filter_by(code='PRD', depth=0).first()
        if not prd_group:
            logger.warning("❌ PRD 그룹을 찾을 수 없습니다.")
            return jsonify({'success': True, 'data': {}})
        
        logger.info(f"🔍 PRD 그룹 찾음: {prd_group.code_name} (seq: {prd_group.seq})")
        
        # PRD 하위의 모든 분류 그룹들을 동적으로 조회 (depth=1)
        classification_groups = Code.query.filter_by(
            parent_seq=prd_group.seq, 
            depth=1
        ).order_by(Code.sort.asc()).all()
        
        logger.info(f"🏷️ 발견된 분류 그룹 수: {len(classification_groups)}")
        
        for group in classification_groups:
            # 각 분류 그룹의 하위 코드들 조회 (depth=2)
            sub_codes = Code.query.filter_by(
                parent_seq=group.seq,
                depth=2
            ).order_by(Code.sort.asc()).all()
            
            # 분류 그룹 키는 소문자로 통일
            group_key = group.code.lower()
            classifications[group_key] = {
                'group_info': {
                    'code': group.code,
                    'name': group.code_name,
                    'seq': group.seq,
                    'sort': group.sort
                },
                'codes': [code.to_dict() for code in sub_codes]
            }
            
            logger.info(f"  📂 {group.code}({group.code_name}): {len(sub_codes)}개 하위 코드")
        
        # 결과에 메타정보 추가
        result = {
            'success': True,
            'data': classifications,
            'meta': {
                'total_groups': len(classification_groups),
                'prd_group': {
                    'seq': prd_group.seq,
                    'name': prd_group.code_name
                },
                'last_updated': datetime.utcnow().isoformat()
            }
        }
        
        logger.info(f"✅ 상품 분류 정보 조회 완료: {len(classifications)}개 그룹")
        return jsonify(result)
        
    except Exception as e:
        logger.error(f"❌ 상품 분류 정보 조회 오류: {str(e)}")
        return jsonify({
            'success': False, 
            'message': str(e),
            'data': {}
        }), 500

@product_bp.route('/api/product/<int:product_seq>')
def api_get_product_info(product_seq):
    """상품 상세 정보 조회 API"""
    try:
        current_company_id = session.get('current_company_id', 1)
        
        product = ErpiaProduct.query.filter_by(
            seq=product_seq,
            company_id=current_company_id
        ).first()
        
        if not product:
            return jsonify({'success': False, 'message': '상품을 찾을 수 없습니다.'}), 404
        
        return jsonify({
            'success': True,
            'data': product.to_dict()
        })
    except Exception as e:
        logger.error(f"❌ 상품 정보 조회 실패: {str(e)}")
        return jsonify({'success': False, 'message': str(e)}), 500

@product_bp.route('/api/product/<int:product_seq>', methods=['PUT'])
def api_update_product(product_seq):
    """상품 정보 수정 API - 동적 필드 지원"""
    try:
        current_company_id = session.get('current_company_id', 1)
        member_id = session.get('member_id', 'admin')
        
        product = ErpiaProduct.query.filter_by(
            seq=product_seq,
            company_id=current_company_id
        ).first()
        
        if not product:
            return jsonify({'success': False, 'message': '상품을 찾을 수 없습니다.'}), 404
        
        data = request.get_json()
        
        # 수정 가능한 필드들 동적 조회 (매장 관리와 동일한 패턴)
        from sqlalchemy import inspect
        mapper = inspect(ErpiaProduct)
        updatable_fields = []
        
        exclude_fields = {
            'seq', 'company_id', 'product_code', 'ins_user', 'ins_date', 'upt_user', 'upt_date'
        }
        
        for column in mapper.columns:
            field_name = column.name
            if field_name not in exclude_fields:
                updatable_fields.append(field_name)
        
        # 데이터에서 수정 가능한 필드들만 업데이트
        for field in updatable_fields:
            if field in data:
                setattr(product, field, data[field])
        
        # 수정 정보 업데이트
        product.upt_user = member_id
        product.upt_date = datetime.utcnow()
        
        db.session.commit()
        
        logger.info(f"✅ 상품 정보 수정 완료: seq={product_seq}, name={product.product_name}")
        
        return jsonify({
            'success': True,
            'message': '상품 정보가 수정되었습니다.',
            'data': product.to_dict()
        })
    except Exception as e:
        db.session.rollback()
        logger.error(f"❌ 상품 정보 수정 실패: {str(e)}")
        return jsonify({'success': False, 'message': str(e)}), 500

@product_bp.route('/api/sync-erpia', methods=['POST'])
def api_sync_erpia_products():
    """ERPia에서 상품 정보 동기화 API"""
    try:
        # 세션 체크
        if not session.get('member_seq'):
            logger.warning("❌ 인증 실패: 세션 없음")
            return jsonify({'success': False, 'message': '로그인이 필요합니다.'}), 401
        
        current_company_id = session.get('current_company_id', 1)
        member_id = session.get('member_id', 'admin')
        
        logger.info(f"🔄 ERPia 상품 정보 동기화 시작: company_id={current_company_id}")
        
        # ERPia 클라이언트 초기화
        from app.services.erpia_client import ErpiaApiClient
        erpia_client = ErpiaApiClient(company_id=current_company_id)
        
        # ERPia에서 상품 정보 가져오기 (MODE=ITEM)
        logger.info("📡 ERPia에서 상품 정보 가져오는 중...")
        products_data = erpia_client.fetch_products()  # 새로 구현 필요
        
        if not products_data:
            return jsonify({
                'success': False,
                'message': 'ERPia에서 상품 데이터를 가져올 수 없습니다.'
            }), 400
        
        logger.info(f"📊 총 {len(products_data)}개 상품 데이터 수집 완료")
        
        # 데이터베이스 UPSERT 처리
        updated_count = 0
        inserted_count = 0
        error_count = 0
        
        for product_data in products_data:
            try:
                product_code = product_data.get('product_code', '').strip()
                if not product_code:
                    error_count += 1
                    continue
                
                # 기존 상품 찾기
                existing_product = ErpiaProduct.query.filter_by(
                    product_code=product_code,
                    company_id=current_company_id
                ).first()
                
                if existing_product:
                    # 업데이트
                    logger.info(f"📝 기존 상품 업데이트: {product_code}")
                    
                    # 시스템 필드 제외하고 업데이트
                    system_fields = {'seq', 'ins_user', 'ins_date', 'company_id'}
                    
                    for key, value in product_data.items():
                        if hasattr(existing_product, key) and key not in system_fields:
                            setattr(existing_product, key, value)
                    
                    existing_product.upt_user = member_id
                    existing_product.upt_date = datetime.utcnow()
                    updated_count += 1
                    
                else:
                    # 신규 삽입
                    logger.info(f"➕ 신규 상품 추가: {product_code}")
                    
                    # 시스템 필드 제외하고 필터링
                    system_fields = {'seq', 'ins_user', 'ins_date', 'upt_user', 'upt_date', 'company_id'}
                    
                    product_data_filtered = {}
                    for key, value in product_data.items():
                        if hasattr(ErpiaProduct, key) and key not in system_fields:
                            product_data_filtered[key] = value
                    
                    new_product = ErpiaProduct(
                        company_id=current_company_id,
                        ins_user=member_id,
                        ins_date=datetime.utcnow(),
                        upt_user=member_id,
                        upt_date=datetime.utcnow(),
                        **product_data_filtered
                    )
                    db.session.add(new_product)
                    inserted_count += 1
                
            except Exception as e:
                logger.error(f"❌ 상품 데이터 처리 실패: {product_code}, 오류: {str(e)}")
                error_count += 1
                continue
        
        # 변경사항 커밋
        db.session.commit()
        
        result_message = f"동기화 완료: {updated_count}개 업데이트, {inserted_count}개 신규 추가"
        if error_count > 0:
            result_message += f", {error_count}개 오류"
        
        logger.info(f"✅ ERPia 상품 정보 동기화 완료: {result_message}")
        
        return jsonify({
            'success': True,
            'message': result_message,
            'data': {
                'company_id': current_company_id,
                'total_fetched': len(products_data),
                'updated': updated_count,
                'inserted': inserted_count,
                'errors': error_count
            }
        })
        
    except Exception as e:
        db.session.rollback()
        logger.error(f"❌ ERPia 상품 동기화 실패: {str(e)}")
        return jsonify({
            'success': False, 
            'message': f'동기화 중 오류가 발생했습니다: {str(e)}'
        }), 500
```

## 🎨 UI 설계

### 1. 상품 관리 메인 페이지 구조
```html
<!-- app/templates/product/index.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>상품 관리 - MIS v2</title>
    <!-- Bootstrap 5.3 및 Font Awesome -->
</head>
<body>
    <div class="container-fluid mt-3">
        <!-- 상품 관리 헤더 -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2><i class="fas fa-box-open text-primary"></i> 상품 관리</h2>
                <p class="text-muted">ERPia 연동 상품 정보 관리</p>
            </div>
            <div>
                <button class="btn btn-info me-2" onclick="syncProductsFromErpia()">
                    <i class="fas fa-sync-alt"></i> ERPia 동기화
                </button>
                <button class="btn btn-success" onclick="exportToExcel()">
                    <i class="fas fa-file-excel"></i> 엑셀 다운로드
                </button>
            </div>
        </div>
        
        <!-- 상품 필터 및 검색 -->
        <div class="card mb-4">
            <div class="card-body">
                <div class="row">
                    <!-- 상품 분류 필터 -->
                    <div class="col-md-2">
                        <label class="form-label">카테고리</label>
                        <select class="form-control" id="categoryFilter">
                            <option value="">전체</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">브랜드</label>
                        <select class="form-control" id="brandFilter">
                            <option value="">전체</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">상태</label>
                        <select class="form-control" id="statusFilter">
                            <option value="">전체</option>
                            <option value="1">사용</option>
                            <option value="9">미사용</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">상품 검색</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="searchInput" 
                                   placeholder="상품명, 상품코드, 바코드로 검색...">
                            <button class="btn btn-outline-secondary" onclick="searchProducts()">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                        <button class="btn btn-secondary w-100" onclick="resetSearch()">
                            <i class="fas fa-undo"></i> 초기화
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 상품 목록 테이블 -->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>상품코드</th>
                                <th>상품명</th>
                                <th>카테고리</th>
                                <th>브랜드</th>
                                <th>판매가</th>
                                <th>재고</th>
                                <th>상태</th>
                                <th>관리</th>
                            </tr>
                        </thead>
                        <tbody id="productsTableBody">
                            <!-- 동적으로 생성 -->
                        </tbody>
                    </table>
                </div>
                
                <!-- 페이징 -->
                <nav aria-label="상품 페이징">
                    <ul class="pagination justify-content-center" id="productsPagination">
                        <!-- 동적으로 생성 -->
                    </ul>
                </nav>
            </div>
        </div>
    </div>
    
    <!-- 상품 상세/수정 모달 -->
    <div class="modal fade" id="productModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-box-open"></i> 상품 정보
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- 탭 네비게이션 -->
                    <ul class="nav nav-tabs" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" data-bs-toggle="tab" href="#basicInfo">
                                <i class="fas fa-info-circle"></i> 기본정보
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#priceInfo">
                                <i class="fas fa-won-sign"></i> 가격정보
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#stockInfo">
                                <i class="fas fa-warehouse"></i> 재고정보
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#classificationInfo">
                                <i class="fas fa-tags"></i> 분류정보
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#additionalInfo">
                                <i class="fas fa-plus-circle"></i> 추가정보
                            </a>
                        </li>
                    </ul>
                    
                    <!-- 탭 컨텐츠 -->
                    <div class="tab-content mt-3">
                        <!-- 기본정보 탭 -->
                        <div class="tab-pane fade show active" id="basicInfo">
                            <div class="row">
                                <input type="hidden" id="product_seq">
                                <div class="col-md-6">
                                    <label class="form-label">상품코드</label>
                                    <input type="text" class="form-control" id="product_code" readonly>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">바코드</label>
                                    <input type="text" class="form-control" id="barcode">
                                </div>
                                <div class="col-md-12 mt-3">
                                    <label class="form-label">상품명</label>
                                    <input type="text" class="form-control" id="product_name">
                                </div>
                                <div class="col-md-12 mt-3">
                                    <label class="form-label">영문 상품명</label>
                                    <input type="text" class="form-control" id="product_name_eng">
                                </div>
                                <div class="col-md-6 mt-3">
                                    <label class="form-label">단위</label>
                                    <input type="text" class="form-control" id="unit">
                                </div>
                                <div class="col-md-6 mt-3">
                                    <label class="form-label">상태</label>
                                    <select class="form-control" id="status">
                                        <option value="1">사용</option>
                                        <option value="9">미사용</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 분류정보 탭 (동적 생성) -->
                        <div class="tab-pane fade" id="classificationInfo">
                            <div class="row" id="productClassificationsContainer">
                                <div class="col-12 text-center">
                                    <div class="spinner-border" role="status">
                                        <span class="visually-hidden">로딩 중...</span>
                                    </div>
                                    <p class="mt-2">분류 정보를 불러오는 중...</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 기타 탭들... -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                    <button type="button" class="btn btn-primary" onclick="saveProduct()">
                        <i class="fas fa-save"></i> 저장
                    </button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
```

### 2. 동적 분류 JavaScript
```javascript
// 상품 분류 관리 (매장 관리와 동일한 패턴)
let productClassificationGroups = [];
let productClassifications = {};

// 상품 분류 정보 로드
function loadProductClassifications() {
    $.ajax({
        url: '/product/api/classifications',
        method: 'GET',
        dataType: 'json'
    })
    .done(function(response) {
        if (response.success) {
            productClassifications = response.data;
            productClassificationGroups = [];
            
            // 분류 그룹 정보 구성
            Object.keys(productClassifications).forEach(function(key) {
                const classification = productClassifications[key];
                productClassificationGroups.push({
                    key: key,
                    code: classification.group_info.code,
                    name: classification.group_info.name,
                    seq: classification.group_info.seq,
                    sort: classification.group_info.sort,
                    sub_codes_count: classification.codes.length
                });
            });
            
            // 정렬
            productClassificationGroups.sort((a, b) => a.sort - b.sort);
            
            console.log(`📋 상품 분류 정보 로드 완료: ${productClassificationGroups.length}개 그룹`);
            
            // UI 구성
            buildProductClassificationUI();
            populateProductClassificationDropdowns();
            
        } else {
            showProductClassificationError('분류 정보를 불러올 수 없습니다.');
        }
    })
    .fail(function() {
        console.error('❌ 상품 분류 정보 로드 서버 오류');
        showProductClassificationError('분류 정보 로딩 중 오류가 발생했습니다.');
    });
}

// 상품 분류 UI 동적 생성 (매장 관리와 동일한 패턴)
function buildProductClassificationUI() {
    const container = $('#productClassificationsContainer');
    
    if (!productClassificationGroups || productClassificationGroups.length === 0) {
        container.html(`
            <div class="col-12 text-center text-muted">
                <i class="fas fa-info-circle"></i> 사용 가능한 분류 정보가 없습니다.
                <br><small>코드 관리에서 PRD 그룹에 분류를 추가해주세요.</small>
            </div>
        `);
        return;
    }
    
    let html = '';
    
    // 분류 그룹별로 드롭다운 생성 (2열 레이아웃)
    productClassificationGroups.forEach(function(group, index) {
        const fieldId = group.key; // 소문자 키 사용
        const fieldName = group.name;
        
        html += `
            <div class="col-md-6 mb-3">
                <label for="${fieldId}" class="form-label">
                    <i class="fas fa-tag text-primary"></i> ${fieldName}
                    <small class="text-muted">(${group.sub_codes_count}개 옵션)</small>
                </label>
                <select class="form-control product-classification-select" 
                        id="${fieldId}" 
                        data-group-code="${group.code}"
                        data-group-seq="${group.seq}">
                    <option value="">선택하세요</option>
                </select>
            </div>
        `;
    });
    
    // 추가 정보 표시
    html += `
        <div class="col-12 mt-3">
            <div class="alert alert-info alert-sm">
                <i class="fas fa-lightbulb"></i> 
                <strong>분류 정보 안내:</strong> 
                총 ${productClassificationGroups.length}개의 분류 그룹이 있습니다. 
                분류는 <a href="/admin/code_management" target="_blank">코드 관리 > PRD</a>에서 관리할 수 있습니다.
            </div>
        </div>
    `;
    
    container.html(html);
    console.log(`🎨 상품 분류 UI 생성 완료: ${productClassificationGroups.length}개 드롭다운`);
}
```

## 📊 구현 로드맵

### Phase 1: 기본 구조 (1주)
1. **PRD 코드 그룹 생성**: 코드 관리에 PRD 최상위 그룹 추가
2. **ErpiaProduct 모델**: 데이터베이스 테이블 및 모델 생성
3. **기본 API**: 상품 목록, 상세 조회 API 구현

### Phase 2: 동적 분류 (1주)
1. **분류 API**: `/product/api/classifications` 구현
2. **동적 UI**: 분류 드롭다운 자동 생성 JavaScript
3. **분류 적용**: 상품 정보 수정 시 분류 저장

### Phase 3: ERPia 연동 (1주)
1. **ERPia 상품 API**: `fetch_products()` 메서드 구현
2. **동기화 API**: ERPia 상품 정보 UPSERT 처리
3. **스케줄링**: 자동 상품 정보 동기화

### Phase 4: 고급 기능 (1주)
1. **검색 및 필터**: 다중 조건 상품 검색
2. **엑셀 기능**: 상품 정보 엑셀 다운로드
3. **통계 대시보드**: 상품 분류별 통계

## 🎯 기대 효과

### 1. 일관된 사용자 경험
- **매장 관리와 동일한 패턴**: 학습 비용 최소화
- **통합된 분류 체계**: 코드 관리에서 통합 관리
- **직관적인 UI**: 자동 생성되는 분류 인터페이스

### 2. 운영 효율성
- **실시간 분류 관리**: 분류 추가/삭제 즉시 반영
- **ERPia 자동 동기화**: 상품 정보 자동 업데이트
- **무제한 확장**: 새로운 분류 체계 자유롭게 추가

### 3. 데이터 품질
- **일관된 분류**: 표준화된 분류 체계
- **데이터 무결성**: 존재하지 않는 분류 방지
- **변경 이력**: 모든 수정 사항 추적

## 🔗 관련 문서

- `docs/15_동적_분류_관리_시스템.md`: 매장 관리 동적 분류 시스템
- `docs/13_내일_할일_우선순위.md`: 개발 우선순위
- `docs/14_UI_UX_기본_요구사항.md`: UI/UX 가이드라인

---

**작성일**: 2025-08-07  
**작성자**: MIS v2 개발팀  
**버전**: 1.0 