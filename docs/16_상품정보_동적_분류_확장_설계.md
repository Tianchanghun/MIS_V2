# ìƒí’ˆì •ë³´ ë™ì  ë¶„ë¥˜ í™•ì¥ ì„¤ê³„

## ğŸ“‹ ê°œìš”

ë§¤ì¥ ê´€ë¦¬ì˜ ë™ì  ë¶„ë¥˜ ì‹œìŠ¤í…œê³¼ ë™ì¼í•œ íŒ¨í„´ì„ ìƒí’ˆì •ë³´ì— ì ìš©í•˜ì—¬, ìƒí’ˆ ë¶„ë¥˜ì˜ ì¶”ê°€/ìˆ˜ì •/ì‚­ì œì— ì‹¤ì‹œê°„ìœ¼ë¡œ ëŒ€ì‘í•˜ëŠ” í™•ì¥ ê°€ëŠ¥í•œ ìƒí’ˆ ê´€ë¦¬ ì‹œìŠ¤í…œì„ êµ¬í˜„í•©ë‹ˆë‹¤.

## ğŸ—ï¸ ìƒí’ˆ ë¶„ë¥˜ ì²´ê³„ ì„¤ê³„

### 1. ê³„ì¸µ êµ¬ì¡°
```
PRD (ìƒí’ˆ) - depth=0
â”œâ”€â”€ CAT (ì¹´í…Œê³ ë¦¬) - depth=1
â”‚   â”œâ”€â”€ TOY (ì™„êµ¬) - depth=2
â”‚   â”œâ”€â”€ CLO (ì˜ë¥˜) - depth=2
â”‚   â”œâ”€â”€ ACC (ì•¡ì„¸ì„œë¦¬) - depth=2
â”‚   â”œâ”€â”€ EQU (ìš©í’ˆ) - depth=2
â”‚   â””â”€â”€ ...
â”œâ”€â”€ BRD (ë¸Œëœë“œ) - depth=1
â”‚   â”œâ”€â”€ LEGO (ë ˆê³ ) - depth=2
â”‚   â”œâ”€â”€ NIKE (ë‚˜ì´í‚¤) - depth=2
â”‚   â”œâ”€â”€ ADIDAS (ì•„ë””ë‹¤ìŠ¤) - depth=2
â”‚   â””â”€â”€ ...
â”œâ”€â”€ AGE (ì—°ë ¹ëŒ€) - depth=1
â”‚   â”œâ”€â”€ 0-6M (0-6ê°œì›”) - depth=2
â”‚   â”œâ”€â”€ 6-12M (6-12ê°œì›”) - depth=2
â”‚   â”œâ”€â”€ 1-3Y (1-3ì„¸) - depth=2
â”‚   â””â”€â”€ ...
â”œâ”€â”€ COL (ìƒ‰ìƒ) - depth=1
â”‚   â”œâ”€â”€ RED (ë¹¨ê°•) - depth=2
â”‚   â”œâ”€â”€ BLUE (íŒŒë‘) - depth=2
â”‚   â”œâ”€â”€ WHITE (í°ìƒ‰) - depth=2
â”‚   â””â”€â”€ ...
â”œâ”€â”€ SZE (ì‚¬ì´ì¦ˆ) - depth=1
â”‚   â”œâ”€â”€ XS (ì—‘ìŠ¤ìŠ¤ëª°) - depth=2
â”‚   â”œâ”€â”€ S (ìŠ¤ëª°) - depth=2
â”‚   â”œâ”€â”€ M (ë¯¸ë””ì›€) - depth=2
â”‚   â””â”€â”€ ...
â”œâ”€â”€ MAT (ì†Œì¬) - depth=1
â”‚   â”œâ”€â”€ COT (ë©´) - depth=2
â”‚   â”œâ”€â”€ POL (í´ë¦¬ì—ìŠ¤í„°) - depth=2
â”‚   â”œâ”€â”€ WOL (ìš¸) - depth=2
â”‚   â””â”€â”€ ...
â”œâ”€â”€ SEA (ì‹œì¦Œ) - depth=1
â”‚   â”œâ”€â”€ SPR (ë´„) - depth=2
â”‚   â”œâ”€â”€ SUM (ì—¬ë¦„) - depth=2
â”‚   â”œâ”€â”€ AUT (ê°€ì„) - depth=2
â”‚   â”œâ”€â”€ WIN (ê²¨ìš¸) - depth=2
â”‚   â””â”€â”€ ALL (ì‚¬ê³„ì ˆ) - depth=2
â”œâ”€â”€ ORI (ì›ì‚°ì§€) - depth=1
â”‚   â”œâ”€â”€ KOR (í•œêµ­) - depth=2
â”‚   â”œâ”€â”€ CHN (ì¤‘êµ­) - depth=2
â”‚   â”œâ”€â”€ USA (ë¯¸êµ­) - depth=2
â”‚   â””â”€â”€ ...
â””â”€â”€ [í™•ì¥ ë¶„ë¥˜] - depth=1
    â”œâ”€â”€ [ìƒˆ ë¶„ë¥˜ ì½”ë“œ1] - depth=2
    â””â”€â”€ [ìƒˆ ë¶„ë¥˜ ì½”ë“œ2] - depth=2
```

## ğŸ—ƒï¸ ë°ì´í„° ëª¨ë¸ ì„¤ê³„

### 1. ErpiaProduct ëª¨ë¸ í™•ì¥
```python
class ErpiaProduct(db.Model):
    """ERPia ìƒí’ˆ ì •ë³´ ëª¨ë¸ - ë™ì  ë¶„ë¥˜ ì§€ì›"""
    __tablename__ = 'erpia_product'
    
    # ê¸°ë³¸ í‚¤
    seq = db.Column(db.Integer, primary_key=True, autoincrement=True)
    
    # ERPia ê¸°ë³¸ ìƒí’ˆ ì •ë³´
    product_code = db.Column('item_code', db.String(50), index=True)  # ERPia ìƒí’ˆ ì½”ë“œ
    product_name = db.Column('item_name', db.String(200))  # ìƒí’ˆëª…
    product_name_eng = db.Column('item_name_eng', db.String(200))  # ì˜ë¬¸ ìƒí’ˆëª…
    
    # ê°€ê²© ì •ë³´
    cost_price = db.Column('cost_price', db.Numeric(15, 2))  # ì›ê°€
    sell_price = db.Column('sell_price', db.Numeric(15, 2))  # íŒë§¤ê°€
    supply_price = db.Column('supply_price', db.Numeric(15, 2))  # ê³µê¸‰ê°€
    
    # ì¬ê³  ì •ë³´
    stock_qty = db.Column('stock_qty', db.Integer, default=0)  # í˜„ì¬ê³ 
    safety_stock = db.Column('safety_stock', db.Integer, default=0)  # ì•ˆì „ì¬ê³ 
    
    # ìƒí’ˆ ì†ì„±
    barcode = db.Column('barcode', db.String(50))  # ë°”ì½”ë“œ
    unit = db.Column('unit', db.String(20))  # ë‹¨ìœ„
    weight = db.Column('weight', db.Numeric(10, 3))  # ë¬´ê²Œ
    volume = db.Column('volume', db.Numeric(10, 3))  # ë¶€í”¼
    
    # ìƒíƒœ ì •ë³´
    status = db.Column('status', db.String(10), default='1')  # ìƒíƒœ (1:ì‚¬ìš©, 9:ë¯¸ì‚¬ìš©)
    use_yn = db.Column('use_yn', db.String(1), default='Y')  # ì‚¬ìš© ì—¬ë¶€
    
    # ERPia ìˆ˜ì§‘ ì •ë³´
    admin_code = db.Column('admin_code', db.String(50))  # ERPia ê´€ë¦¬ì ì½”ë“œ
    company_id = db.Column('company_id', db.Integer, default=1)  # íšŒì‚¬ ID
    
    # ========== ë™ì  ë¶„ë¥˜ í•„ë“œë“¤ (PRD ê·¸ë£¹) ==========
    # ë§¤ì¥ ê´€ë¦¬ì™€ ë™ì¼í•œ íŒ¨í„´ìœ¼ë¡œ í™•ì¥ ê°€ëŠ¥
    category_type = db.Column('category_type', db.String(50))     # ì¹´í…Œê³ ë¦¬ (CAT)
    brand_type = db.Column('brand_type', db.String(50))           # ë¸Œëœë“œ (BRD)
    age_type = db.Column('age_type', db.String(50))               # ì—°ë ¹ëŒ€ (AGE)
    color_type = db.Column('color_type', db.String(50))           # ìƒ‰ìƒ (COL)
    size_type = db.Column('size_type', db.String(50))             # ì‚¬ì´ì¦ˆ (SZE)
    material_type = db.Column('material_type', db.String(50))     # ì†Œì¬ (MAT)
    season_type = db.Column('season_type', db.String(50))         # ì‹œì¦Œ (SEA)
    origin_type = db.Column('origin_type', db.String(50))         # ì›ì‚°ì§€ (ORI)
    # [ì¶”ê°€ ë¶„ë¥˜ í•„ë“œë“¤ì´ ë™ì ìœ¼ë¡œ í™•ì¥ ê°€ëŠ¥]
    
    # ìƒì„±/ìˆ˜ì • ì •ë³´
    ins_user = db.Column('ins_user', db.String(50))
    ins_date = db.Column('ins_date', db.DateTime, default=datetime.utcnow)
    upt_user = db.Column('upt_user', db.String(50))
    upt_date = db.Column('upt_date', db.DateTime, default=datetime.utcnow)
    
    def to_dict(self):
        """ìƒí’ˆ ì •ë³´ë¥¼ ë”•ì…”ë„ˆë¦¬ë¡œ ë³€í™˜"""
        return {
            'seq': self.seq,
            'product_code': self.product_code,
            'product_name': self.product_name,
            'product_name_eng': self.product_name_eng,
            'cost_price': float(self.cost_price) if self.cost_price else 0,
            'sell_price': float(self.sell_price) if self.sell_price else 0,
            'supply_price': float(self.supply_price) if self.supply_price else 0,
            'stock_qty': self.stock_qty,
            'safety_stock': self.safety_stock,
            'barcode': self.barcode,
            'unit': self.unit,
            'weight': float(self.weight) if self.weight else 0,
            'volume': float(self.volume) if self.volume else 0,
            'status': self.status,
            'use_yn': self.use_yn,
            'admin_code': self.admin_code,
            'company_id': self.company_id,
            # ë™ì  ë¶„ë¥˜ í•„ë“œë“¤
            'category_type': self.category_type,
            'brand_type': self.brand_type,
            'age_type': self.age_type,
            'color_type': self.color_type,
            'size_type': self.size_type,
            'material_type': self.material_type,
            'season_type': self.season_type,
            'origin_type': self.origin_type,
            'ins_user': self.ins_user,
            'ins_date': self.ins_date.isoformat() if self.ins_date else None,
            'upt_user': self.upt_user,
            'upt_date': self.upt_date.isoformat() if self.upt_date else None
        }
    
    @classmethod
    def get_by_product_code(cls, product_code, company_id):
        """ìƒí’ˆ ì½”ë“œë¡œ ìƒí’ˆ ì¡°íšŒ"""
        return cls.query.filter_by(
            product_code=product_code,
            company_id=company_id
        ).first()
    
    @classmethod
    def search_products(cls, company_id, search=None, category=None, brand=None, status=None):
        """ìƒí’ˆ ê²€ìƒ‰"""
        query = cls.query.filter_by(company_id=company_id)
        
        if search:
            query = query.filter(
                db.or_(
                    cls.product_name.like(f'%{search}%'),
                    cls.product_code.like(f'%{search}%'),
                    cls.barcode.like(f'%{search}%')
                )
            )
        
        if category:
            query = query.filter_by(category_type=category)
        
        if brand:
            query = query.filter_by(brand_type=brand)
        
        if status:
            query = query.filter_by(status=status)
        
        return query.order_by(cls.product_name.asc())
```

## ğŸ”§ API ì„¤ê³„

### 1. ìƒí’ˆ ê´€ë¦¬ Blueprint
```python
# app/product/__init__.py
from flask import Blueprint, render_template, request, jsonify, session, redirect, url_for, send_file
from app.common.models import db, ErpiaProduct, Code
from sqlalchemy import or_, and_
import logging
from datetime import datetime

logger = logging.getLogger(__name__)

# Blueprint ìƒì„±
product_bp = Blueprint('product', __name__, url_prefix='/product')

@product_bp.route('/')
@product_bp.route('/index')
def index():
    """ìƒí’ˆ ê´€ë¦¬ ë©”ì¸ í˜ì´ì§€"""
    # ì„¸ì…˜ ì²´í¬
    if not session.get('member_seq'):
        return redirect(url_for('auth.login'))
    
    current_company_id = session.get('current_company_id', 1)
    
    logger.info(f"ğŸ›ï¸ ìƒí’ˆ ê´€ë¦¬ í˜ì´ì§€ ì ‘ê·¼: company_id={current_company_id}")
    
    return render_template('product/index.html')

@product_bp.route('/api/products')
def api_get_products():
    """ìƒí’ˆ ëª©ë¡ ì¡°íšŒ API"""
    try:
        current_company_id = session.get('current_company_id', 1)
        search = request.args.get('search', '').strip()
        category = request.args.get('category', '')
        brand = request.args.get('brand', '')
        status = request.args.get('status', '')
        page = int(request.args.get('page', 1))
        per_page = int(request.args.get('per_page', 20))
        
        # ê¸°ë³¸ ì¿¼ë¦¬
        query = ErpiaProduct.query.filter_by(company_id=current_company_id)
        
        # ê²€ìƒ‰ í•„í„°ë§
        if search:
            query = query.filter(
                or_(
                    ErpiaProduct.product_name.like(f'%{search}%'),
                    ErpiaProduct.product_code.like(f'%{search}%'),
                    ErpiaProduct.barcode.like(f'%{search}%')
                )
            )
        
        # ë¶„ë¥˜ í•„í„°ë§
        if category:
            query = query.filter_by(category_type=category)
        
        if brand:
            query = query.filter_by(brand_type=brand)
        
        if status:
            query = query.filter_by(status=status)
        
        # í˜ì´ì§•
        total = query.count()
        products = query.order_by(ErpiaProduct.product_name.asc()).paginate(
            page=page, per_page=per_page, error_out=False
        )
        
        return jsonify({
            'success': True,
            'data': [product.to_dict() for product in products.items],
            'pagination': {
                'page': page,
                'per_page': per_page,
                'total': total,
                'pages': products.pages,
                'has_prev': products.has_prev,
                'has_next': products.has_next
            }
        })
    except Exception as e:
        logger.error(f"âŒ ìƒí’ˆ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨: {str(e)}")
        return jsonify({'success': False, 'message': str(e)}), 500

@product_bp.route('/api/classifications')
def api_get_product_classifications():
    """ìƒí’ˆ ë¶„ë¥˜ì •ë³´ ì¡°íšŒ API - PRD ì½”ë“œ ê´€ë¦¬ì™€ ì™„ì „ ì—°ë™"""
    try:
        classifications = {}
        
        # PRD ê·¸ë£¹ ì°¾ê¸°
        prd_group = Code.query.filter_by(code='PRD', depth=0).first()
        if not prd_group:
            logger.warning("âŒ PRD ê·¸ë£¹ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            return jsonify({'success': True, 'data': {}})
        
        logger.info(f"ğŸ” PRD ê·¸ë£¹ ì°¾ìŒ: {prd_group.code_name} (seq: {prd_group.seq})")
        
        # PRD í•˜ìœ„ì˜ ëª¨ë“  ë¶„ë¥˜ ê·¸ë£¹ë“¤ì„ ë™ì ìœ¼ë¡œ ì¡°íšŒ (depth=1)
        classification_groups = Code.query.filter_by(
            parent_seq=prd_group.seq, 
            depth=1
        ).order_by(Code.sort.asc()).all()
        
        logger.info(f"ğŸ·ï¸ ë°œê²¬ëœ ë¶„ë¥˜ ê·¸ë£¹ ìˆ˜: {len(classification_groups)}")
        
        for group in classification_groups:
            # ê° ë¶„ë¥˜ ê·¸ë£¹ì˜ í•˜ìœ„ ì½”ë“œë“¤ ì¡°íšŒ (depth=2)
            sub_codes = Code.query.filter_by(
                parent_seq=group.seq,
                depth=2
            ).order_by(Code.sort.asc()).all()
            
            # ë¶„ë¥˜ ê·¸ë£¹ í‚¤ëŠ” ì†Œë¬¸ìë¡œ í†µì¼
            group_key = group.code.lower()
            classifications[group_key] = {
                'group_info': {
                    'code': group.code,
                    'name': group.code_name,
                    'seq': group.seq,
                    'sort': group.sort
                },
                'codes': [code.to_dict() for code in sub_codes]
            }
            
            logger.info(f"  ğŸ“‚ {group.code}({group.code_name}): {len(sub_codes)}ê°œ í•˜ìœ„ ì½”ë“œ")
        
        # ê²°ê³¼ì— ë©”íƒ€ì •ë³´ ì¶”ê°€
        result = {
            'success': True,
            'data': classifications,
            'meta': {
                'total_groups': len(classification_groups),
                'prd_group': {
                    'seq': prd_group.seq,
                    'name': prd_group.code_name
                },
                'last_updated': datetime.utcnow().isoformat()
            }
        }
        
        logger.info(f"âœ… ìƒí’ˆ ë¶„ë¥˜ ì •ë³´ ì¡°íšŒ ì™„ë£Œ: {len(classifications)}ê°œ ê·¸ë£¹")
        return jsonify(result)
        
    except Exception as e:
        logger.error(f"âŒ ìƒí’ˆ ë¶„ë¥˜ ì •ë³´ ì¡°íšŒ ì˜¤ë¥˜: {str(e)}")
        return jsonify({
            'success': False, 
            'message': str(e),
            'data': {}
        }), 500

@product_bp.route('/api/product/<int:product_seq>')
def api_get_product_info(product_seq):
    """ìƒí’ˆ ìƒì„¸ ì •ë³´ ì¡°íšŒ API"""
    try:
        current_company_id = session.get('current_company_id', 1)
        
        product = ErpiaProduct.query.filter_by(
            seq=product_seq,
            company_id=current_company_id
        ).first()
        
        if not product:
            return jsonify({'success': False, 'message': 'ìƒí’ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'}), 404
        
        return jsonify({
            'success': True,
            'data': product.to_dict()
        })
    except Exception as e:
        logger.error(f"âŒ ìƒí’ˆ ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨: {str(e)}")
        return jsonify({'success': False, 'message': str(e)}), 500

@product_bp.route('/api/product/<int:product_seq>', methods=['PUT'])
def api_update_product(product_seq):
    """ìƒí’ˆ ì •ë³´ ìˆ˜ì • API - ë™ì  í•„ë“œ ì§€ì›"""
    try:
        current_company_id = session.get('current_company_id', 1)
        member_id = session.get('member_id', 'admin')
        
        product = ErpiaProduct.query.filter_by(
            seq=product_seq,
            company_id=current_company_id
        ).first()
        
        if not product:
            return jsonify({'success': False, 'message': 'ìƒí’ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'}), 404
        
        data = request.get_json()
        
        # ìˆ˜ì • ê°€ëŠ¥í•œ í•„ë“œë“¤ ë™ì  ì¡°íšŒ (ë§¤ì¥ ê´€ë¦¬ì™€ ë™ì¼í•œ íŒ¨í„´)
        from sqlalchemy import inspect
        mapper = inspect(ErpiaProduct)
        updatable_fields = []
        
        exclude_fields = {
            'seq', 'company_id', 'product_code', 'ins_user', 'ins_date', 'upt_user', 'upt_date'
        }
        
        for column in mapper.columns:
            field_name = column.name
            if field_name not in exclude_fields:
                updatable_fields.append(field_name)
        
        # ë°ì´í„°ì—ì„œ ìˆ˜ì • ê°€ëŠ¥í•œ í•„ë“œë“¤ë§Œ ì—…ë°ì´íŠ¸
        for field in updatable_fields:
            if field in data:
                setattr(product, field, data[field])
        
        # ìˆ˜ì • ì •ë³´ ì—…ë°ì´íŠ¸
        product.upt_user = member_id
        product.upt_date = datetime.utcnow()
        
        db.session.commit()
        
        logger.info(f"âœ… ìƒí’ˆ ì •ë³´ ìˆ˜ì • ì™„ë£Œ: seq={product_seq}, name={product.product_name}")
        
        return jsonify({
            'success': True,
            'message': 'ìƒí’ˆ ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.',
            'data': product.to_dict()
        })
    except Exception as e:
        db.session.rollback()
        logger.error(f"âŒ ìƒí’ˆ ì •ë³´ ìˆ˜ì • ì‹¤íŒ¨: {str(e)}")
        return jsonify({'success': False, 'message': str(e)}), 500

@product_bp.route('/api/sync-erpia', methods=['POST'])
def api_sync_erpia_products():
    """ERPiaì—ì„œ ìƒí’ˆ ì •ë³´ ë™ê¸°í™” API"""
    try:
        # ì„¸ì…˜ ì²´í¬
        if not session.get('member_seq'):
            logger.warning("âŒ ì¸ì¦ ì‹¤íŒ¨: ì„¸ì…˜ ì—†ìŒ")
            return jsonify({'success': False, 'message': 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.'}), 401
        
        current_company_id = session.get('current_company_id', 1)
        member_id = session.get('member_id', 'admin')
        
        logger.info(f"ğŸ”„ ERPia ìƒí’ˆ ì •ë³´ ë™ê¸°í™” ì‹œì‘: company_id={current_company_id}")
        
        # ERPia í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
        from app.services.erpia_client import ErpiaApiClient
        erpia_client = ErpiaApiClient(company_id=current_company_id)
        
        # ERPiaì—ì„œ ìƒí’ˆ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (MODE=ITEM)
        logger.info("ğŸ“¡ ERPiaì—ì„œ ìƒí’ˆ ì •ë³´ ê°€ì ¸ì˜¤ëŠ” ì¤‘...")
        products_data = erpia_client.fetch_products()  # ìƒˆë¡œ êµ¬í˜„ í•„ìš”
        
        if not products_data:
            return jsonify({
                'success': False,
                'message': 'ERPiaì—ì„œ ìƒí’ˆ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'
            }), 400
        
        logger.info(f"ğŸ“Š ì´ {len(products_data)}ê°œ ìƒí’ˆ ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ")
        
        # ë°ì´í„°ë² ì´ìŠ¤ UPSERT ì²˜ë¦¬
        updated_count = 0
        inserted_count = 0
        error_count = 0
        
        for product_data in products_data:
            try:
                product_code = product_data.get('product_code', '').strip()
                if not product_code:
                    error_count += 1
                    continue
                
                # ê¸°ì¡´ ìƒí’ˆ ì°¾ê¸°
                existing_product = ErpiaProduct.query.filter_by(
                    product_code=product_code,
                    company_id=current_company_id
                ).first()
                
                if existing_product:
                    # ì—…ë°ì´íŠ¸
                    logger.info(f"ğŸ“ ê¸°ì¡´ ìƒí’ˆ ì—…ë°ì´íŠ¸: {product_code}")
                    
                    # ì‹œìŠ¤í…œ í•„ë“œ ì œì™¸í•˜ê³  ì—…ë°ì´íŠ¸
                    system_fields = {'seq', 'ins_user', 'ins_date', 'company_id'}
                    
                    for key, value in product_data.items():
                        if hasattr(existing_product, key) and key not in system_fields:
                            setattr(existing_product, key, value)
                    
                    existing_product.upt_user = member_id
                    existing_product.upt_date = datetime.utcnow()
                    updated_count += 1
                    
                else:
                    # ì‹ ê·œ ì‚½ì…
                    logger.info(f"â• ì‹ ê·œ ìƒí’ˆ ì¶”ê°€: {product_code}")
                    
                    # ì‹œìŠ¤í…œ í•„ë“œ ì œì™¸í•˜ê³  í•„í„°ë§
                    system_fields = {'seq', 'ins_user', 'ins_date', 'upt_user', 'upt_date', 'company_id'}
                    
                    product_data_filtered = {}
                    for key, value in product_data.items():
                        if hasattr(ErpiaProduct, key) and key not in system_fields:
                            product_data_filtered[key] = value
                    
                    new_product = ErpiaProduct(
                        company_id=current_company_id,
                        ins_user=member_id,
                        ins_date=datetime.utcnow(),
                        upt_user=member_id,
                        upt_date=datetime.utcnow(),
                        **product_data_filtered
                    )
                    db.session.add(new_product)
                    inserted_count += 1
                
            except Exception as e:
                logger.error(f"âŒ ìƒí’ˆ ë°ì´í„° ì²˜ë¦¬ ì‹¤íŒ¨: {product_code}, ì˜¤ë¥˜: {str(e)}")
                error_count += 1
                continue
        
        # ë³€ê²½ì‚¬í•­ ì»¤ë°‹
        db.session.commit()
        
        result_message = f"ë™ê¸°í™” ì™„ë£Œ: {updated_count}ê°œ ì—…ë°ì´íŠ¸, {inserted_count}ê°œ ì‹ ê·œ ì¶”ê°€"
        if error_count > 0:
            result_message += f", {error_count}ê°œ ì˜¤ë¥˜"
        
        logger.info(f"âœ… ERPia ìƒí’ˆ ì •ë³´ ë™ê¸°í™” ì™„ë£Œ: {result_message}")
        
        return jsonify({
            'success': True,
            'message': result_message,
            'data': {
                'company_id': current_company_id,
                'total_fetched': len(products_data),
                'updated': updated_count,
                'inserted': inserted_count,
                'errors': error_count
            }
        })
        
    except Exception as e:
        db.session.rollback()
        logger.error(f"âŒ ERPia ìƒí’ˆ ë™ê¸°í™” ì‹¤íŒ¨: {str(e)}")
        return jsonify({
            'success': False, 
            'message': f'ë™ê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {str(e)}'
        }), 500
```

## ğŸ¨ UI ì„¤ê³„

### 1. ìƒí’ˆ ê´€ë¦¬ ë©”ì¸ í˜ì´ì§€ êµ¬ì¡°
```html
<!-- app/templates/product/index.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìƒí’ˆ ê´€ë¦¬ - MIS v2</title>
    <!-- Bootstrap 5.3 ë° Font Awesome -->
</head>
<body>
    <div class="container-fluid mt-3">
        <!-- ìƒí’ˆ ê´€ë¦¬ í—¤ë” -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2><i class="fas fa-box-open text-primary"></i> ìƒí’ˆ ê´€ë¦¬</h2>
                <p class="text-muted">ERPia ì—°ë™ ìƒí’ˆ ì •ë³´ ê´€ë¦¬</p>
            </div>
            <div>
                <button class="btn btn-info me-2" onclick="syncProductsFromErpia()">
                    <i class="fas fa-sync-alt"></i> ERPia ë™ê¸°í™”
                </button>
                <button class="btn btn-success" onclick="exportToExcel()">
                    <i class="fas fa-file-excel"></i> ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
                </button>
            </div>
        </div>
        
        <!-- ìƒí’ˆ í•„í„° ë° ê²€ìƒ‰ -->
        <div class="card mb-4">
            <div class="card-body">
                <div class="row">
                    <!-- ìƒí’ˆ ë¶„ë¥˜ í•„í„° -->
                    <div class="col-md-2">
                        <label class="form-label">ì¹´í…Œê³ ë¦¬</label>
                        <select class="form-control" id="categoryFilter">
                            <option value="">ì „ì²´</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">ë¸Œëœë“œ</label>
                        <select class="form-control" id="brandFilter">
                            <option value="">ì „ì²´</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">ìƒíƒœ</label>
                        <select class="form-control" id="statusFilter">
                            <option value="">ì „ì²´</option>
                            <option value="1">ì‚¬ìš©</option>
                            <option value="9">ë¯¸ì‚¬ìš©</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">ìƒí’ˆ ê²€ìƒ‰</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="searchInput" 
                                   placeholder="ìƒí’ˆëª…, ìƒí’ˆì½”ë“œ, ë°”ì½”ë“œë¡œ ê²€ìƒ‰...">
                            <button class="btn btn-outline-secondary" onclick="searchProducts()">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                        <button class="btn btn-secondary w-100" onclick="resetSearch()">
                            <i class="fas fa-undo"></i> ì´ˆê¸°í™”
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ìƒí’ˆ ëª©ë¡ í…Œì´ë¸” -->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>ìƒí’ˆì½”ë“œ</th>
                                <th>ìƒí’ˆëª…</th>
                                <th>ì¹´í…Œê³ ë¦¬</th>
                                <th>ë¸Œëœë“œ</th>
                                <th>íŒë§¤ê°€</th>
                                <th>ì¬ê³ </th>
                                <th>ìƒíƒœ</th>
                                <th>ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody id="productsTableBody">
                            <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
                        </tbody>
                    </table>
                </div>
                
                <!-- í˜ì´ì§• -->
                <nav aria-label="ìƒí’ˆ í˜ì´ì§•">
                    <ul class="pagination justify-content-center" id="productsPagination">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
                    </ul>
                </nav>
            </div>
        </div>
    </div>
    
    <!-- ìƒí’ˆ ìƒì„¸/ìˆ˜ì • ëª¨ë‹¬ -->
    <div class="modal fade" id="productModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-box-open"></i> ìƒí’ˆ ì •ë³´
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
                    <ul class="nav nav-tabs" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" data-bs-toggle="tab" href="#basicInfo">
                                <i class="fas fa-info-circle"></i> ê¸°ë³¸ì •ë³´
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#priceInfo">
                                <i class="fas fa-won-sign"></i> ê°€ê²©ì •ë³´
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#stockInfo">
                                <i class="fas fa-warehouse"></i> ì¬ê³ ì •ë³´
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#classificationInfo">
                                <i class="fas fa-tags"></i> ë¶„ë¥˜ì •ë³´
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#additionalInfo">
                                <i class="fas fa-plus-circle"></i> ì¶”ê°€ì •ë³´
                            </a>
                        </li>
                    </ul>
                    
                    <!-- íƒ­ ì»¨í…ì¸  -->
                    <div class="tab-content mt-3">
                        <!-- ê¸°ë³¸ì •ë³´ íƒ­ -->
                        <div class="tab-pane fade show active" id="basicInfo">
                            <div class="row">
                                <input type="hidden" id="product_seq">
                                <div class="col-md-6">
                                    <label class="form-label">ìƒí’ˆì½”ë“œ</label>
                                    <input type="text" class="form-control" id="product_code" readonly>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">ë°”ì½”ë“œ</label>
                                    <input type="text" class="form-control" id="barcode">
                                </div>
                                <div class="col-md-12 mt-3">
                                    <label class="form-label">ìƒí’ˆëª…</label>
                                    <input type="text" class="form-control" id="product_name">
                                </div>
                                <div class="col-md-12 mt-3">
                                    <label class="form-label">ì˜ë¬¸ ìƒí’ˆëª…</label>
                                    <input type="text" class="form-control" id="product_name_eng">
                                </div>
                                <div class="col-md-6 mt-3">
                                    <label class="form-label">ë‹¨ìœ„</label>
                                    <input type="text" class="form-control" id="unit">
                                </div>
                                <div class="col-md-6 mt-3">
                                    <label class="form-label">ìƒíƒœ</label>
                                    <select class="form-control" id="status">
                                        <option value="1">ì‚¬ìš©</option>
                                        <option value="9">ë¯¸ì‚¬ìš©</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ë¶„ë¥˜ì •ë³´ íƒ­ (ë™ì  ìƒì„±) -->
                        <div class="tab-pane fade" id="classificationInfo">
                            <div class="row" id="productClassificationsContainer">
                                <div class="col-12 text-center">
                                    <div class="spinner-border" role="status">
                                        <span class="visually-hidden">ë¡œë”© ì¤‘...</span>
                                    </div>
                                    <p class="mt-2">ë¶„ë¥˜ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ê¸°íƒ€ íƒ­ë“¤... -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                    <button type="button" class="btn btn-primary" onclick="saveProduct()">
                        <i class="fas fa-save"></i> ì €ì¥
                    </button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
```

### 2. ë™ì  ë¶„ë¥˜ JavaScript
```javascript
// ìƒí’ˆ ë¶„ë¥˜ ê´€ë¦¬ (ë§¤ì¥ ê´€ë¦¬ì™€ ë™ì¼í•œ íŒ¨í„´)
let productClassificationGroups = [];
let productClassifications = {};

// ìƒí’ˆ ë¶„ë¥˜ ì •ë³´ ë¡œë“œ
function loadProductClassifications() {
    $.ajax({
        url: '/product/api/classifications',
        method: 'GET',
        dataType: 'json'
    })
    .done(function(response) {
        if (response.success) {
            productClassifications = response.data;
            productClassificationGroups = [];
            
            // ë¶„ë¥˜ ê·¸ë£¹ ì •ë³´ êµ¬ì„±
            Object.keys(productClassifications).forEach(function(key) {
                const classification = productClassifications[key];
                productClassificationGroups.push({
                    key: key,
                    code: classification.group_info.code,
                    name: classification.group_info.name,
                    seq: classification.group_info.seq,
                    sort: classification.group_info.sort,
                    sub_codes_count: classification.codes.length
                });
            });
            
            // ì •ë ¬
            productClassificationGroups.sort((a, b) => a.sort - b.sort);
            
            console.log(`ğŸ“‹ ìƒí’ˆ ë¶„ë¥˜ ì •ë³´ ë¡œë“œ ì™„ë£Œ: ${productClassificationGroups.length}ê°œ ê·¸ë£¹`);
            
            // UI êµ¬ì„±
            buildProductClassificationUI();
            populateProductClassificationDropdowns();
            
        } else {
            showProductClassificationError('ë¶„ë¥˜ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
    })
    .fail(function() {
        console.error('âŒ ìƒí’ˆ ë¶„ë¥˜ ì •ë³´ ë¡œë“œ ì„œë²„ ì˜¤ë¥˜');
        showProductClassificationError('ë¶„ë¥˜ ì •ë³´ ë¡œë”© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    });
}

// ìƒí’ˆ ë¶„ë¥˜ UI ë™ì  ìƒì„± (ë§¤ì¥ ê´€ë¦¬ì™€ ë™ì¼í•œ íŒ¨í„´)
function buildProductClassificationUI() {
    const container = $('#productClassificationsContainer');
    
    if (!productClassificationGroups || productClassificationGroups.length === 0) {
        container.html(`
            <div class="col-12 text-center text-muted">
                <i class="fas fa-info-circle"></i> ì‚¬ìš© ê°€ëŠ¥í•œ ë¶„ë¥˜ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.
                <br><small>ì½”ë“œ ê´€ë¦¬ì—ì„œ PRD ê·¸ë£¹ì— ë¶„ë¥˜ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”.</small>
            </div>
        `);
        return;
    }
    
    let html = '';
    
    // ë¶„ë¥˜ ê·¸ë£¹ë³„ë¡œ ë“œë¡­ë‹¤ìš´ ìƒì„± (2ì—´ ë ˆì´ì•„ì›ƒ)
    productClassificationGroups.forEach(function(group, index) {
        const fieldId = group.key; // ì†Œë¬¸ì í‚¤ ì‚¬ìš©
        const fieldName = group.name;
        
        html += `
            <div class="col-md-6 mb-3">
                <label for="${fieldId}" class="form-label">
                    <i class="fas fa-tag text-primary"></i> ${fieldName}
                    <small class="text-muted">(${group.sub_codes_count}ê°œ ì˜µì…˜)</small>
                </label>
                <select class="form-control product-classification-select" 
                        id="${fieldId}" 
                        data-group-code="${group.code}"
                        data-group-seq="${group.seq}">
                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                </select>
            </div>
        `;
    });
    
    // ì¶”ê°€ ì •ë³´ í‘œì‹œ
    html += `
        <div class="col-12 mt-3">
            <div class="alert alert-info alert-sm">
                <i class="fas fa-lightbulb"></i> 
                <strong>ë¶„ë¥˜ ì •ë³´ ì•ˆë‚´:</strong> 
                ì´ ${productClassificationGroups.length}ê°œì˜ ë¶„ë¥˜ ê·¸ë£¹ì´ ìˆìŠµë‹ˆë‹¤. 
                ë¶„ë¥˜ëŠ” <a href="/admin/code_management" target="_blank">ì½”ë“œ ê´€ë¦¬ > PRD</a>ì—ì„œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </div>
        </div>
    `;
    
    container.html(html);
    console.log(`ğŸ¨ ìƒí’ˆ ë¶„ë¥˜ UI ìƒì„± ì™„ë£Œ: ${productClassificationGroups.length}ê°œ ë“œë¡­ë‹¤ìš´`);
}
```

## ğŸ“Š êµ¬í˜„ ë¡œë“œë§µ

### Phase 1: ê¸°ë³¸ êµ¬ì¡° (1ì£¼)
1. **PRD ì½”ë“œ ê·¸ë£¹ ìƒì„±**: ì½”ë“œ ê´€ë¦¬ì— PRD ìµœìƒìœ„ ê·¸ë£¹ ì¶”ê°€
2. **ErpiaProduct ëª¨ë¸**: ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ë° ëª¨ë¸ ìƒì„±
3. **ê¸°ë³¸ API**: ìƒí’ˆ ëª©ë¡, ìƒì„¸ ì¡°íšŒ API êµ¬í˜„

### Phase 2: ë™ì  ë¶„ë¥˜ (1ì£¼)
1. **ë¶„ë¥˜ API**: `/product/api/classifications` êµ¬í˜„
2. **ë™ì  UI**: ë¶„ë¥˜ ë“œë¡­ë‹¤ìš´ ìë™ ìƒì„± JavaScript
3. **ë¶„ë¥˜ ì ìš©**: ìƒí’ˆ ì •ë³´ ìˆ˜ì • ì‹œ ë¶„ë¥˜ ì €ì¥

### Phase 3: ERPia ì—°ë™ (1ì£¼)
1. **ERPia ìƒí’ˆ API**: `fetch_products()` ë©”ì„œë“œ êµ¬í˜„
2. **ë™ê¸°í™” API**: ERPia ìƒí’ˆ ì •ë³´ UPSERT ì²˜ë¦¬
3. **ìŠ¤ì¼€ì¤„ë§**: ìë™ ìƒí’ˆ ì •ë³´ ë™ê¸°í™”

### Phase 4: ê³ ê¸‰ ê¸°ëŠ¥ (1ì£¼)
1. **ê²€ìƒ‰ ë° í•„í„°**: ë‹¤ì¤‘ ì¡°ê±´ ìƒí’ˆ ê²€ìƒ‰
2. **ì—‘ì…€ ê¸°ëŠ¥**: ìƒí’ˆ ì •ë³´ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
3. **í†µê³„ ëŒ€ì‹œë³´ë“œ**: ìƒí’ˆ ë¶„ë¥˜ë³„ í†µê³„

## ğŸ¯ ê¸°ëŒ€ íš¨ê³¼

### 1. ì¼ê´€ëœ ì‚¬ìš©ì ê²½í—˜
- **ë§¤ì¥ ê´€ë¦¬ì™€ ë™ì¼í•œ íŒ¨í„´**: í•™ìŠµ ë¹„ìš© ìµœì†Œí™”
- **í†µí•©ëœ ë¶„ë¥˜ ì²´ê³„**: ì½”ë“œ ê´€ë¦¬ì—ì„œ í†µí•© ê´€ë¦¬
- **ì§ê´€ì ì¸ UI**: ìë™ ìƒì„±ë˜ëŠ” ë¶„ë¥˜ ì¸í„°í˜ì´ìŠ¤

### 2. ìš´ì˜ íš¨ìœ¨ì„±
- **ì‹¤ì‹œê°„ ë¶„ë¥˜ ê´€ë¦¬**: ë¶„ë¥˜ ì¶”ê°€/ì‚­ì œ ì¦‰ì‹œ ë°˜ì˜
- **ERPia ìë™ ë™ê¸°í™”**: ìƒí’ˆ ì •ë³´ ìë™ ì—…ë°ì´íŠ¸
- **ë¬´ì œí•œ í™•ì¥**: ìƒˆë¡œìš´ ë¶„ë¥˜ ì²´ê³„ ììœ ë¡­ê²Œ ì¶”ê°€

### 3. ë°ì´í„° í’ˆì§ˆ
- **ì¼ê´€ëœ ë¶„ë¥˜**: í‘œì¤€í™”ëœ ë¶„ë¥˜ ì²´ê³„
- **ë°ì´í„° ë¬´ê²°ì„±**: ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë¶„ë¥˜ ë°©ì§€
- **ë³€ê²½ ì´ë ¥**: ëª¨ë“  ìˆ˜ì • ì‚¬í•­ ì¶”ì 

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

- `docs/15_ë™ì _ë¶„ë¥˜_ê´€ë¦¬_ì‹œìŠ¤í…œ.md`: ë§¤ì¥ ê´€ë¦¬ ë™ì  ë¶„ë¥˜ ì‹œìŠ¤í…œ
- `docs/13_ë‚´ì¼_í• ì¼_ìš°ì„ ìˆœìœ„.md`: ê°œë°œ ìš°ì„ ìˆœìœ„
- `docs/14_UI_UX_ê¸°ë³¸_ìš”êµ¬ì‚¬í•­.md`: UI/UX ê°€ì´ë“œë¼ì¸

---

**ì‘ì„±ì¼**: 2025-08-07  
**ì‘ì„±ì**: MIS v2 ê°œë°œíŒ€  
**ë²„ì „**: 1.0 