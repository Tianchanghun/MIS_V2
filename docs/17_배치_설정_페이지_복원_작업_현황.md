# 배치 설정 페이지 복원 작업 현황

## 📅 작업 일자: 2025-08-07

## 🚨 현재 문제 상황

### 문제 1: 배치 설정 페이지 미완성
- **URL**: `http://127.0.0.1:5000/batch/settings`
- **증상**: 회사 선택 기능이 작동하지 않음
- **원인**: HTML 구조가 불완전한 상태

### 문제 2: 파일 구조 분석
- **파일**: `app/batch/templates/batch/settings.html`
- **현재 상태**: 
  - 149줄: 페이지 헤더 종료
  - 150-515줄: **누락된 주요 섹션들**
  - 516줄: 최근 배치 로그 섹션 시작
  - 1484줄: 파일 종료

### 문제 3: 누락된 HTML 섹션들
1. **회사 선택 섹션** (150-177줄 예상 위치)
2. **ERPia 연동 설정 패널** (178-240줄 예상 위치)  
3. **배치 스케줄 설정 패널** (241-515줄 예상 위치)

## 🔍 확인된 사실

### ✅ 정상 작동하는 부분
- Flask 서버 실행 중
- JavaScript 함수들 모두 포함됨
- 수동 배치 실행 모달 완성됨
- API 엔드포인트 정상 존재

### ❌ 문제가 있는 부분
- 회사 선택 드롭다운 HTML 누락
- ERPia 연동 설정 폼 누락
- 배치 스케줄 설정 폼 누락

## 🛠️ 내일 해야 할 작업

### 1단계: 파일 구조 복원
```bash
# 1. 현재 파일 백업
cp app/batch/templates/batch/settings.html app/batch/templates/batch/settings_broken.html

# 2. Git에서 완전한 버전 확인
git show 847f118:app/batch/templates/batch/settings.html > temp_complete_settings.html

# 3. 완전한 버전으로 교체
cp temp_complete_settings.html app/batch/templates/batch/settings.html
```

### 2단계: 누락된 HTML 섹션 추가
149줄과 516줄 사이에 다음 HTML 추가:

```html
<!-- 회사 선택 -->
<div class="row mb-4">
    <div class="col-md-12">
        <div class="card settings-card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-building me-2"></i>회사 선택</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <label class="form-label">설정할 회사 선택</label>
                        <select class="form-select" id="companySelect" onchange="loadCompanySettings()">
                            <option value="">회사를 선택하세요</option>
                            {% if user_companies %}
                                {% for uc in user_companies %}
                                <option value="{{ uc.company_id }}" {% if current_company and uc.company_id == current_company.id %}selected{% endif %}>
                                    {{ uc.company.company_name }}
                                    {% if uc.is_primary %}<span class="badge bg-primary ms-1">주속</span>{% endif %}
                                </option>
                                {% endfor %}
                            {% endif %}
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ERPia 연동 설정 + 배치 스케줄 설정 패널들도 추가 필요 -->
```

### 3단계: 테스트 및 검증
1. 서버 재시작
2. `http://127.0.0.1:5000/batch/settings` 접속
3. 회사 선택 드롭다운 확인
4. 회사 선택 시 설정 패널들 표시 확인
5. 수동 실행 버튼 작동 확인

## 📋 참고 정보

### 관련 파일들
- `app/batch/templates/batch/settings.html` (주요 작업 파일)
- `app/batch/routes.py` (API 엔드포인트)
- `app/batch/templates/batch/settings_backup.html` (백업 파일)

### 중요 JavaScript 함수들
- `loadCompanySettings()` - 회사 선택 시 호출
- `showManualBatchModal()` - 수동 실행 모달 표시
- `populateSettings()` - 설정 데이터 폼에 채우기

### API 엔드포인트들
- `GET /batch/api/erpia/settings/<company_id>` - 설정 조회
- `POST /batch/api/erpia/settings/<company_id>` - 설정 저장
- `POST /batch/api/erpia/manual-batch/<company_id>` - 수동 실행

## 🎯 예상 소요 시간
- **파일 복원**: 30분
- **HTML 구조 완성**: 1시간
- **테스트 및 디버깅**: 30분
- **총 예상 시간**: 2시간

---
**작성자**: Assistant  
**작성일**: 2025-08-07  
**상태**: 작업 중단 (내일 재개 예정) 