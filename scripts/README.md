# 대량 매장 정보 동기화 스크립트

## 📋 개요

2001년 01월 01일부터 현재까지의 ERPia 매장 정보를 주단위로 안전하게 가져오는 스크립트입니다.

## 🚀 실행 방법

### 기본 실행 (에이원 회사, 2001년부터 현재까지)
```bash
cd C:\mis_v2
python scripts/bulk_customer_sync.py
```

### 옵션 지정 실행
```bash
# 에이원 월드 회사로 실행
python scripts/bulk_customer_sync.py --company-id 2

# 특정 연도부터 시작
python scripts/bulk_customer_sync.py --start-year 2010

# 특정 종료 날짜까지
python scripts/bulk_customer_sync.py --end-date 2023-12-31

# 모든 옵션 조합
python scripts/bulk_customer_sync.py --company-id 1 --start-year 2001 --end-date 2025-08-08
```

## ⚙️ 주요 옵션

| 옵션 | 설명 | 기본값 | 예시 |
|------|------|--------|------|
| `--company-id` | 회사 ID (1=에이원, 2=에이원월드) | 1 | `--company-id 2` |
| `--start-year` | 시작 연도 | 2001 | `--start-year 2010` |
| `--end-date` | 종료 날짜 (YYYY-MM-DD) | 오늘 | `--end-date 2023-12-31` |

## 📊 처리 방식

- **주단위 처리**: 2001년부터 약 24년간 = 약 **1,250주** 처리
- **안전한 처리**: 각 주간 처리 후 3초 대기 (ERPia 서버 보호)
- **UPSERT 방식**: 매장 코드 기준으로 업데이트 또는 신규 삽입
- **오류 처리**: 개별 오류 발생 시에도 전체 처리 계속

## 📈 예상 소요 시간

- **총 주간**: 약 1,250주
- **주당 처리**: 약 5-6초 (API 호출 + DB 처리 + 3초 대기)
- **예상 시간**: 약 **2-3시간**

## 📝 로그 파일

실행 중 상세한 로그가 다음 파일에 저장됩니다:
- **파일명**: `bulk_customer_sync.log`
- **위치**: 스크립트 실행 디렉토리
- **내용**: 진행 상황, 오류, 통계 등

## 🔍 진행 상황 모니터링

### 실시간 로그 확인
```bash
# 별도 터미널에서 로그 실시간 확인
tail -f bulk_customer_sync.log
```

### 진행률 확인
스크립트 실행 중 다음과 같은 로그가 출력됩니다:
```
📈 진행률: 100/1250 (8.0%)
📊 누적 통계: 신규 150개, 업데이트 300개, 오류 2개
```

## ⚠️ 주의사항

1. **ERPia 설정 필요**: 해당 회사의 ERPia 연동 설정이 먼저 완료되어야 합니다
2. **네트워크 안정성**: 장시간 실행되므로 네트워크 연결이 안정적이어야 합니다
3. **동시 실행 금지**: 같은 회사에 대해 동시에 여러 스크립트 실행 금지
4. **디스크 공간**: 대량 데이터 저장을 위한 충분한 디스크 공간 필요

## 🛑 중단 및 재시작

### 안전한 중단
```bash
Ctrl + C  # 현재 주간 처리 완료 후 중단
```

### 재시작
특정 연도부터 재시작하려면:
```bash
python scripts/bulk_customer_sync.py --start-year 2015
```

## 📋 실행 결과 예시

```
🚀 대량 매장 정보 동기화 시작
📅 기간: 2001-01-01 ~ 2025-08-08
🏢 대상 회사: 1 (에이원)
📊 총 1250주간의 데이터를 처리합니다

📈 진행률: 1/1250 (0.1%)
📅 매장 정보 수집: 20010101 ~ 20010107
📊 수집된 매장 데이터: 15개
✅ 완료: 신규 15개, 업데이트 0개, 오류 0개

... (중간 과정) ...

🎉 대량 동기화 완료!
📊 최종 통계:
   - 처리된 주간: 1250주
   - 신규 추가: 2,500개
   - 업데이트: 1,200개
   - 오류: 5개
   - 총 처리: 3,700개
```

## 🔧 문제 해결

### ERPia 설정 오류
```
❌ 회사 ID 1의 ERPia 설정이 없습니다.
```
**해결**: 배치 설정 페이지에서 ERPia 연동 설정을 먼저 완료하세요.

### 연결 오류
```
❌ ERPia 클라이언트 초기화 실패
```
**해결**: ERPia 서버 연결 상태와 인증 정보를 확인하세요.

### 메모리 부족
**해결**: 스크립트는 주단위로 처리하므로 메모리 사용량이 적습니다. 시스템 재시작 후 재실행하세요. 