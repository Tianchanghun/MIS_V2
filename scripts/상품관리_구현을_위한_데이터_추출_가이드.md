# 🏢 상품관리 구현을 위한 데이터 추출 가이드

## 📋 개요

MIS v2 시스템에 상품관리 기능을 구현하기 위해 필요한 데이터를 추출하고 분석하는 종합 가이드입니다.

## 🎯 목적

1. **레거시 시스템 상품 데이터 파악**: 기존 상품 구조 및 데이터 분석
2. **현재 MIS v2 구조 이해**: 멀티테넌트, 코드 체계, 권한 구조 파악
3. **구현 방향성 도출**: 신규 상품관리 기능의 설계 및 구현 방향 결정

## 📂 제공된 스크립트

### 1️⃣ **레거시 상품 정보 추출**

#### 📄 `export_legacy_products_simple.py`
- **목적**: 레거시 MS-SQL DB에서 상품 정보 추출
- **대상**: `tbl_Product`, `tbl_Product_DTL`, `tbl_Code` 테이블
- **출력**: 레거시 상품 구조 및 데이터

#### 🚀 **실행 방법**
```bash
cd C:\mis_v2
python scripts/export_legacy_products_simple.py
```

#### 📊 **출력 결과**
| 파일명 | 내용 | 설명 |
|--------|------|------|
| `legacy_products_YYYYMMDD_HHMMSS.xlsx` | 레거시 상품 데이터 | DB 연결 성공 시 |
| `sample_products_YYYYMMDD_HHMMSS.xlsx` | 샘플 상품 데이터 | DB 연결 실패 시 |

### 2️⃣ **현재 MIS v2 참고 데이터 추출**

#### 📄 `export_current_data.py`
- **목적**: 현재 MIS v2 PostgreSQL DB 구조 분석
- **대상**: `companies`, `tbl_code`, `tbl_member`, `user_companies` 테이블
- **출력**: 멀티테넌트 구조, 코드 체계, 권한 구조

#### 🚀 **실행 방법**
```bash
cd C:\mis_v2
python scripts/export_current_data.py
```

#### 📊 **출력 결과**
- **파일명**: `current_reference_data_YYYYMMDD_HHMMSS.xlsx`
- **시트 구성**:
  - `00_요약정보`: 전체 데이터 요약
  - `01_회사정보`: 회사 마스터 데이터
  - `02_전체코드`: 전체 코드 체계
  - `03_코드그룹분석`: 코드 그룹별 분석
  - `04_상품관련코드`: 상품 관련 코드 추출
  - `05_사용자정보`: 사용자 정보 (샘플)
  - `06_사용자회사매핑`: 멀티테넌트 매핑 구조

## 📈 실행 결과 분석

### ✅ **성공적으로 추출된 데이터**

#### 🏢 **현재 MIS v2 현황** (`current_reference_data_20250808_110259.xlsx`)
- **회사 수**: 2개 (에이원, 에이원월드)
- **전체 코드 수**: 2,183개
- **코드 그룹 수**: 19개
- **상품 관련 코드**: 37개
- **사용자-회사 매핑**: 6개

#### 📦 **레거시 시스템 샘플** (`sample_products_20250808_110045.xlsx`)
- DB 연결 실패로 샘플 데이터 생성
- 실제 연결 시 레거시 상품 구조 확인 가능

## 🔧 구현에 필요한 작업

### 1️⃣ **레거시 DB 연결 설정**
```python
# scripts/export_legacy_products_simple.py 파일에서 연결 정보 수정
connection_configs = [
    {
        "DRIVER": "{ODBC Driver 17 for SQL Server}",
        "SERVER": "실제서버주소",  # 수정 필요
        "DATABASE": "db_mis",
        "Trusted_Connection": "yes"
    }
]
```

### 2️⃣ **상품관리 모델 설계**
기존 코드 체계 활용한 상품 모델 설계:

```python
class Product(db.Model):
    """상품 마스터"""
    __tablename__ = 'products'
    
    # 기본 정보
    id = db.Column(db.Integer, primary_key=True)
    company_id = db.Column(db.Integer, db.ForeignKey('companies.id'))
    
    # 분류 정보 (기존 코드 체계 활용)
    brand_code_seq = db.Column(db.Integer, db.ForeignKey('tbl_code.seq'))
    category_code_seq = db.Column(db.Integer, db.ForeignKey('tbl_code.seq'))
    type_code_seq = db.Column(db.Integer, db.ForeignKey('tbl_code.seq'))
    
    # 상품 정보
    product_name = db.Column(db.String(100), nullable=False)
    product_code = db.Column(db.String(50))
    price = db.Column(db.Integer)
    description = db.Column(db.Text)
    
    # 상태 관리
    is_active = db.Column(db.Boolean, default=True)
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
```

### 3️⃣ **코드 체계 활용**
기존 2,183개 코드 중 상품 관련 37개 코드 활용:
- 브랜드 코드
- 상품 카테고리 코드
- 상품 타입 코드
- 기타 분류 코드

### 4️⃣ **멀티테넌트 지원**
- 모든 상품 데이터에 `company_id` 포함
- 회사별 데이터 분리
- 사용자별 회사 접근 권한 확인

## 🛠️ 다음 단계

### Phase 1: 모델 설계
1. ✅ 상품 관련 테이블 설계
2. ✅ 기존 코드 체계와 연동 방안
3. ✅ 멀티테넌트 구조 적용

### Phase 2: 기본 CRUD
1. ✅ 상품 등록/수정/삭제 API
2. ✅ 상품 목록 조회 API
3. ✅ 검색 및 필터링 기능

### Phase 3: 고급 기능
1. ✅ 이미지 업로드 기능
2. ✅ 엑셀 일괄 등록
3. ✅ ERPia 연동 (기존 `ErpiaApiClient` 활용)

### Phase 4: UI 구현
1. ✅ 상품 목록 페이지
2. ✅ 상품 등록/수정 폼
3. ✅ 검색 및 필터 UI

## 📚 참고 자료

### 📁 **추출된 데이터 파일**
1. `current_reference_data_20250808_110259.xlsx` - 현재 MIS v2 구조
2. `sample_products_20250808_110045.xlsx` - 상품 데이터 샘플

### 📄 **관련 문서**
1. `scripts/legacy_export_README.md` - 레거시 추출 상세 가이드
2. `scripts/README.md` - 배치 처리 관련 가이드
3. `docs/17_배치_설정_페이지_복원_작업_현황.md` - 현재 작업 현황

### 🔗 **기존 구현 참고**
1. **매장 관리** (`/shop/index`) - ERPia 동기화 방식
2. **배치 관리** (`/batch/settings`) - 멀티테넌트 구조
3. **사용자 관리** - 권한 및 회사 매핑

## ⚠️ 주의사항

1. **데이터 무결성**: 레거시 데이터 마이그레이션 시 검증 필수
2. **권한 관리**: 회사별 데이터 접근 제한 구현
3. **성능 최적화**: 대량 상품 데이터 처리 고려
4. **백업**: 작업 전 반드시 데이터 백업

## 🎯 구현 목표

**레거시 시스템과 동일한 수준의 상품관리 기능을 MIS v2에 구현하되, 멀티테넌트 구조와 현대적 UI/UX를 적용한 향상된 시스템 구축**

---
**작성일**: 2025-08-08  
**작성자**: AI Assistant (Claude Sonnet 4)  
**상태**: ✅ 데이터 추출 완료, 구현 준비 단계 